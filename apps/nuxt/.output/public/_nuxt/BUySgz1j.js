import{_ as Ie}from"./y9FChQyZ.js";import{ad as Le,d as Re,R as Ae,$ as ue,S as We,ap as Ve,W as Te,V as je,U as N,aJ as y,aK as ne,aL as j,aM as re,Z as Ue,Q as Pe,i as p,z as Xe,ag as de,f as t,F as Me,b as Oe,aN as ce,M as $e,aO as me,a5 as m,aP as q,j as fe,a7 as Q,aQ as U,a8 as H,aR as J,aS as pe,aT as Ne,aU as qe,X as Qe}from"./CL2Zm6Gn.js";import{B as ve}from"./CgcP0R2m.js";import{B as V}from"./DrXBYfFo.js";import{B as we}from"./oY8pmwEW.js";import{B as He}from"./Cs5B2yJA.js";import{B as Je,P as Ke,c as Ze}from"./DxLIbvu9.js";import{P as ze}from"./BKxkpCP1.js";import{W as Ge}from"./qioYePRd.js";import{B as K}from"./CyxMrWnv.js";import{T as k}from"./B23dpBb2.js";import{F as Ye,a as F}from"./Dgmg0EPc.js";import{D as et}from"./B_stZ-MH.js";import{g as tt}from"./YA9n7JcN.js";import{E as lt}from"./BIqup3l3.js";import{M as at}from"./BKClUODy.js";import{P as ot}from"./CmInly2L.js";import{s as it}from"./DTF4rsmH.js";import"./DBw7vsOg.js";import"./D3s8KrHR.js";import"./5Q5X2q0H.js";import"./Dm3cJJjd.js";import"./DUu00FKn.js";import"./QnX__4Tr.js";import"./CGx_iWmd.js";import"./CMZAKU7l.js";import"./BqBkRU00.js";import"./CGgiZe4D.js";import"./BIONxxX3.js";import"./DUCa_d2x.js";import"./GulbbN7M.js";import"./CJKjSNvS.js";import"./CAPmeoOz.js";import"./qEnmgki7.js";import"./1RI2pLfA.js";function st(C,s){return Le("word/delete",s,C,"post")}function T(C){return typeof C=="function"||Object.prototype.toString.call(C)==="[object Object]"&&!qe(C)}const ut=Re({__name:"dict",setup(C){const s=Ae(),D=ue(),P=We(),De=Ve(),B=ce(),{t:c}=Te();let b=p(!1),n=p([]);const S=()=>({id:"",word:"",phonetic0:"",phonetic1:"",trans:"",sentences:"",phrases:"",synos:"",relWords:"",etymology:""});let _=p(!1),u=p(S()),Z=p();const ge=$e({word:[{required:!0,message:"请输入单词",trigger:"blur"},{max:100,message:"名称不能超过100个字符",trigger:"blur"}]});let I=p(!1);function L(l=!1){de(()=>{let a=D.word.bookList.findIndex(o=>o.id===s.editDict.id);s.editDict.words=n.value;let e=s.editDict;!e.custom&&![y.wordKnown,y.wordWrong,y.wordCollect].includes(e.id)&&(e.custom=!0,e.id.includes("_custom")||(e.id+="_custom_"+q(6))),e.length=e.words.length,a>-1?(D.word.bookList[a]=N(e),l&&(D.word.studyIndex=a)):(D.word.bookList.push(N(e)),l&&(D.word.studyIndex=D.word.bookList.length-1))},100)}async function he(){await Z.value.validate(l=>{if(l){let a=me(u.value);if(a.id){let e=n.value.find(o=>o.id===a.id);if(e)Object.assign(e,a),m.success("修改成功");else{m.success("修改失败，未找到单词");return}}else{if(a.id=q(6),a.checked=!1,n.value.find(o=>o.word===u.value.word)){m.warning("已有相同名称单词！");return}else n.value.push(a);m.success("添加成功"),u.value=S()}L()}else m.warning("请填写完整")})}async function z(l){let a=()=>{l.map(o=>{let r=n.value.findIndex(i=>i.id===o);r>-1&&(o===u.value.id&&(u.value=S()),n.value.splice(r,1))}),h.value.getData(),L()},e=async o=>{let r=await st(null,{wordIds:l,dictId:o});if(r.success)h.value.getData();else return m.error(r.msg??"删除失败")};if(j.CAN_REQUEST)if(f.value.custom)f.value.sync?await e(f.value.id):a();else{let o=await Ze(null,{id:f.value.id});if(o.success)await e(o.data.id),ee(o.data.id);else return m.error(o.msg)}else a()}function G(l){let a=S();return a.id=l.id,a.word=l.word,a.phonetic1=l.phonetic1,a.phonetic0=l.phonetic0,a.trans=l.trans.map(e=>(e.pos+e.cn).replaceAll('"',"")).join(`
`),a.sentences=l.sentences.map(e=>(e.c+`
`+e.cn).replaceAll('"',"")).join(`

`),a.phrases=l.phrases.map(e=>(e.c+`
`+e.cn).replaceAll('"',"")).join(`

`),a.synos=l.synos.map(e=>(e.pos+e.cn+`
`+e.ws.join("/")).replaceAll('"',"")).join(`

`),a.relWords=l.relWords.root?"词根:"+l.relWords.root+`

`+l.relWords.rels.map(e=>(e.pos+`
`+e.words.map(o=>o.c+":"+o.cn).join(`
`)).replaceAll('"',"")).join(`

`):"",a.etymology=l.etymology.map(e=>(e.t+`
`+e.d).replaceAll('"',"")).join(`

`),a}function Y(l){_.value=!0,u.value=G(l),B&&(g.value="edit")}function ye(){_.value=!0,u.value=S(),B&&(g.value="edit")}function Fe(){_.value=!1,u.value=S(),B&&(g.value="list")}let E=p(!1),R=p(!1),g=p("list");const be=fe(()=>!(R.value||E.value));je(async()=>{if(De.query?.isAdd)R.value=!0,s.editDict=N();else if(s.editDict.id){if(!s.editDict.words.length&&!s.editDict.custom&&![y.wordCollect,y.wordWrong,y.wordKnown].includes(s.editDict.en_name||s.editDict.id)){b.value=!0;let l=await ne(s.editDict);s.editDict=l}D.word.bookList.find(l=>l.id===s.editDict.id)&&j.CAN_REQUEST&&ee(s.editDict.id),b.value=!1}else return P.push("/words");n.value=s.editDict.words,h.value.getData()});async function ee(l){let a=await re({id:l});a.success&&(s.editDict=a.data)}function xe(){E.value?E.value=!1:P.back()}let X=p(!1);const x=ue(),M=Ue(),{nav:te}=Pe();async function O(l={}){console.log(1),localStorage.removeItem(ot.key),I.value=!0,await D.changeDict(s.editDict),I.value=!1,window.umami?.track("startStudyWord",{name:x.sdict.name,index:x.sdict.lastLearnIndex,perDayStudyNumber:x.sdict.perDayStudyNumber,custom:x.sdict.custom,complete:x.sdict.complete,wordPracticeMode:M.wordPracticeMode});let a=tt();te("practice-words/"+x.sdict.id,l,{taskWords:a})}async function le(){if(!s.editDict.words.length)return m.warning("没有单词可学习！");if(!M.disableShowPracticeSettingDialog){X.value=!0;return}O()}async function Ce(){b.value=!0,await D.changeDict(s.editDict),b.value=!1,te("words-test/"+x.sdict.id)}let $=p(!1),A=p(!1),h=p();function Be(l){let a=l.target.files[0];if(!a)return;let e=new FileReader;e.onload=async function(o){let r=o.target.result;A.value=!0;const i=await Q("XLSX",H.XLSX);let w=i.read(r,{type:"binary"}),oe=i.utils.sheet_to_json(w.Sheets.Sheet1);if(oe.length){let ie=oe.map(d=>{if(d.单词){let W=null;try{W=me({id:q(6),word:d.单词,phonetic0:d["音标①"]??"",phonetic1:d["音标②"]??"",trans:d.翻译??"",sentences:d.例句??"",phrases:d.短语??"",synos:d.近义词??"",relWords:d.同根词??"",etymology:d.词源??""})}catch(v){console.error("导入单词报错"+d.单词,v.message)}return W}}).filter(d=>d);if(ie.length){let d=[],W=[];ie.map(v=>{let se=s.editDict.words.findIndex(ke=>ke.word===v.word);se>-1?(v.index=se,d.push(v)):W.push(v)}),s.editDict.words=s.editDict.words.concat(W),d.length?at.confirm('单词"'+d.map(v=>v.word).join(", ")+'" 已存在，是否覆盖原单词？',"检测到重复单词",()=>{d.map(v=>{s.editDict.words[v.index]=v,delete s.editDict.words[v.index].index})},null,()=>{h.value.closeImportDialog(),l.target.value="",A.value=!1,n.value=s.editDict.words,h.value.getData(),L(),m.success("导入成功！")},{t:c}):(h.value.closeImportDialog(),l.target.value="",A.value=!1,n.value=s.editDict.words,h.value.getData(),L(),m.success("导入成功！"))}else m.warning("导入失败！原因：没有数据/未认别到数据")}else m.warning("导入失败！原因：没有数据");l.target.value="",A.value=!1},e.readAsBinaryString(a)}async function Se(){$.value=!0;const l=await Q("XLSX",H.XLSX);let a=s.editDict.words,e=s.editDict.name,o=l.utils.book_new(),r=a.map(i=>{let w=G(i);return{单词:w.word,"音标①":w.phonetic0,"音标②":w.phonetic1,翻译:w.trans,例句:w.sentences,短语:w.phrases,近义词:w.synos,同根词:w.relWords,词源:w.etymology}});o.Sheets.Sheet1=l.utils.json_to_sheet(r),o.SheetNames=["Sheet1"],l.writeFile(o,`${e}.xlsx`),m.success(e+" 导出成功！"),$.value=!1}Xe(()=>b.value,l=>{l&&de(async()=>{const a=await Q("Shepherd",H.SHEPHERD),e=new a.Tour(J);e.on("cancel",()=>{localStorage.setItem("tour-guide","1")}),e.addStep({id:"step3",text:"点击这里开始学习",attachTo:{element:"#study",on:"bottom"},buttons:[{text:`下一步（3/${J.total}）`,action(){e.next(),le()}}]}),e.addStep({id:"step4",text:"这里可以选择学习模式、设置学习数量、修改学习进度",attachTo:{element:"#mode",on:"bottom"},beforeShowPromise(){return new Promise(r=>{const i=it(()=>{document.querySelector("#mode")&&(clearInterval(i),setTimeout(r,500))},100)})},buttons:[{text:`下一步（4/${J.total}）`,action(){e.next(),O({guide:1})}}]});const o=localStorage.getItem("tour-guide");M.first&&!o&&!ce()&&e.start()},500)});const f=fe(()=>s.editDict);function ae({pageNo:l,pageSize:a,searchKey:e}){let o=n.value,r=n.value.length;return e.trim()&&(o=n.value.filter(i=>i.word.toLowerCase().includes(e.trim().toLowerCase())),r=o.length),o=o.slice((l-1)*a,(l-1)*a+a),{list:o,total:r}}async function _e({pageNo:l,pageSize:a,searchKey:e}){if(!f.value.custom&&![y.wordCollect,y.wordWrong,y.wordKnown].includes(f.value.en_name||f.value.id)){if(!n.value.length){let o=await ne(f.value);n.value=o.words}return ae({pageNo:l,pageSize:a,searchKey:e})}else{if(j.CAN_REQUEST){f.value.sync;{let o=await re({id:f.value.id,pageNo:l,pageSize:a});return o.success?{list:o.data.words,total:o.data.length}:{list:[],total:0}}}else n.value=f.value.words;return ae({pageNo:l,pageSize:a,searchKey:e})}}function Ee(l,a,e){if(!j.CAN_REQUEST){let o=pe;[U.reverse,U.reverseAll].includes(l)?o=pe:[U.random,U.randomAll].includes(l)&&(o=Ne),n.value=n.value.slice(0,e*(a-1)).concat(o(n.value.slice(e*(a-1),e*(a-1)+e))).concat(n.value.slice(e*(a-1)+e)),s.editDict.words=n.value,m.success("操作成功"),h.value.getData(),L()}}return()=>{let l,a,e,o,r;return t(He,null,{default:()=>[be.value?t("div",{className:"card mb-0 dict-detail-card flex flex-col"},[t("div",{class:"dict-header flex justify-between items-center relative"},[t(ve,{class:"dict-back z-2"},null),t("div",{class:"dict-title absolute page-title text-align-center w-full"},[s.editDict.name]),t("div",{class:"dict-actions flex"},[t(V,{loading:I.value||b.value,type:"info",onClick:()=>E.value=!0},T(l=c("edit"))?l:{default:()=>[l]}),t(V,{loading:I.value||b.value,type:"info",onClick:Ce},T(a=c("test"))?a:{default:()=>[a]}),t(V,{id:"study",loading:I.value||b.value,onClick:le},T(e=c("learn"))?e:{default:()=>[e]})])]),f.value.description&&t(Me,null,[t("div",{class:"text-lg  mt-2"},[c("introduction"),Oe("："),f.value.description]),t("div",{class:"line my-3"},null)]),B&&_.value&&t("div",{class:"tab-navigation mb-3"},[t("div",{class:`tab-item ${g.value==="list"?"active":""}`,onClick:()=>g.value="list"},[c("word_list")]),t("div",{class:`tab-item ${g.value==="edit"?"active":""}`,onClick:()=>g.value="edit"},[u.value.id?c("edit"):c("add"),c("word")])]),t("div",{class:"flex flex-1 overflow-hidden content-area"},[t("div",{class:`word-list-section ${B&&_.value&&g.value!=="list"?"mobile-hidden":""}`},[t(Je,{ref:h,class:"h-full",request:_e,onDel:z,onSort:Ee,onAdd:ye,onImport:Be,onExport:Se,exportLoading:$.value,importLoading:A.value},{default:i=>t(Ge,{showTransPop:!1,onClick:()=>Y(i.item),index:i.index,showCollectIcon:!1,showMarkIcon:!1,item:i.item},{prefix:()=>i.checkbox(i.item),suffix:()=>t("div",{class:"flex flex-col"},[t(we,{class:"option-icon",onClick:()=>Y(i.item),title:"编辑"},{default:()=>[t(Ie,null,null)]}),t(ze,{title:"确认删除？",onConfirm:()=>z([i.item.id])},{default:()=>[t(we,{class:"option-icon",title:"删除"},{default:()=>[t(et,null,null)]})]})])})})]),_.value?t("div",{class:`edit-section flex-1 flex flex-col ${B&&g.value!=="edit"?"mobile-hidden":""}`},[t("div",{class:"common-title"},[u.value.id?c("edit"):c("add"),c("word")]),t(Ye,{class:"flex-1 overflow-auto pr-2",ref:i=>Z.value=i,rules:ge,model:u.value,"label-width":"7rem"},{default:()=>[t(F,{label:"单词",prop:"word"},{default:()=>[t(K,{modelValue:u.value.word,"onUpdate:modelValue":i=>u.value.word=i},null)]}),t(F,{label:"英音音标"},{default:()=>[t(K,{modelValue:u.value.phonetic0,"onUpdate:modelValue":i=>u.value.phonetic0=i},null)]}),t(F,{label:"美音音标"},{default:()=>[t(K,{modelValue:u.value.phonetic1,"onUpdate:modelValue":i=>u.value.phonetic1=i},null)]}),t(F,{label:"翻译"},{default:()=>[t(k,{modelValue:u.value.trans,"onUpdate:modelValue":i=>u.value.trans=i,placeholder:"一行一个翻译，前面词性，后面内容（如n.取消）；多个翻译请换行",autosize:{minRows:6,maxRows:10}},null)]}),t(F,{label:"例句"},{default:()=>[t(k,{modelValue:u.value.sentences,"onUpdate:modelValue":i=>u.value.sentences=i,placeholder:"一行原文，一行译文；多个请换两行",autosize:{minRows:6,maxRows:10}},null)]}),t(F,{label:"短语"},{default:()=>[t(k,{modelValue:u.value.phrases,"onUpdate:modelValue":i=>u.value.phrases=i,placeholder:"一行原文，一行译文；多个请换两行",autosize:{minRows:6,maxRows:10}},null)]}),t(F,{label:"同义词"},{default:()=>[t(k,{modelValue:u.value.synos,"onUpdate:modelValue":i=>u.value.synos=i,placeholder:"请参考已有单词格式",autosize:{minRows:6,maxRows:20}},null)]}),t(F,{label:"同根词"},{default:()=>[t(k,{modelValue:u.value.relWords,"onUpdate:modelValue":i=>u.value.relWords=i,placeholder:"请参考已有单词格式",autosize:{minRows:6,maxRows:20}},null)]}),t(F,{label:"词源"},{default:()=>[t(k,{modelValue:u.value.etymology,"onUpdate:modelValue":i=>u.value.etymology=i,placeholder:"请参考已有单词格式",autosize:{minRows:6,maxRows:10}},null)]})]}),t("div",{class:"center"},[t(V,{type:"info",onClick:Fe},T(o=c("close"))?o:{default:()=>[o]}),t(V,{type:"primary",onClick:he},T(r=c("save"))?r:{default:()=>[r]})])]):null])]):t("div",{class:"card mb-0 dict-detail-card"},[t("div",{class:"dict-header flex justify-between items-center relative"},[t(ve,{class:"dict-back z-2",onClick:()=>{R.value?P.back():E.value=!1}},null),t("div",{class:"dict-title absolute page-title text-align-center w-full"},[s.editDict.id?c("edit_dict"):c("create_dict")])]),t("div",{class:"center"},[t(lt,{isAdd:R.value,isBook:!1,onClose:xe,onSubmit:()=>E.value=R.value=!1},null)])]),t(Ke,{showLeftOption:!0,modelValue:X.value,"onUpdate:modelValue":i=>X.value=i,onOk:O},null)]})}}}),$t=Qe(ut,[["__scopeId","data-v-c2a21002"]]);export{$t as default};
