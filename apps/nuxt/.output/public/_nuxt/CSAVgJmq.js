import{Y as $,o,c as i,a as e,ad as B,d as ue,S as de,ae as ce,V as me,z as ve,a5 as p,x as _e,h as R,w as y,f as c,F as q,r as Q,k as n,t as r,e as d,b as V,l as W,n as Y,i as m,j as g,af as fe,ag as J,X as pe}from"./Dbiv707D.js";import{_ as ge}from"./CHCfgmoC.js";import{B as he}from"./BKwk18oP.js";import{B as F}from"./B55v04t5.js";import{H as xe}from"./BTmIh2Yk.js";import{R as be,a as ye}from"./DP4Aref_.js";import{I as we}from"./B__SE3Na.js";import{B as ke}from"./CjoTdGiq.js";import{P as Ce}from"./DDg15Rfs.js";import{s as Ne}from"./S7Ir0EnR.js";import"./BgVYQ2O1.js";import"./DScG_TK1.js";import"./CdkHU8iM.js";import"./U7X5gOHL.js";import"./C3NBTwW5.js";const Ie={viewBox:"0 0 20 20",width:"1.2em",height:"1.2em"};function Ve(u,v){return o(),i("svg",Ie,[...v[0]||(v[0]=[e("path",{fill:"currentColor",d:"M20 13.692V3.846A3.845 3.845 0 0 0 16.154 0H3.846A3.845 3.845 0 0 0 0 3.846v12.308A3.845 3.845 0 0 0 3.846 20h12.308a3.85 3.85 0 0 0 3.787-3.167c-1.02-.439-5.44-2.347-7.742-3.45c-1.755 2.122-3.589 3.396-6.356 3.396s-4.613-1.703-4.388-3.79c.145-1.368 1.084-3.605 5.161-3.22c2.148.201 3.132.604 4.886 1.182c.45-.83.83-1.745 1.114-2.72H4.847v-.77H8.69V6.077H4V5.23h4.69V3.236s.045-.315.389-.315H11V5.23h5.002v.847H11v1.384h4.078a15.7 15.7 0 0 1-1.654 4.154c1.182.43 6.575 2.077 6.575 2.077M5.538 15.46c-2.925 0-3.384-1.846-3.23-2.617s1.002-1.768 2.625-1.768c1.87 0 3.541.477 5.547 1.454c-1.407 1.837-3.144 2.93-4.942 2.93"},null,-1)])])}const Be=$({name:"uiw-alipay",render:Ve}),Re={viewBox:"0 0 14 14",width:"1.2em",height:"1.2em"};function Fe(u,v){return o(),i("svg",Re,[...v[0]||(v[0]=[e("g",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"M.5 11a1 1 0 0 0 .998 1h11.004a1 1 0 0 0 .998-1V8.966a2.037 2.037 0 0 1 0-3.932V3a1 1 0 0 0-.998-1H1.498A1 1 0 0 0 .5 3v2.03a2.037 2.037 0 0 1 0 3.94zm4.02-1.5l5-5"}),e("path",{d:"M5.02 5.5a.5.5 0 1 0 0-1a.5.5 0 0 0 0 1m4 4a.5.5 0 1 0 0-1a.5.5 0 0 0 0 1"})],-1)])])}const Pe=$({name:"streamline-discount-percent-coupon",render:Fe}),Ae={viewBox:"0 0 20 20",width:"1.2em",height:"1.2em"};function He(u,v){return o(),i("svg",Ae,[...v[0]||(v[0]=[e("path",{fill:"currentColor",d:"M16.5 6.671c.116 0 .223.04.308.107l.067.063l.017.02a5 5 0 0 1-3.675 8.135L13 15H7a5 5 0 0 1-.303-.009l1.657 1.655a.5.5 0 0 1 .057.638l-.057.07a.5.5 0 0 1-.638.057l-.07-.057l-2.5-2.5a.5.5 0 0 1-.057-.638l.057-.07l2.5-2.5a.5.5 0 0 1 .765.638l-.057.07l-1.637 1.636l.14.008L7 14h6a4 4 0 0 0 3.11-6.516a.5.5 0 0 1 .39-.812m-4.854-4.025a.5.5 0 0 1 .638-.057l.07.057l2.5 2.5l.057.07a.5.5 0 0 1 0 .568l-.057.07l-2.5 2.5l-.07.057a.5.5 0 0 1-.568 0l-.07-.057l-.057-.07a.5.5 0 0 1 0-.568l.057-.07l1.637-1.636l-.14-.008L13 6H7a4 4 0 0 0-3.105 6.522a.5.5 0 1 1-.801.601a5 5 0 0 1 3.689-8.119L7 5h6q.153 0 .303.009l-1.657-1.655l-.057-.07a.5.5 0 0 1 .057-.638"},null,-1)])])}const Me=$({name:"fluent-arrow-repeat-all20-regular",render:He}),De={viewBox:"0 0 20 20",width:"1.2em",height:"1.2em"};function Le(u,v){return o(),i("svg",De,[...v[0]||(v[0]=[e("path",{fill:"currentColor",d:"M10 2a8 8 0 1 1 0 16a8 8 0 0 1 0-16m0 1a7 7 0 1 0 0 14a7 7 0 0 0 0-14m3.358 4.646a.5.5 0 0 1 .058.638l-.058.07l-4.004 4.004a.5.5 0 0 1-.638.058l-.07-.058l-2-2a.5.5 0 0 1 .638-.765l.07.058L9 11.298l3.651-3.652a.5.5 0 0 1 .707 0"},null,-1)])])}const ze=$({name:"fluent-checkmark-circle20-regular",render:Le});function Se(u){return B("member/levelBenefits",null,u,"get")}function $e(u){return B("/member/orderCreate",u,null,"post")}function je(u){return B("/member/alipayQuery",null,u,"get")}function Ue(u){return B("/member/orderStatus",null,u,"get")}function Ee(u){return B("/member/couponInfo",null,u,"get")}function Te(u){return B("/member/setAutoRenew",u,null,"post")}const qe={class:"space-y-6"},Qe={class:"card-white"},We={class:"grid grid-cols-3 grid-rows-3 gap-3"},Ge={key:0},Oe={key:0,class:"card-white bg-green-50 dark:bg-item border border-green-200 mt-3 mb-6"},Xe={class:"flex items-center justify-between"},Ye={class:"flex items-center"},Je={class:"font-semibold text-green-800"},Ke={class:"text-sm text-green-600"},Ze={class:"text-align-end space-y-2"},et={key:0,class:"flex items-center gap-space"},tt={class:"flex items-center text-sm text-gray-600"},st={class:"plans"},lt={class:"text-2xl font-bold bg-gray-300 dark:bg-third px-6 py-4"},at={class:"p-6 flex flex-col justify-between flex-1"},nt={class:"plan-head"},ot={class:"price"},it={class:"amount"},rt={class:"unit"},ut={key:0,class:"tag"},dt={key:0,class:"text-sm flex items-center mt-4"},ct={key:0,id:"pay",class:"mb-50"},mt={class:"center"},vt={class:"card-white w-5/10"},_t={class:"flex items-center justify-between gap-6"},ft={key:0,class:"center gap-2"},pt={key:0,class:"bg-green-50 border border-green-200 rounded-lg px-4 py-3 mt-4"},gt={class:"font-medium"},ht={class:"flex justify-between w-full mt-2"},xt={key:0},bt={key:1},yt={key:2},wt={key:3},kt={key:0},Ct={key:1},Nt={class:"grid grid-cols-3 gap-8"},It={class:"card-white"},Vt={class:"space-y-3 w-full"},Bt=["onClick"],Rt={class:"flex items-center flex-1 gap-4"},Ft={class:"font-medium color-main"},Pt={class:"text-sm text-gray-500"},At={class:"card-white"},Ht={class:"mb-4"},Mt={class:"text-purple-600 text-sm mb-2"},Dt={class:"mb-4"},Lt={class:"flex justify-between items-center mb-4"},zt={class:"flex items-baseline"},St={class:"ml-2"},$t={key:0},jt={key:0,class:"mb-4"},Ut={key:0,class:"flex items-baseline text-gray-500 line-through"},Et={class:"text-lg"},Tt={class:"ml-2"},qt={class:"text-sm"},Qt={key:0,class:"text-green-600 flex items-center"},Wt={key:1},Gt={class:"flex items-baseline mb-4"},Ot={class:"text-3xl font-semibold"},Xt={class:"card-white flex flex-col"},Yt={class:"center flex-col relative flex-1"},Jt={key:0,class:"center h-full w-full absolute left-0 top-0 bg-white z-2"},Kt=ue({__name:"vip",setup(u){const v=de(),P=ce();let A=m(!1),_=m("alipay"),w=m(""),N=m(1);const k=g(()=>P.user?.member??{}),K=g(()=>k.value?.endDate===null?"永久":k.value?.endDate);let I=m({});const j=g(()=>{let s=[];return I.value?.level&&(s.push({id:"month",name:"月付",price:I.value.level.price,unit:"月"}),s.push({id:"month_auto",name:"连续包月",price:I.value.level.price_auto,unit:"月",highlight:"性价比更高",autoRenew:!0}),s.push({id:"year",name:"年度会员",price:I.value.level.yearly_price,unit:"年",highlight:"年度优惠"})),s}),Z=[{id:"alipay",name:"支付宝",description:"使用支付宝支付"}],H=g(()=>j.value.find(s=>s.id===k.value?.plan)??null),f=g(()=>j.value.find(s=>s.id===w.value)??null),C=g(()=>f.value?.id==="month_auto"?Number(f.value?.price):Number(N.value)*Number(f.value?.price)),U=g(()=>{if(l.value.is_valid){if(l.value.min_amount){const s=Number(l.value.min_amount);return C.value>s}return!0}return!1}),G=g(()=>{if(!l.value.is_valid)return Number(C.value.toFixed(2));if(l.value.type==="free_trial")return 0;if(!U.value)return Number(C.value.toFixed(2));let s=0;if(l.value.type==="discount"){const x=Number(l.value.value);if(s=C.value*(1-x),l.value.max_discount){const b=Number(l.value.max_discount);s=Math.min(s,b)}}else l.value.type==="amount"&&(s=Number(l.value.value));return Math.max(C.value-s,0).toFixed(2)}),ee=g(()=>k.value?.active?k.value.endDate:fe(Date.now()));me(async()=>{let s=await Se({levelCode:"basic"});s.success&&(I.value=s.data)});let M=m(!1);async function te(){if(M.value)return;M.value=!0;let s=await Te({autoRenew:!1});s.success?(p.success("取消成功"),P.init()):p.error(s.msg||"取消失败"),M.value=!1}function se(s){return s.id===w.value?"已选中":s.id===H.value?.id?"当前计划":"选择"}function le(s){if(!P.isLogin){v.push({path:"/login",query:{redirect:"/vip"}});return}w.value=s.id,J(()=>{document.getElementById("pay").scrollIntoView({behavior:"smooth"})})}let h=m(!1),E=m(""),D=m(),L=m(!1),l=m({code:""}),z=m(!1),T=m(!1);ve(()=>h.value,s=>{s?(clearInterval(D.value),D.value=Ne(()=>{Ue({orderNo:E.value}).then(t=>{t?.success?t.data?.payment_status==="paid"&&(p.success("付款成功"),P.init(),h.value=!1,w.value=void 0):(h.value=!1,p.error(t.msg||"付款失败"))})},1e3),setTimeout(()=>{T.value=!0},3e3)):(clearInterval(D.value),T.value=!1)}),_e(()=>{h.value=!1,clearInterval(D.value)});async function ae(){if(A.value||h.value)return;A.value=!0;let s={plan:w.value,duration:Number(N.value),payment_method:_.value,couponCode:l.value.is_valid?l.value.code:void 0},t=await $e(s);console.log("res",t),t.success?(J(()=>{const x=document.getElementById("payFrame");x.src="about:blank",x.onload=()=>{const b=x.contentWindow.document;b.open(),b.write(t.data.result),b.close()},h.value=!0}),E.value=t.data.orderNo):p.error(t.msg||"付款失败"),A.value=!1}async function ne(){if(z.value)return;z.value=!0;let s=await je({orderNo:E.value});s.success||p.info(s.msg||"未付款"),z.value=!1}let S=m(!1);async function O(){if(L.value){if(!l.value.code)return p.info("请输入优惠券");if(S.value)return;S.value=!0;let s=await Ee(l.value);s.success?s.data.is_valid?l.value=s.data:(l.value={code:l.value.code},p.info("优惠券已失效")):(l.value={code:l.value.code},p.error(s.msg||"优惠券无效")),S.value=!1}else L.value=!0}return(s,t)=>{const x=ze,b=Me,X=Pe,oe=ge,ie=Be;return o(),R(he,null,{default:y(()=>[e("div",qe,[e("div",Qe,[c(xe,{title:"会员介绍"}),e("div",We,[(o(!0),i(q,null,Q(n(I).benefits,a=>(o(),i("div",{class:"text-lg flex items-center",key:a.name},[c(x,{class:"mr-2 text-green-600"}),e("span",null,[e("span",null,r(a.name),1),a.value!=="true"?(o(),i("span",Ge,r(`(${a.value}${a.unit??""})`),1)):d("",!0)])]))),128))])]),k.value?.active?(o(),i("div",Oe,[e("div",Xe,[e("div",Ye,[c(x,{class:"mr-2 text-green-600"}),e("div",null,[e("div",Je,"当前计划："+r(H.value?.name),1),e("div",Ke,"到期时间："+r(K.value),1)])]),e("div",Ze,[k.value.autoRenew?(o(),i("div",et,[e("div",tt,[c(b,{class:"mr-1"}),t[3]||(t[3]=e("span",null,"自动续费已开启",-1))]),c(Ce,{title:"确认取消？",onConfirm:te},{default:y(()=>[c(F,{size:"small",type:"info",loading:n(M)},{default:y(()=>[...t[4]||(t[4]=[V("关闭",-1)])]),_:1},8,["loading"])]),_:1})])):d("",!0)])])])):d("",!0),t[6]||(t[6]=e("div",{class:"flex justify-between"},[e("div",{class:"title"},"选择适合您的套餐"),e("div",{class:"subtitle"},"三种方案，按需选择")],-1)),e("div",st,[(o(!0),i(q,null,Q(j.value,a=>(o(),i("div",{key:a.id,class:"card-white p-0 overflow-hidden flex flex-col"},[e("div",lt,r(a.name),1),e("div",at,[e("div",nt,[e("div",ot,[e("span",it,"¥"+r(a.price),1),e("span",rt,"/ 每"+r(a.unit),1)]),a.highlight?(o(),i("div",ut,r(a.highlight),1)):d("",!0)]),a.autoRenew?(o(),i("div",dt,[c(b,{class:"mr-2"}),t[5]||(t[5]=V(" 开启自动续费，可随时关闭 ",-1))])):d("",!0),c(F,{class:"w-full mt-4",size:"large",type:a.id===H.value?.id||a.id===n(w)?"primary":"info",disabled:a.id===H.value?.id,onClick:re=>le(a)},{default:y(()=>[V(r(se(a)),1)]),_:2},1032,["type","disabled","onClick"])])]))),128))])]),n(w)?(o(),i("div",ct,[t[18]||(t[18]=e("div",{class:"text-center mb-6"},[e("h1",{class:"text-xl font-semibold mb-2"},"安全支付"),e("p",{class:""},"选择支付方式完成订单")],-1)),e("div",mt,[e("div",vt,[e("div",_t,[n(L)?(o(),R(ke,{key:1,modelValue:n(l).code,"onUpdate:modelValue":t[0]||(t[0]=a=>n(l).code=a),placeholder:"请输入优惠券",autofocus:"",clearable:"",onEnter:O},null,8,["modelValue"])):(o(),i("div",ft,[c(X),t[7]||(t[7]=e("span",null,"有优惠券？",-1))])),c(F,{size:"large",loading:n(S),onClick:O},{default:y(()=>[V(r(n(L)?"确定":"在此兑换!"),1)]),_:1},8,["loading"])]),n(l).is_valid?(o(),i("div",pt,[e("div",gt,"优惠券: "+r(n(l).name),1),e("div",ht,[n(l).type==="discount"?(o(),i("span",xt,"折扣券："+r((Number(n(l).value)*10).toFixed(1))+"折",1)):n(l).type==="amount"?(o(),i("span",bt,"立减券：￥"+r(Number(n(l).value).toFixed(2)),1)):n(l).type==="free_trial"?(o(),i("span",yt,"折扣: -100%")):d("",!0),n(l).min_amount||n(l).max_discount?(o(),i("div",wt,[n(l).min_amount?(o(),i("span",kt,"满"+r(Number(n(l).min_amount).toFixed(2))+"元可用",1)):d("",!0),n(l).max_discount&&n(l).type==="discount"?(o(),i("span",Ct," · 最高减"+r(Number(n(l).max_discount).toFixed(2))+"元 ",1)):d("",!0)])):d("",!0)])])):d("",!0)])]),e("div",Nt,[e("div",It,[t[8]||(t[8]=e("div",{class:"text-lg font-medium mb-4"},"选择支付方式",-1)),c(be,{modelValue:n(_),"onUpdate:modelValue":t[1]||(t[1]=a=>W(_)?_.value=a:_=a)},{default:y(()=>[e("div",Vt,[(o(),i(q,null,Q(Z,a=>e("div",{key:a.id,onClick:re=>W(_)?_.value=a.id:_=a.id,class:Y(["flex p-4 border rounded-lg cp transition-all duration-200 hover:bg-item",n(_)===a.id&&"bg-item"])},[e("div",Rt,[a.id==="wechat"?(o(),R(oe,{key:0,class:"text-xl color-green-500"})):(o(),R(ie,{key:1,class:"text-xl color-blue"})),e("div",null,[e("div",Ft,r(a.name),1),e("div",Pt,r(a.description),1)])]),c(ye,{value:a.id,label:""},null,8,["value"])],10,Bt)),64))])]),_:1},8,["modelValue"])]),e("div",At,[t[11]||(t[11]=e("div",{class:"text-lg font-semibold mb-4"},"订单概要",-1)),e("div",Ht,[e("div",Mt,"付费方案（"+r(f.value?.name)+"）订阅",1),e("div",Dt,"从 "+r(ee.value)+" 开始:",1)]),e("div",Lt,[e("div",zt,[e("span",{class:Y(["font-semibold",f.value?.id==="month_auto"?"text-3xl":"text-xl"])}," ￥"+r(f.value?.price),3),e("span",St,"/ "+r(f.value?.unit),1)]),f.value?.id!=="month_auto"?(o(),i("div",$t,[c(we,{min:1,modelValue:n(N),"onUpdate:modelValue":t[2]||(t[2]=a=>W(N)?N.value=a:N=a)},null,8,["modelValue"])])):d("",!0)]),n(l).is_valid?(o(),i("div",jt,[U.value?(o(),i("div",Ut,[e("span",Et,"原价：￥"+r(Number(C.value).toFixed(2)),1),e("span",Tt,"/ "+r(f.value?.unit),1)])):d("",!0),e("div",qt,[U.value?(o(),i("div",Qt,[c(X,{class:"mr-2"}),e("span",null,"已优惠：￥"+r((Number(C.value)-Number(G.value)).toFixed(2)),1)])):(o(),i("span",Wt,"优惠券不可用：未满足条件"))])])):d("",!0),e("div",Gt,[t[9]||(t[9]=e("span",{class:"text-2xl font-semibold"},"总计：",-1)),e("span",Ot,"￥"+r(G.value),1)]),t[12]||(t[12]=e("div",{class:"bg-second text-sm px-4 py-3 rounded-lg mb-4 text-gray-600"}," 会员属于虚拟服务，一经购买激活后不支持退款。请在购买前仔细阅读权益说明，确认符合您的需求再进行支付。 ",-1)),c(F,{class:"w-full",size:"large",loading:n(A)||n(h),type:n(_)?"primary":"info",disabled:!n(_),onClick:ae},{default:y(()=>[...t[10]||(t[10]=[V(" 付款 ",-1)])]),_:1},8,["loading","type","disabled"])]),e("div",Xt,[t[17]||(t[17]=e("div",{class:"text-lg font-semibold mb-4"},"扫码支付",-1)),e("div",Yt,[n(h)?d("",!0):(o(),i("div",Jt,[...t[13]||(t[13]=[e("div",{class:"w-5/10"},"请点击左侧付款按钮后，支付二维码将自动显示",-1)])])),t[15]||(t[15]=e("iframe",{id:"payFrame",class:"w-[205px] h-[205px] center border-none"},null,-1)),t[16]||(t[16]=e("div",{class:"text-center my-4"},"请使用支付宝扫码支付",-1)),n(T)?(o(),R(F,{key:1,size:"large",loading:n(z),onClick:ne},{default:y(()=>[...t[14]||(t[14]=[V(" 我已付款 ",-1)])]),_:1},8,["loading"])):d("",!0)])])])])):d("",!0)]),_:1})}}}),_s=pe(Kt,[["__scopeId","data-v-ab3bc972"]]);export{_s as default};
