import{Y as ke,o as m,c as T,a as o,d as le,aG as we,i as u,z as A,aH as K,k as D,n as ee,bo as G,t as Y,h as U,e as oe,j as ae,X as xe,aE as Le,b7 as Ee,a9 as Be}from"./Dbiv707D.js";import{_ as Ce,a as Ve}from"./Bgfk8J-Z.js";const Te={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function Ae(d,x){return m(),T("svg",Te,[...x[0]||(x[0]=[o("path",{fill:"currentColor",d:"m21.707 20.293l-2.023-2.023A9.57 9.57 0 0 0 21.999 12c0-4.091-2.472-7.453-5.999-9v2c2.387 1.386 3.999 4.047 3.999 7a8.1 8.1 0 0 1-1.672 4.913l-1.285-1.285C17.644 14.536 18 13.19 18 12c0-1.771-.775-3.9-2-5v7.586l-2-2V4a1 1 0 0 0-1.554-.832L7.727 6.313l-4.02-4.02l-1.414 1.414l18 18zM12 5.868v4.718L9.169 7.755zM4 17h2.697l5.748 3.832a1 1 0 0 0 1.027.05A1 1 0 0 0 14 20v-1.879l-2-2v2.011l-4.445-2.964c-.025-.017-.056-.02-.082-.033a1 1 0 0 0-.382-.116C7.059 15.016 7.032 15 7 15H4V9h.879L3.102 7.223A2 2 0 0 0 2 9v6c0 1.103.897 2 2 2"},null,-1)])])}const Pe=ke({name:"bx-volume-mute",render:Ae}),$e=["src","autoplay","loop"],Se={class:"audio-container"},Ye=["disabled","aria-label"],Ue={key:0,class:"loading-spinner"},Xe={key:1,class:"icon",viewBox:"0 0 24 24",fill:"currentColor"},Ie={key:2,class:"icon",viewBox:"0 0 24 24",fill:"currentColor"},Fe={class:"progress-section"},ze={class:"progress-track"},De={class:"time-display"},Oe=["disabled","aria-label"],He={class:"volume-track"},je={class:"volume-num"},qe=["disabled","aria-label"],Ne={key:0,class:"error-message"},Ge=le({__name:"Audio",props:{src:null,autoplay:{type:Boolean,default:!1},loop:{type:Boolean,default:!1},volume:{default:1},currentTime:{default:0},playbackRate:{default:1},disabled:{type:Boolean,default:!1}},emits:["ended","update-volume","update-speed"],setup(d,{expose:x,emit:O}){const s=d,g=O,L=we(),e=u(),f=u(),R=u(),P=u(),p=u(!1),l=u(!1),t=u(0),r=u(0),c=u(s.volume),b=u(s.playbackRate),X=u(!1),I=u(!1),H=u(!1),j=u("top"),M=u(""),J=ae(()=>t.value>0?r.value/t.value*100:0),Q=ae(()=>c.value*100),W=a=>{if(!isFinite(a))return"0:00";const n=Math.floor(a/60),v=Math.floor(a%60);return`${n}:${v.toString().padStart(2,"0")}`},se=async()=>{if(!(!e.value||s.disabled))try{p.value?e.value.pause():await e.value.play()}catch(a){console.error("播放失败:",a),M.value="播放失败"}},ne=()=>{!e.value||s.disabled||(c.value>0?(c.value=0,e.value.volume=0):(c.value=1,e.value.volume=1),g("update-volume",Math.floor(c.value*100)))},ue=()=>{if(!e.value||s.disabled)return;const a=[.5,.75,1,1.25,1.5,2],v=(a.indexOf(b.value)+1)%a.length;b.value=a[v],e.value.playbackRate=b.value,g("update-speed",b.value)},ie=()=>{l.value=!0},re=()=>{l.value=!1},ce=()=>{e.value&&(e.value.volume=c.value),t.value=e.value?.duration||0},de=()=>{},ve=()=>{p.value=!0},me=()=>{p.value=!1},fe=()=>{p.value=!1,r.value=0,g("ended")},pe=()=>{M.value="音频加载失败",l.value=!1},he=()=>{e.value&&!X.value&&(r.value=e.value.currentTime)},ge=()=>{e.value&&!I.value&&(c.value=e.value.volume)},ye=()=>{e.value&&(b.value=e.value.playbackRate)},be=a=>{if(!e.value||!f.value||s.disabled)return;a.preventDefault(),a.stopPropagation();const n=f.value.getBoundingClientRect(),v=a.clientX,k=a.clientY;let y=!1,_=0;const $=3,i=f.value.querySelector(".progress-fill"),h=f.value.querySelector(".progress-thumb"),E=a.clientX-n.left,B=Math.max(0,Math.min(1,E/n.width)),C=B*t.value;i&&h&&(i.style.width=`${B*100}%`,h.style.left=`${B*100}%`),e.value.currentTime=C,r.value=C,_=C,X.value=!0;const V=S=>{const z=Math.abs(S.clientX-v),q=Math.abs(S.clientY-k);if((z>$||q>$)&&(y=!0),!y)return;i&&h&&(i.style.transition="none",h.style.transition="none");const w=f.value.getBoundingClientRect(),Me=S.clientX-w.left,N=Math.max(0,Math.min(1,Me/w.width)),Z=N*t.value;i&&h&&(i.style.width=`${N*100}%`,h.style.left=`${N*100}%`),r.value=Z,_=Z},F=()=>{X.value=!1,i&&h&&(i.style.transition="",h.style.transition=""),y&&e.value&&(e.value.currentTime=_),document.removeEventListener("mousemove",V),document.removeEventListener("mouseup",F)};document.addEventListener("mousemove",V),document.addEventListener("mouseup",F)},_e=a=>{if(!e.value||!R.value||s.disabled)return;a.preventDefault(),a.stopPropagation();const n=R.value.getBoundingClientRect(),v=a.clientX,k=a.clientY;let y=!1,_=0;const $=3,i=P.value,h=a.clientY-n.top,E=1-Math.max(0,Math.min(1,h/n.height));i&&(i.style.height=`${E*100}%`),c.value=E,e.value.volume=E,_=E,I.value=!0;const B=V=>{const F=Math.abs(V.clientX-v),S=Math.abs(V.clientY-k);if((F>$||S>$)&&(y=!0),!y)return;i&&(i.style.transition="none");const z=R.value.getBoundingClientRect(),q=V.clientY-z.top,w=1-Math.max(0,Math.min(1,q/z.height));i&&(i.style.height=`${w*100}%`),c.value=w,_=w,e.value&&(e.value.volume=w)},C=()=>{I.value=!1,i&&(i.style.transition=""),y&&e.value&&(e.value.volume=_),g("update-volume",Math.floor(c.value*100)),document.removeEventListener("mousemove",B),document.removeEventListener("mouseup",C)};document.addEventListener("mousemove",B),document.addEventListener("mouseup",C)},Re=a=>{H.value=!0;const n=a.target,v=n.getBoundingClientRect().top+window.scrollY,k=n.querySelector(".volume-dropdown").clientHeight;v<k*1.25?j.value="down":j.value="top"};return A(()=>s.src,a=>{e.value&&(p.value=!1,l.value=!1,r.value=0,t.value=0,M.value="",a?(e.value.src=a,e.value.load()):(e.value.src="",e.value.load()))}),A(()=>s.volume,a=>{c.value=a,e.value&&(e.value.volume=a)}),A(()=>s.currentTime,a=>{e.value&&!X.value&&(e.value.currentTime=a,r.value=a)}),A(()=>s.playbackRate,a=>{b.value=a,e.value&&(e.value.playbackRate=a)}),x({audioRef:e}),(a,n)=>{const v=Pe,k=Ce,y=Ve;return m(),T("div",K({class:["custom-audio",{disabled:d.disabled||M.value,"has-error":M.value}]},D(L)),[o("audio",{ref_key:"audioRef",ref:e,src:d.src,preload:"auto",autoplay:d.autoplay,loop:d.loop,controls:!1,onLoadstart:ie,onLoadeddata:re,onLoadedmetadata:ce,onCanplaythrough:de,onPlay:ve,onPause:me,onEnded:fe,onError:pe,onTimeupdate:he,onVolumechange:ge,onRatechange:ye},null,40,$e),o("div",Se,[o("button",{class:ee(["play-button",{loading:l.value}]),onClick:se,disabled:d.disabled,"aria-label":p.value?"暂停":"播放"},[l.value?(m(),T("div",Ue)):p.value?(m(),T("svg",Xe,[...n[1]||(n[1]=[o("path",{d:"M6 4h4v16H6V4zm8 0h4v16h-4V4z"},null,-1)])])):(m(),T("svg",Ie,[...n[2]||(n[2]=[o("path",{d:"M8 5v14l11-7z"},null,-1)])]))],10,Ye),o("div",Fe,[o("div",{class:"progress-container",onMousedown:be,ref_key:"progressBarRef",ref:f},[o("div",ze,[o("div",{class:"progress-fill",style:G({width:J.value+"%"})},null,4),o("div",{class:"progress-thumb",style:G({left:J.value+"%"})},null,4)])],544),o("span",De,Y(W(r.value))+" / "+Y(W(t.value)),1)]),o("div",{class:"volume-section",onMouseenter:Re,onMouseleave:n[0]||(n[0]=_=>H.value=!1)},[o("button",{class:"volume-button",tabindex:"-1",onClick:ne,disabled:d.disabled,"aria-label":c.value>0?"静音":"取消静音"},[c.value===0?(m(),U(v,{key:0,class:"icon"})):c.value<.5?(m(),U(k,{key:1,class:"icon"})):(m(),U(y,{key:2,class:"icon"}))],8,Oe),o("div",{class:ee(["volume-dropdown",[{active:H.value||I.value},j.value]])},[o("div",{class:"volume-container",onMousedown:_e,ref_key:"volumeBarRef",ref:R},[o("div",He,[o("div",{class:"volume-fill",ref_key:"volumeFillRef",ref:P,style:G({height:Q.value+"%",bottom:0})},null,4)]),o("div",je,[o("span",null,Y(Math.floor(Q.value))+"%",1)])],544)],2)],32),o("button",{class:"speed-button",onClick:ue,disabled:d.disabled,"aria-label":`播放速度: ${b.value}x`},Y(b.value)+"x ",9,qe)]),M.value?(m(),T("div",Ne,Y(M.value),1)):oe("",!0)],16)}}}),te=Object.assign(xe(Ge,[["__scopeId","data-v-86c16858"]]),{__name:"Audio"}),Ke=le({__name:"ArticleAudio",props:{article:null},emits:["ended","update-volume","update-speed"],setup(d,{expose:x,emit:O}){const s=d,g=O;let L=u(null),e=u({audioRef:null});const f=u({}),R=l=>{g("update-volume",l)},P=l=>{g("update-speed",l)},p=(l,t)=>{if(e.value?.audioRef)switch(l){case"currentTime":e.value.audioRef.currentTime=t;break;case"volume":e.value.audioRef.volume=t;break;case"playbackRate":e.value.audioRef.playbackRate=t;break}else f.value[l]=t};return A(()=>s.article.audioFileId,async()=>{if(!s.article.audioSrc&&s.article.audioFileId){let l=await Le(Be);if(l){let t=l.find(r=>r.id===s.article.audioFileId);t&&(L.value=URL.createObjectURL(t.file))}}else L.value=null},{immediate:!0}),A(()=>e.value,l=>{Object.entries(f.value).forEach(([t,r])=>{p(t,r)}),f.value={}},{immediate:!0}),x(new Proxy({currentTime:0,played:!1,src:"",volume:0,playbackRate:1,play:()=>{},pause:()=>{}},{get(l,t){return t==="currentTime"?e.value?.audioRef?.currentTime:t==="played"?e.value?.audioRef?.played:t==="src"?e.value?.audioRef?.src:t==="volume"?e.value?.audioRef?.volume:t==="playbackRate"?e.value?.audioRef?.playbackRate:(t==="play"&&e.value?.audioRef?.play(),t==="pause"&&e.value?.audioRef?.pause(),l[t])},set(l,t,r){return p(t,r),!0}})),(l,t)=>s.article.audioSrc?(m(),U(te,K({key:0},l.$attrs,{ref_key:"instance",ref:e,src:D(Ee).RESOURCE_URL+s.article.audioSrc,onEnded:t[0]||(t[0]=r=>g("ended")),onUpdateVolume:R,onUpdateSpeed:P}),null,16,["src"])):D(L)?(m(),U(te,K({key:1},l.$attrs,{ref_key:"instance",ref:e,src:D(L),onEnded:t[1]||(t[1]=r=>g("ended")),onUpdateVolume:R,onUpdateSpeed:P}),null,16,["src"])):oe("",!0)}}),We=Object.assign(Ke,{__name:"ArticleAudio"});export{We as A};
