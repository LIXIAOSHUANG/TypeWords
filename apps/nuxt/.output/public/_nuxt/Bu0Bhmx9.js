import{Y as ee,o as w,c as k,a as o,d as Y,f as d,l as C,k as r,w as g,bz as te,F as le,r as ie,n as ae,m as se,a2 as q,i as x,j as re,bA as ne,a4 as V,X as Q,R as oe,bh as $,V as de,t as E,e as K,b as B,a5 as h,aP as P,a7 as G,a8 as O}from"./CL2Zm6Gn.js";import{B as A}from"./DrXBYfFo.js";import{_ as ue}from"./DUu00FKn.js";import{B as W}from"./oY8pmwEW.js";import{D as ce}from"./B_stZ-MH.js";import{B as me}from"./CyxMrWnv.js";import{c as fe}from"./BIONxxX3.js";import{M as H}from"./BKClUODy.js";import{E as pe,s as N}from"./NcGl_TqB.js";import{B as ve}from"./CgcP0R2m.js";import{M as ge}from"./QnX__4Tr.js";import"./1RI2pLfA.js";import"./CGgiZe4D.js";import"./GulbbN7M.js";import"./CaxuGJ2z.js";import"./D3s8KrHR.js";import"./C37SsQJU.js";import"./B23dpBb2.js";import"./BqBkRU00.js";import"./DTF4rsmH.js";import"./qEnmgki7.js";import"./CGx_iWmd.js";import"./CMZAKU7l.js";import"./DUCa_d2x.js";import"./CJHy64iq.js";import"./CAPmeoOz.js";import"./DBw7vsOg.js";const xe={viewBox:"0 0 20 20",width:"1.2em",height:"1.2em"};function _e(X,i){return w(),k("svg",xe,[...i[0]||(i[0]=[o("path",{fill:"currentColor",d:"M10.354 2.146a.5.5 0 0 0-.708 0l-2.5 2.5a.5.5 0 1 0 .708.708L9.5 3.707V7.5a.5.5 0 0 0 1 0V3.707l1.646 1.647a.5.5 0 0 0 .708-.708zm-8.208 7.5a.5.5 0 0 0 0 .708l2.5 2.5a.5.5 0 0 0 .708-.708L3.707 10.5H7.5a.5.5 0 0 0 0-1H3.707l1.647-1.646a.5.5 0 1 0-.708-.708zM10 18a.5.5 0 0 1-.354-.146l-2.5-2.5a.5.5 0 0 1 .708-.708L9.5 16.293V12.5a.5.5 0 0 1 1 0v3.793l1.646-1.647a.5.5 0 0 1 .708.708l-2.5 2.5A.5.5 0 0 1 10 18m7.854-7.646a.5.5 0 0 0 0-.708l-2.5-2.5a.5.5 0 0 0-.708.708L16.293 9.5H12.5a.5.5 0 0 0 0 1h3.793l-1.647 1.646a.5.5 0 0 0 .708.708z"},null,-1)])])}const De=ee({name:"fluent-arrow-move20-regular",render:_e}),Se={class:"search"},ye=["onClick","draggable","onDragstart","onDragenter"],Ie={class:"left"},he={class:"right"},we=Y({__name:"List",props:{list:null,selectItem:null},emits:["selectItem","delSelectItem","update:searchKey","update:list"],setup(X,{expose:i,emit:n}){const c=X,y=n;let _=x({id:""}),D=x(""),m=x(!1),S=re({get(){return D.value?c.list.filter(t=>D.value.toLowerCase().split(" ").filter(e=>e).some(e=>t.title.toLowerCase().includes(e)||t.titleTranslate.toLowerCase().includes(e))):c.list},set(t){y("update:list",t)}});function F(t){_.value=t}const v=ne((t,e)=>{if(t.preventDefault(),_.value.id&&_.value.id!==e.id){let l=c.list.findIndex(p=>p.id===_.value.id),f=c.list.findIndex(p=>p.id===e.id),a=V(c.list);a.splice(l,1),a.splice(f,0,V(_.value)),S.value=a}},300);function L(t){t.preventDefault()}function b(){m.value=!1,_.value={id:""}}function j(t){t.id===c.selectItem.id&&y("delSelectItem");let e=c.list.findIndex(l=>l.id===t.id);e>-1&&(S.value.splice(e,1),S.value=S.value)}let T=x();function z(){T.value.scrollTo({top:T.value.scrollHeight,left:0,behavior:"smooth"})}return i({scrollBottom:z}),(t,e)=>{const l=ue,f=De;return w(),k("div",{class:"list-wrapper",ref_key:"el",ref:T},[o("div",Se,[d(me,{clearable:"",modelValue:r(D),"onUpdate:modelValue":e[0]||(e[0]=a=>C(D)?D.value=a:D=a)},{subfix:g(()=>[d(l,{class:"text-lg text-gray"})]),_:1},8,["modelValue"])]),d(te,{name:"drag",class:"space-y-3",tag:"div"},{default:g(()=>[(w(!0),k(le,null,ie(r(S),(a,p)=>(w(),k("div",{class:ae(["common-list-item",[X.selectItem.id===a.id&&"active",r(m)&&"draggable",r(_).id===a.id&&"active"]]),onClick:u=>y("selectItem",a),key:a.id,draggable:r(m),onDragstart:u=>F(a),onDragenter:u=>r(v)(u,a),onDragover:e[3]||(e[3]=u=>L(u)),onDragend:e[4]||(e[4]=u=>b())},[o("div",Ie,[se(t.$slots,"default",{item:a,index:p},void 0,!0)]),o("div",he,[d(W,{onClick:q(u=>j(a),["stop"]),title:t.$t("delete")},{default:g(()=>[d(ce)]),_:1},8,["onClick","title"]),o("div",{onMousedown:e[1]||(e[1]=u=>C(m)?m.value=!0:m=!0),onMouseup:e[2]||(e[2]=u=>C(m)?m.value=!1:m=!1)},[d(W,null,{default:g(()=>[d(f)]),_:1})],32)])],42,ye))),128))]),_:3})],512)}}}),ke=Object.assign(Q(we,[["__scopeId","data-v-a55ab5a2"]]),{__name:"List"}),Le={class:"add-article"},be={class:"aslide"},Te={class:"flex gap-2 items-center"},Be={class:"text-xl"},Ce={class:"name"},$e={key:0,class:"text-sm text-gray-500"},Ae={class:"translate-name"},Ve={key:0,class:"add"},Xe={class:"footer"},Me={class:"import"},Re={class:"flex"},Ee=Y({__name:"batch-edit-article",setup(X){const i=oe();let n=x($()),c=x(),y=x();async function _(t){await D()&&(n.value=V(t))}function D(){return new Promise(t=>{let e=c.value.getEditArticle();if(e.id!=="-1"){if(e.title=e.title.trim(),e.titleTranslate=e.titleTranslate.trim(),e.text=e.text.trim(),e.textTranslate=e.textTranslate.trim(),e.title!==n.value.title||e.titleTranslate!==n.value.titleTranslate||e.text!==n.value.text||e.textTranslate!==n.value.textTranslate)return H.confirm("检测到数据有变动，是否保存？","提示",async()=>{await c.value.save("save")&&t(!0)},()=>t(!0))}else if(e.title.trim()&&e.text.trim())return H.confirm("检测到数据有变动，是否保存？","提示",async()=>{await c.value.save("save")&&t(!0)},()=>t(!0));t(!0)})}async function m(){await D()&&(n.value=$())}function S(t){if(t.id){let e=i.editDict.articles.findIndex(l=>l.id===t.id);e>-1&&(i.editDict.articles[e]=V(t))}else{if(i.editDict.articles.find(l=>l.title===t.title))return h.error("已存在同名文章！"),!1;t.id=P(6),i.editDict.articles.push(t),setTimeout(()=>{y.value.scrollBottom()})}return n.value=V(t),h.success("保存成功！"),N(),!0}function F(t){S(t)&&m()}let v=x(!1);fe(()=>v.value=!1),de(()=>{i.editDict.articles.length&&(n.value=i.editDict.articles[0])});let L=x(!1),b=x(!1);function j(t){let e=t.target.files[0];if(!e)return;let l=new FileReader;l.onload=async function(f){b.value=!0;const a=await G("XLSX",O.XLSX);let p=f.target.result,u=a.read(p,{type:"binary"}),M=a.utils.sheet_to_json(u.Sheets.Sheet1);if(M.length){let I=M.map(s=>{if(s.原文标题&&s.原文正文)return $({id:P(6),title:String(s.原文标题),titleTranslate:String(s.译文标题),text:String(s.原文正文),textTranslate:String(s.译文正文),audioSrc:String(s.音频地址)})}).filter(s=>s),R=[],U=[];I.map(s=>{let J=i.editDict.articles.findIndex(Z=>Z.title===s.title);J>-1?(s.index=J,R.push(s)):U.push(s)}),i.editDict.articles=i.editDict.articles.concat(U),R.length?H.confirm('文章"'+R.map(s=>s.title).join(", ")+'" 已存在，是否覆盖原有文章？',"检测到重复文章",()=>{R.map(s=>{i.editDict.articles[s.index]=s,delete i.editDict.articles[s.index].index}),setTimeout(y.value?.scrollToBottom,100)},null,()=>{t.target.value="",b.value=!1,N(),h.success("导入成功！")}):(N(),h.success("导入成功！"))}else h.success("导入失败！原因：没有数据");t.target.value="",b.value=!1},l.readAsBinaryString(e)}async function T(t){L.value=!0;const e=await G("XLSX",O.XLSX),{type:l,data:f}=t;let a=[],p="";if(l==="item"){if(!f.id)return h.error("请选择文章");a=[f],p=i.editDict.name+`-${f.title}`}else a=i.editDict.articles,p=i.editDict.name;let u=e.utils.book_new(),M=a.map(I=>({原文标题:I.title,原文正文:I.text,译文标题:I.titleTranslate,译文正文:I.textTranslate,音频地址:I.audioSrc}));u.Sheets.Sheet1=e.utils.json_to_sheet(M),u.SheetNames=["Sheet1"],e.writeFile(u,`${p}.xlsx`),h.success(p+" 导出成功！"),v.value=!1,L.value=!1}function z(t){i.editDict.articles=t,N()}return(t,e)=>(w(),k("div",Le,[o("div",be,[o("header",Te,[d(ve),o("div",Be,E(r(i).editDict.name),1)]),d(ke,{ref_key:"listEl",ref:y,list:r(i).editDict.articles,"onUpdate:list":z,"select-item":r(n),onDelSelectItem:e[0]||(e[0]=l=>C(n)?n.value=r($)():n=r($)()),onSelectItem:_},{default:g(({item:l,index:f})=>[o("div",null,[o("div",Ce,[f!=null?(w(),k("span",$e,E(f+1)+". ",1)):K("",!0),B(" "+E(l.title),1)]),o("div",Ae,E(`   ${l.titleTranslate}`),1)])]),_:1},8,["list","select-item"]),r(n).title?K("",!0):(w(),k("div",Ve,"正在添加新文章...")),o("div",Xe,[o("div",Me,[d(A,{loading:r(b)},{default:g(()=>[...e[5]||(e[5]=[B("导入",-1)])]),_:1},8,["loading"]),o("input",{type:"file",accept:".csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel",onChange:j},null,32)]),o("div",{class:"export",style:{position:"relative"},onClick:q(l=>null,["stop"])},[d(A,{onClick:e[1]||(e[1]=l=>C(v)?v.value=!0:v=!0)},{default:g(()=>[...e[6]||(e[6]=[B("导出",-1)])]),_:1}),d(ge,{modelValue:r(v),"onUpdate:modelValue":e[4]||(e[4]=l=>C(v)?v.value=l:v=l),style:{width:"8rem",bottom:"calc(100% + 1rem)",top:"unset"}},{default:g(()=>[e[9]||(e[9]=o("div",{class:"mini-row-title"},"导出选项",-1)),o("div",Re,[d(A,{loading:r(L),onClick:e[2]||(e[2]=l=>T({type:"all"}))},{default:g(()=>[...e[7]||(e[7]=[B("全部",-1)])]),_:1},8,["loading"]),d(A,{loading:r(L),disabled:!r(n).id,onClick:e[3]||(e[3]=l=>T({type:"item",data:r(n)}))},{default:g(()=>[...e[8]||(e[8]=[B("当前 ",-1)])]),_:1},8,["loading","disabled"])])]),_:1},8,["modelValue"])]),d(A,{onClick:m},{default:g(()=>[...e[10]||(e[10]=[B("新增",-1)])]),_:1})])]),d(pe,{ref_key:"editArticleRef",ref:c,type:"batch",onSave:S,onSaveAndNext:F,article:r(n)},null,8,["article"])]))}}),ct=Q(Ee,[["__scopeId","data-v-73f1e089"]]);export{ct as default};
