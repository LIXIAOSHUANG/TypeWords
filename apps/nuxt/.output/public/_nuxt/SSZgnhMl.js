import{B as te}from"./Cs5B2yJA.js";import{B as N}from"./DrXBYfFo.js";import{V as oe}from"./CJKjSNvS.js";import{d as re,ap as se,S as ne,$ as ae,R as le,bl as w,Z as de,V as ie,o as p,h as ce,w as B,a as l,t as f,k as s,c as h,f as k,F as P,r as R,n as ue,b,e as $,i as v,aK as fe,a5 as D,aT as E,X as we}from"./CL2Zm6Gn.js";import{u as pe,a as me,b as he}from"./qEnmgki7.js";import{a as ge,b as Ce}from"./BIONxxX3.js";import"./CAPmeoOz.js";import"./oY8pmwEW.js";const xe={class:"card flex flex-col"},ye={class:"flex items-center justify-between"},_e={class:"page-title"},be={class:"text-base"},ve={key:0,class:"flex flex-col gap-4"},Le={class:"text-2xl en-article-family flex items-center gap-2"},Be={class:"grid gap-2"},ke=["onClick"],Se={class:"italic"},Me={key:0,class:"mt-4"},je={class:"grid gap-2 grid-cols-1 md:grid-cols-3"},Ke={class:"en-article-family text-lg"},Ie={class:"mt-1 text-sm"},Oe={class:"mt-6 flex"},Ve=re({__name:"[id]",setup(Ae){const W=se(),S=ne(),m=ae(),M=le(),q=pe(),z=me(),F=he();let j=v(!1),g=v(),d=v([]),i=v(0);function C(r,e){return e.find(t=>t.word.toLowerCase()===r.toLowerCase())}function K(r,e){let n=r.relWords?.rels||[];for(let t=0;t<n.length;t++)for(let o=0;o<n[t].words.length;o++){let u=n[t].words[o].c,a=C(u,e);if(a&&a.word.toLowerCase()!==r.word.toLowerCase())return{word:a.word,wordObj:a}}return null}function I(r,e){let n=r.synos||[];for(let t=0;t<n.length;t++)for(let o=0;o<n[t].ws.length;o++){let u=n[t].ws[o],a=C(u,e);if(a&&a.word.toLowerCase()!==r.word.toLowerCase())return{word:a.word,wordObj:a}}return null}function O(r,e){let n=(r.trans?.[0]?.pos||"").trim(),t=e.filter(o=>o.word.toLowerCase()!==r.word.toLowerCase()&&o.trans?.some(u=>u.pos===n));if(t.length){let o=t[Math.floor(Math.random()*t.length)];return{word:o.word,wordObj:o}}return null}function Z(r,e){let n=[];n.push({word:r.word,wordObj:r});let t=K(r,e)||I(r,e)||O(r,e),o=null,u=new Set([r.word.toLowerCase()]);t&&u.add(t.word.toLowerCase());let a=0;for(;!o&&a<5;)o=I(r,e)||O(r,e)||K(r,e),o&&u.has(o.word.toLowerCase())&&(o=null),a++;if(!t){let c=e.filter(_=>_.word.toLowerCase()!==r.word.toLowerCase());c.length&&(t={word:c[Math.floor(Math.random()*c.length)].word,wordObj:C(c[Math.floor(Math.random()*c.length)].word,e)})}if(!o){let c=e.filter(_=>_.word.toLowerCase()!==r.word.toLowerCase()&&_.word.toLowerCase()!==t?.word.toLowerCase());c.length&&(o={word:c[Math.floor(Math.random()*c.length)].word,wordObj:C(c[Math.floor(Math.random()*c.length)].word,e)})}t&&n.push(t),o&&n.push(o);const L=n.map(c=>Q(c)),T=E([0,1,2]),Y=T.map(c=>L[c]),ee=T.indexOf(0);return{stem:r,candidates:n,optionTexts:Y,correctIndex:ee,selectedIndex:-1,submitted:!1}}function Q(r){const e=r.wordObj;if(!e||!e.trans||!e.trans.length)return"当前词典未收录释义";const n=(o,u)=>{let a=o||"";a=a.replace(/（[^）]*[A-Za-z][^）]*）/g,""),a=a.replace(/(时\s*态|过去式|过去分词|现在分词|复数|第三人称|比较级|最高级)[:：].*/g,"");const L=u.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");return a=a.replace(new RegExp(L,"gi"),""),a=a.replace(/[;；]\s*/g,"；"),a=a.trim(),a},t=e.trans.map(o=>{const u=(o.pos||"").trim(),a=n(o.cn||"",e.word);return/^\s*【名】/.test(o.cn||"")||!a?"":`${u?"- "+u+" ":"- "}${a}`}).filter(Boolean);return t.length?t.join("；"):"当前词典未收录释义"}async function U(){let r=W.params.id,e=m.word.bookList.find(t=>t.id===r);if(e||(e=m.sdict),!e?.id)return S.push("/words");if(!e.words.length&&M.editDict?.id===e.id&&(j.value=!0,e=await fe(M.editDict),j.value=!1),g.value=e,!g.value.words.length)return D.warning("没有单词可测试！");const n=E(g.value.words);d.value=n.map(t=>Z(t,g.value.words)),i.value=0,D.info("可以按快捷键进行选择,例如按快捷键["+A+"]选择A",{duration:3e3})}function x(r){let e=d.value[i.value];if(!(!e||e.submitted))if(e.selectedIndex=r,e.submitted=!0,r===e.correctIndex)z();else{q();let n=e.stem.word.toLowerCase();m.wrong.words.find(t=>t.word.toLowerCase()===n)||(m.wrong.words.push(e.stem),m.wrong.length=m.wrong.words.length)}}function V(){i.value<d.value.length-1&&i.value++}function X(){S.back()}ge(),Ce([[w.ChooseA,()=>x(0)],[w.ChooseB,()=>x(1)],[w.ChooseC,()=>x(2)],[w.Next,()=>V()]]);const y=de();let A=y.shortcutKeyMap[w.ChooseA],G=y.shortcutKeyMap[w.ChooseB],H=y.shortcutKeyMap[w.ChooseC],J=y.shortcutKeyMap[w.Next];return ie(U),(r,e)=>(p(),ce(te,null,{default:B(()=>[l("div",xe,[l("div",ye,[l("div",_e,"测试："+f(s(g)?.name),1),l("div",be,f(s(i)+1)+" / "+f(s(d).length),1)]),e[4]||(e[4]=l("div",{class:"line my-2"},null,-1)),s(d).length?(p(),h("div",ve,[l("div",Le,[l("span",null,"题目："+f(s(d)[s(i)].stem.word),1),k(oe,{simple:!0,title:"发音",cb:()=>s(F)(s(d)[s(i)].stem.word)},null,8,["cb"])]),e[3]||(e[3]=l("div",{style:{height:"20px"}},null,-1)),l("div",Be,[(p(!0),h(P,null,R(s(d)[s(i)].optionTexts,(n,t)=>(p(),h("div",{key:t,class:ue(["option border rounded p-2 cursor-pointer",{"text-green-600":s(d)[s(i)].submitted&&t===s(d)[s(i)].correctIndex,"text-red-600":s(d)[s(i)].submitted&&t===s(d)[s(i)].selectedIndex&&t!==s(d)[s(i)].correctIndex}]),onClick:o=>x(t)},[l("span",null,[l("span",Se,f(["A","B","C"][t]),1),e[0]||(e[0]=b(" [",-1)),l("span",null,f([s(A),s(G),s(H)][t]),1),b("] "+f(n),1)])],10,ke))),128))]),s(d)[s(i)].submitted?(p(),h("div",Me,[e[1]||(e[1]=l("div",{class:"mb-2 text-base"},"选项解析：",-1)),l("div",je,[(p(!0),h(P,null,R(s(d)[s(i)].candidates,(n,t)=>(p(),h("div",{key:t,class:"p-2 rounded bg-[--bg-card-secend]"},[l("div",Ke,f(n.word),1),l("div",Ie,f(n.wordObj?.trans?.map(o=>o.cn).join("；")||"当前词典未收录释义"),1)]))),128))])])):$("",!0),l("div",Oe,[k(N,{type:"primary",onClick:V},{default:B(()=>[b("继续测试["+f(s(J))+"]",1)]),_:1}),k(N,{type:"info",onClick:X},{default:B(()=>[...e[2]||(e[2]=[b("结束",-1)])]),_:1})])])):$("",!0)])]),_:1}))}}),qe=we(Ve,[["__scopeId","data-v-453c0006"]]);export{qe as default};
