import{_ as ee}from"./BACXl5qE.js";import{d as te,aF as u,aZ as se,Q as oe,$ as T,Z as ae,S as ie,R as le,z as R,aL as re,a_ as ne,aK as ce,bc as de,ag as ue,V as fe,a$ as me,ar as A,o as r,h as b,w as y,k as a,c as f,b as j,a as t,e as S,t as l,F as D,r as I,n as be,as as N,f as k,l as P,i as w,a5 as B,U as ke,j as $,bd as M,be as F,a7 as pe,a8 as _e,aR as H,aN as ge,b3 as he,b4 as ve,A as xe,X as ye}from"./CL2Zm6Gn.js";import{P as we}from"./1uBJJONf.js";import{B as $e}from"./DrXBYfFo.js";import{B as Ce}from"./oY8pmwEW.js";import{B as Se}from"./Cs5B2yJA.js";import{B as g}from"./9_JevA4B.js";import{D as De}from"./B_stZ-MH.js";import{P as Ie}from"./BKxkpCP1.js";import{b as Be}from"./CmInly2L.js";import{u as Le}from"./HGrSXmWk.js";import{i as Ee,a as Te}from"./BD87t9DM.js";import"./CMZAKU7l.js";import"./5Q5X2q0H.js";import"./CA9m3cH7.js";const Re={key:0,class:"mb-4"},Ae={class:"card flex flex-col md:flex-row justify-between gap-space p-4 md:p-6"},je={class:""},Ne={class:"flex-1"},Pe={class:"flex justify-between items-start"},Me={class:"flex items-center min-w-0"},Fe={class:"title mr-4 truncate"},He={class:"flex gap-4 color-gray"},Oe={class:"flex gap-4 items-center"},We={class:"flex flex-col sm:flex-row gap-3 items-center mt-3 gap-space w-full"},ze={class:"w-full sm:flex-1 rounded-xl p-4 box-border relative bg-[var(--bg-history)] border border-gray-200"},Ve={class:"text-[#409eff] text-xl font-bold"},Ue={class:"text-gray-500"},Ye={class:"w-full sm:flex-1 rounded-xl p-4 box-border relative bg-[var(--bg-history)] border border-gray-200"},qe={class:"text-[#409eff] text-xl font-bold"},Je={class:"text-gray-500"},Qe={class:"w-full sm:flex-1 rounded-xl p-4 box-border relative bg-[var(--bg-history)] border border-gray-200"},Ze={class:"text-[#409eff] text-xl font-bold"},Ke={class:"text-gray-500"},Xe={class:"flex gap-3 mt-3"},Ge={class:"flex items-center gap-2 justify-center w-full"},et={class:"line-height-[2]"},tt={class:"card flex flex-col"},st={class:"flex justify-between"},ot={class:"title"},at={class:"flex gap-4 items-center"},it={class:"flex gap-4 flex-wrap mt-4"},lt={class:"card flex flex-col min-h-50"},rt={class:"flex justify-between"},nt={class:"title"},ct={class:"flex gap-4 items-center"},dt={class:"flex gap-4 flex-wrap mt-4"},ut=te({__name:"articles",setup(ft){u.extend(Ee),u.extend(Te),se({title:xe+" 文章"});const{nav:h}=oe(),s=T(),n=T(),O=ae(),v=ie(),W=le();let L=w(!1);R(()=>n.load,e=>{e&&z()},{immediate:!0});async function z(){if(re.CAN_REQUEST){let o=await ne({type:"article"});o.success&&n.setState(Object.assign(n.$state,o.data))}n.article.studyIndex>=1&&!n.sbook.custom&&!n.sbook.articles.length&&(n.article.bookList[n.article.studyIndex]=await ce(n.sbook,de.article)),Be()&&(L.value=!0)}R(()=>n?.sbook?.id,e=>{e||ue(async()=>{const o=await pe("Shepherd",_e.SHEPHERD),c=new o.Tour(H);c.on("cancel",()=>{localStorage.setItem("tour-guide","1")}),c.addStep({id:"step7",text:"点击这里选择一本书籍开始学习，步骤前面选词典相同，让我们跳过中间步骤，直接开始练习吧",attachTo:{element:"#no-book",on:"bottom"},buttons:[{text:`下一步（7/${H.total}）`,action(){c.next(),h("/practice-articles/article_nce2",{guide:1})}}]});const p=localStorage.getItem("tour-guide");O.first&&!p&&!ge()&&c.start()},500)},{immediate:!0});function V(){if(s.sbook.id){if(!s.sbook.articles.length)return B.warning("没有文章可学习！");window.umami?.track("startStudyArticle",{name:s.sbook.name,custom:s.sbook.custom,complete:s.sbook.complete,s:`name:${s.sbook.name},index:${s.sbook.lastLearnIndex},title:${s.sbook.articles[s.sbook.lastLearnIndex].title}`}),h("/practice-articles/"+n.sbook.id)}else window.umami?.track("no-book"),B.warning("请先选择一本书籍")}let m=w(!1),d=w([]);function U(){d.value.forEach(e=>{let o=s.article.bookList.findIndex(c=>c.id===e);o!==-1&&(s.article.studyIndex===o&&(s.article.studyIndex=-1),s.article.studyIndex>o&&s.article.studyIndex--,s.article.bookList.splice(o,1))}),d.value=[],B.success("删除成功！")}function Y(e){let o=d.value.findIndex(c=>c===e.id);o>-1?d.value.splice(o,1):d.value.push(e.id)}async function C(e){W.editDict=ke(e),h("/book/"+e.id)}const q=$(()=>s.sbook.statistics?.length?M(F(s.sbook.statistics,"spend")):0),J=$(()=>s.sbook.statistics?.length?M(F(s.sbook.statistics.filter(e=>u(e.startDate).isSame(u(),"day")),"spend")):0),Q=$(()=>s.sbook.statistics?.length?new Set(s.sbook.statistics.map(e=>u(e.startDate).format("YYYY-MM-DD"))).size:0),Z=$(()=>{const e=Array(7).fill(!1),o=u().startOf("isoWeek"),c=u().endOf("isoWeek");return n.sbook.statistics?.forEach(p=>{const x=u(p.startDate);if(x.isBetween(o,c,null,"[]")){let i=x.day();i===0?i=6:i=i-1,e[i]=!0}}),e}),{data:K,isFetching:X}=Le(he(ve.ARTICLE.RECOMMENDED)).json();let E=w(!0);return fe(()=>{E.value=window.location.host===me}),(e,o)=>{const c=ee,p=A("opacity"),x=A("loading");return r(),b(Se,null,{default:y(()=>[a(E)?S("",!0):(r(),f("div",Re,[...o[7]||(o[7]=[j(" 新域名已启用，后续请访问 ",-1),t("a",{href:"https://typewords.cc/words?from_old_site=1"},"https://typewords.cc",-1),j(" 当前 2study.top 域名将在不久后停止使用 ",-1)])])),t("div",Ae,[t("div",je,[a(s).sbook.id?(r(),b(g,{key:0,"is-add":!1,quantifier:"篇",item:a(s).sbook,"show-progress":!1,onClick:o[0]||(o[0]=i=>C(a(s).sbook))},null,8,["item"])):(r(),b(g,{key:1,"is-add":!0,onClick:o[1]||(o[1]=i=>a(v).push("/book-list"))}))]),t("div",Ne,[t("div",Pe,[t("div",Me,[t("div",Fe,l(e.$t("this_week_record")),1),t("div",He,[(r(!0),f(D,null,I(Z.value,(i,_)=>(r(),f("div",{class:be(["w-6 h-6 md:w-8 md:h-8 rounded-md center text-sm md:text-base",i?"bg-[#409eff] color-white":"bg-gray-200"]),key:_},l(_+1),3))),128))])]),N((r(),f("div",Oe,[t("div",{class:"color-link cursor-pointer",onClick:o[2]||(o[2]=i=>a(v).push("/book-list"))},l(e.$t("change_book")),1)])),[[p,a(s).sbook.id]])]),t("div",We,[t("div",ze,[t("div",Ve,l(J.value),1),t("div",Ue,l(e.$t("today_study_time")),1)]),t("div",Ye,[t("div",qe,l(Q.value),1),t("div",Je,l(e.$t("total_study_days")),1)]),t("div",Qe,[t("div",Ze,l(q.value),1),t("div",Ke,l(e.$t("total_study_time")),1)])]),t("div",Xe,[k(we,{class:"w-full md:w-auto",size:"large",percentage:a(s).currentBookProgress,format:()=>`${a(s).sbook?.lastLearnIndex||0}/${a(s).sbook?.length||0}篇`,"show-text":!0},null,8,["percentage","format"]),k($e,{size:"large",class:"w-full md:w-auto",onClick:V,disabled:!a(s).sbook.name},{default:y(()=>[t("div",Ge,[t("span",et,l(a(L)?e.$t("continue_learning"):e.$t("start_learning")),1),k(c,{class:"text-xl"})])]),_:1},8,["disabled"])])])]),t("div",tt,[t("div",st,[t("div",ot,l(e.$t("my_books")),1),t("div",at,[a(d).length?(r(),b(Ie,{key:0,title:"确认删除所有选中书籍？",onConfirm:U},{default:y(()=>[k(Ce,{class:"del",title:e.$t("delete")},{default:y(()=>[k(De)]),_:1},8,["title"])]),_:1})):S("",!0),a(s).article.bookList.length>1?(r(),f("div",{key:1,class:"color-link cursor-pointer",onClick:o[3]||(o[3]=()=>{P(m)?m.value=!a(m):m=!a(m),P(d)?d.value=[]:d=[]})},l(a(m)?e.$t("cancel"):e.$t("manage_books")),1)):S("",!0),t("div",{class:"color-link cursor-pointer",onClick:o[4]||(o[4]=i=>a(h)("/book",{isAdd:!0}))},l(e.$t("create_personal_book")),1)])]),t("div",it,[(r(!0),f(D,null,I(a(s).article.bookList,(i,_)=>(r(),b(g,{"is-add":!1,"is-user":!0,quantifier:"篇",item:i,checked:a(d).includes(i.id),onCheck:()=>Y(i),"show-checkbox":a(m)&&_>=1,onClick:G=>C(i)},null,8,["item","checked","onCheck","show-checkbox","onClick"]))),256)),k(g,{"is-add":!0,onClick:o[5]||(o[5]=i=>a(v).push("/book-list"))})])]),N((r(),f("div",lt,[t("div",rt,[t("div",nt,l(e.$t("recommend")),1),t("div",ct,[t("div",{class:"color-link cursor-pointer",onClick:o[6]||(o[6]=i=>a(v).push("/book-list"))},l(e.$t("more")),1)])]),t("div",dt,[(r(!0),f(D,null,I(a(K),(i,_)=>(r(),b(g,{"is-add":!1,quantifier:"篇",item:i,onClick:G=>C(i)},null,8,["item","onClick"]))),256))])])),[[x,a(X)]])]),_:1})}}}),It=ye(ut,[["__scopeId","data-v-2243a901"]]);export{It as default};
