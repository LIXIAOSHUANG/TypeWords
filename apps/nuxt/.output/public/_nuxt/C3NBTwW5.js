import{V as m,x as v,bL as C,R as I,z as R,Z as U,aN as x}from"./Dbiv707D.js";function _(t){return{all:t=t||new Map,on:function(o,e){var i=t.get(o);i?i.push(e):t.set(o,[e])},off:function(o,e){var i=t.get(o);i&&(e?i.splice(i.indexOf(e)>>>0,1):t.set(o,[]))},emit:function(o,e){var i=t.get(o);i&&i.slice().map(function(l){l(e)}),(i=t.get("*"))&&i.slice().map(function(l){l(o,e)})}}}const a=_(),u={resetWord:"resetWord",openStatModal:"openStatModal",openWordListModal:"openWordListModal",closeOther:"closeOther",keydown:"keydown",keyup:"keyup",onTyping:"onTyping",repeatStudy:"repeatStudy",continueStudy:"continueStudy",write:"write",editDict:"editDict",openMyDictDialog:"openMyDictDialog",stateInitEnd:"stateInitEnd"};function F(t){m(()=>{t.map(o=>a.on(o[0],o[1]))}),v(()=>{t.map(o=>a.off(o[0],o[1]))})}function N(t){m(()=>{a.on(u.closeOther,t),window.addEventListener("click",t)});const e=()=>{window.removeEventListener("click",t)};v(e),C(e)}function M(t,o){const e=s=>{if(typeof o=="function")return o(s);if(o&&typeof o.handleEvent=="function")return o.handleEvent(s)};let i=null;m(()=>{const s=[],d=f=>s.push(f),h=()=>{for(;s.length;){const f=s.pop();try{f()}catch(c){console.warn("[useEventListener] cleanup error",c)}}};if(x()&&t==="keydown"){const c=(()=>{let n=document.querySelector("#typing-listener");return n||(n=document.createElement("input"),n.id="typing-listener",n.type="text",n.autocomplete="off",n.autocapitalize="off",n.autocorrect=!1,n.spellcheck=!1,n.tabIndex=-1,n.setAttribute("aria-hidden","true"),Object.assign(n.style,{position:"fixed",opacity:"0",pointerEvents:"none",width:"1px",height:"1px",top:"0",left:"-9999px",zIndex:"-1"})),n.parentNode||document.body.appendChild(n),n})();let E=!1;const k=new Set,A=n=>{k.add(n),window.setTimeout(()=>k.delete(n),150)},T=n=>({key:n.key,code:n.code??"",keyCode:n.keyCode,which:n.keyCode,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,repeat:!1,isComposing:!1,type:t,preventDefault(){},stopPropagation(){},stopImmediatePropagation(){}}),L=n=>{A(n.key),e(T(n))},S=()=>{E=!0},K=n=>{if(E=!1,!n.data){c.value="";return}for(const r of n.data){const g=r===" "?32:r.toUpperCase().charCodeAt(0);L({key:r,code:r===" "?"Space":void 0,keyCode:g})}c.value=""},b=n=>{if(E)return;const r=n.target,g=r?.value??"";if(n.inputType==="deleteContentBackward"){L({key:"Backspace",code:"Backspace",keyCode:8}),r&&(r.value="");return}const y=g.slice(-1)||n.data?.slice(-1);if(!y){r&&(r.value="");return}const W=y===" "?32:y.toUpperCase().charCodeAt(0);L({key:y,code:y===" "?"Space":void 0,keyCode:W}),window.setTimeout(()=>{r&&(r.value="")},0)},O=n=>!(!n||!window.location.pathname.includes("/practice")||!n.closest(".typing-word")||n.closest(".sentence")||n.closest(".phrase")||n.classList?.contains("flex")&&n.querySelector(".phrase")),w=n=>{const r=n.target;O(r)&&window.setTimeout(()=>c.focus(),60)},D=n=>{if(k.has(n.key)){k.delete(n.key);return}e(n)};c.addEventListener("compositionstart",S),d(()=>c.removeEventListener("compositionstart",S)),c.addEventListener("compositionend",K),d(()=>c.removeEventListener("compositionend",K)),c.addEventListener("input",b),d(()=>c.removeEventListener("input",b)),window.addEventListener("click",w),d(()=>window.removeEventListener("click",w)),window.addEventListener("touchstart",w),d(()=>window.removeEventListener("touchstart",w)),window.addEventListener(t,D),d(()=>window.removeEventListener(t,D)),d(()=>{c.value=""})}else{const f=c=>e(c);window.addEventListener(t,f),d(()=>window.removeEventListener(t,f))}i=()=>{h(),i=null}});const p=()=>{i&&i()};v(p),C(p)}function B(t){let o="";return(t.ctrlKey||t.metaKey)&&(o+="Ctrl+"),t.altKey&&(o+="Alt+"),t.shiftKey&&(o+="Shift+"),t.key!=="Control"&&t.key!=="Alt"&&t.key!=="Shift"&&(t.keyCode>=65&&t.keyCode<=90?o+=t.key.toUpperCase():t.key==="ArrowRight"?o+="➡":t.key==="ArrowLeft"?o+="⬅":t.key==="ArrowUp"?o+="⬆":t.key==="ArrowDown"?o+="⬇":o+=t.key),o=o.trim(),o}function z(){const t=I(),o=U();M("keydown",e=>{if(!((e.ctrlKey||e.metaKey)&&["KeyC","KeyA"].includes(e.code))&&!t.disableEventListener){if(e.code==="Space"){const s=window.__CURRENT_WORD_INFO__;if(s&&(s.word&&s.word.includes(" ")&&s.word[s.input.length]===" "||s.inputLock===!0))return e.preventDefault(),a.emit(u.onTyping,e)}let i=B(e),l=Object.entries(o.shortcutKeyMap),p="";for(let s=0;s<l.length;s++){let[d,h]=l[s];if(h===i){p=d;break}}if(p)e.preventDefault(),a.emit(p,e);else{if(e.code==="Space")return e.preventDefault(),a.emit(u.onTyping,e);if((e.keyCode>=65&&e.keyCode<=90||e.keyCode>=48&&e.keyCode<=57||e.code==="Slash"||e.code==="Quote"||e.code==="Comma"||e.code==="BracketLeft"||e.code==="BracketRight"||e.code==="Period"||e.code==="Minus"||e.code==="Equal"||e.code==="Semicolon"||e.keyCode===229)&&!e.ctrlKey&&!e.altKey){if(x()&&e.keyCode===229&&e.key==="Unidentified")return;e.preventDefault(),a.emit(u.onTyping,e)}else a.emit(u.keydown,e)}}}),M("keyup",e=>{t.disableEventListener||a.emit(u.keyup,e)})}function P(t,o){m(()=>{a.on(u.keydown,t),a.on(u.keyup,o)});const i=()=>{a.off(u.keydown,t),a.off(u.keyup,o)};v(i),C(i)}function j(t){const o=I();R(t,e=>{o.disableEventListener=e})}export{u as E,z as a,F as b,N as c,j as d,a as e,P as f,B as g,M as u};
