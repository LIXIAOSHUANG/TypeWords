import{_ as Ve}from"./DdQRNC7l.js";import{Y as re,o as i,c as d,a as o,X as be,b as w,t as s,m as Fe,d as Re,ae as Pe,ap as Ne,Q as Le,V as Se,aq as Me,i as c,ar as Ae,k as l,A as ze,l as se,n as Z,as as D,h as z,w as r,f as a,ai as q,e as g,at as Be,F as W,au as Oe,ak as je,av as Ee,a5 as h,aw as Ue,a6 as Te,ax as Ze,j as De}from"./Dbiv707D.js";import{_ as qe}from"./Bz8UH5_y.js";import{B as v}from"./CjoTdGiq.js";import{B as I}from"./B55v04t5.js";import{P as G,C as H,c as Q,a as We,p as X,d as J,b as B}from"./ybDDk5yT.js";import{a as _,F as O}from"./BN6KZkPp.js";import{H as K}from"./BTmIh2Yk.js";import{P as Ge}from"./DDg15Rfs.js";import{u as He}from"./C6Ge7dUj.js";import{s as Qe}from"./S7Ir0EnR.js";import"./U7X5gOHL.js";import"./C3NBTwW5.js";import"./BgVYQ2O1.js";import"./DScG_TK1.js";import"./CdkHU8iM.js";import"./BL_4slK8.js";const Xe={viewBox:"0 0 512 512",width:"1.2em",height:"1.2em"};function Je(u,k){return i(),d("svg",Xe,[...k[0]||(k[0]=[o("path",{fill:"currentColor",d:"M469.333 311.893c0-57.386-56.106-103.893-125.44-103.893c-69.333 0-125.226 46.507-125.226 103.893S274.773 416 343.893 416a157.2 157.2 0 0 0 36.694-4.48a4.27 4.27 0 0 1 3.626 0l37.12 19.84a5.34 5.34 0 0 0 5.911-.523a5.33 5.33 0 0 0 1.769-5.664l-7.04-28.16a5.55 5.55 0 0 1 2.133-5.546a98.35 98.35 0 0 0 45.227-79.574m-170.666-13.226a21.33 21.33 0 0 1-21.334-21.334a21.333 21.333 0 1 1 21.334 21.334m85.333 0a21.333 21.333 0 1 1 .001-42.667a21.333 21.333 0 0 1-.001 42.667"},null,-1),o("path",{fill:"currentColor",d:"M343.893 186.667h4.694C333.867 128 271.787 85.333 197.333 85.333c-85.333 0-154.666 57.387-154.666 128a120.53 120.53 0 0 0 56.96 98.987a5.12 5.12 0 0 1 2.133 5.76l-8.107 32.853a5.333 5.333 0 0 0 7.68 6.187L144 335.787a4.9 4.9 0 0 1 3.84 0a184 184 0 0 0 49.493 5.546h4.267a102 102 0 0 1-4.267-29.226c0-69.12 65.707-125.44 146.56-125.44m-98.56-37.334a21.333 21.333 0 1 1-.001 42.667a21.333 21.333 0 0 1 .001-42.667m-96 42.667a21.332 21.332 0 1 1-.001-42.664a21.332 21.332 0 0 1 .001 42.664"},null,-1)])])}const Ke=re({name:"ix-wechat-logo",render:Je}),Ye={viewBox:"0 0 20 20",width:"1.2em",height:"1.2em"};function el(u,k){return i(),d("svg",Ye,[...k[0]||(k[0]=[o("path",{fill:"currentColor",d:"M10 2a8 8 0 1 1 0 16a8 8 0 0 1 0-16m0 1a7 7 0 1 0 0 14a7 7 0 0 0 0-14m0 9.5a.75.75 0 1 1 0 1.5a.75.75 0 0 1 0-1.5M10 6a.5.5 0 0 1 .492.41l.008.09V11a.5.5 0 0 1-.992.09L9.5 11V6.5A.5.5 0 0 1 10 6"},null,-1)])])}const ll=re({name:"fluent-error-circle20-regular",render:el}),ol={},tl={class:"h-12 text-xs text-gray-400"},al={href:"/user-agreement.html",target:"_blank",class:"link"},sl={href:"/privacy-policy.html",target:"_blank",class:"link"};function nl(u,k){return i(),d("div",tl,[o("span",null,[w(s(u.$t("agree_terms_notice"))+" ",1),o("a",al,s(u.$t("user_agreement")),1),w(" "+s(u.$t("and"))+" ",1),o("a",sl,s(u.$t("privacy_policy")),1)]),Fe(u.$slots,"default")])}const ne=Object.assign(be(ol,[["render",nl]]),{__name:"Notice"}),rl={class:"center min-h-screen"},il={key:0,class:"card-white p-2"},dl={class:"flex gap-2"},ul={class:"flex-1 w-80 p-3"},cl={key:0},pl={class:"mb-6 text-center text-2xl font-bold"},ml={class:"center gap-8 mb-6"},fl={class:"mt-1 h-0.5 bg-blue-600"},gl={class:"mt-1 h-0.5 bg-blue-600"},vl={class:"flex gap-2"},_l={class:"flex gap-2"},wl={key:0},hl={class:"mt-4 flex justify-between text-sm"},yl={key:1},kl={class:"flex gap-2"},Cl={key:2},$l={class:"flex gap-2"},Il={key:0,class:"center flex-col bg-gray-100 rounded-xl px-12"},xl={class:"relative w-40 h-40 bg-white rounded-xl overflow-hidden shadow-xl"},Vl={key:1,class:"absolute left-0 top-0 w-full h-full center flex-col gap-space bg-white"},bl={class:"text-base text-gray-700 font-medium"},Fl={class:"text-xs text-gray-600"},Rl={key:2,class:"absolute left-0 top-0 w-full h-full center flex-col gap-space bg-white"},Pl={class:"text-base text-gray-700 font-medium"},Nl={class:"text-xs text-gray-600"},Ll={key:3,class:"absolute top-0 left-0 right-0 bottom-0 bg-opacity-95 center backdrop-blur-sm"},Sl={class:"mt-4 center gap-space"},Ml={class:"text-sm text-gray-600"},Al={key:1,class:"card-white p-6 w-100"},zl={class:"flex flex-col justify-between h-60"},Bl={class:"flex gap-space justify-end"},Ol={key:1},jl={class:"title text-align-center"},El={class:"flex items-center justify-between gap-2 mt-10"},Ul={class:"title text-align-center"},Tl={class:"mt-10"},Zl={class:"flex justify-end"},Dl={class:"title text-align-center"},ql={class:"flex justify-end"},Wl=300*1e3;var x=(function(u){return u[u.CONFIRMATION=0]="CONFIRMATION",u[u.PROCESSING=1]="PROCESSING",u[u.SUCCESS=2]="SUCCESS",u[u.FAIL=3]="FAIL",u})(x||{});const co=Re({__name:"login",setup(u){Pe();const k=Ne();Le();let C=c("login"),p=c("code"),y=c(!1),L=c(!0),Y=c("https://open.weixin.qq.com/connect/qrcode/041GmMJM2wfM0w3D"),$=c("idle"),S=null,b=null,j=c(!0),V=c({phone:"",code:""}),E=c(),ie={phone:We,code:Q},F=c({account:"",password:""}),ee=c(),de={account:J,password:X};const m=c({account:"",password:"",confirmPassword:"",code:""});let M=c(),ue={account:J,code:Q,password:X,confirmPassword:[{required:!0,message:"请再次输入密码",trigger:"blur"},{validator:(t,e)=>{if(e!==m.value.password)throw new Error("两次密码输入不一致")},trigger:"blur"}]};const f=c({account:"",code:"",newPassword:"",confirmPassword:""});let A=c(),ce={account:J,code:Q,newPassword:X,confirmPassword:[{required:!0,message:"请再次输入新密码",trigger:"blur"},{validator:(t,e)=>{if(e!==f.value.newPassword)throw new Error("两次密码输入不一致")},trigger:"blur"}]};const pe=De(()=>C.value==="login"?p.value=="code"?E.value:ee.value:C.value==="register"?M.value:A.value);function le(t){j.value=!0}async function me(){pe.value.validate(async t=>{if(t)try{y.value=!0;let e={};p.value==="code"?e={...V.value,type:"code"}:e={...F.value,type:"pwd"};let P=await Ee(e);P.success?le(P.data.token):(h.error(P.msg||"登录失败"),P.code===499&&(p.value="code"))}catch{h.error("登录失败，请重试")}finally{y.value=!1}})}async function fe(){M.value.validate(async t=>{if(t)try{y.value=!0;let e=await Ue(m.value);e.success?(h.success("注册成功"),await Te(1500),le(e.data.token)):h.error(e.msg||"注册失败")}catch{h.error("注册失败，请重试")}finally{y.value=!1}})}async function ge(){A.value.validate(async t=>{if(t)try{y.value=!0;const e=await Ze(f.value);e.success?(h.success("密码重置成功，请重新登录"),N("login")):h.error(e.msg||"重置失败")}catch(e){h.error(e||"重置密码失败，请重试")}finally{y.value=!1}})}function U(){S&&(clearTimeout(S),S=null),b&&(clearInterval(b),b=null)}async function oe(){U(),$.value="idle",await ve()}async function ve(){try{L.value=!0,$.value="idle",Y.value="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8cmVjdCB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iI2Y1ZjVmNSIvPgogIDx0ZXh0IHg9IjUwJSIgeT0iNTAlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkeT0iLjNlbSIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzk5OTk5OSI+55So5o6l566h55CG6L295Lit6K+B77yBPC90ZXh0Pgo8L3N2Zz4K",b=Qe(async()=>{},2e3),S=setTimeout(()=>{$.value="expired",clearInterval(b),b=null,h.info("二维码已过期，请点击刷新")},Wl)}catch(t){console.error("Wechat login error:",t),h.error("微信登录失败")}}function N(t){C.value=t,(t==="register"||t==="forgot")&&L.value&&(U(),L.value=!1,$.value="idle")}Se(()=>{k.query?.register&&(C.value="register")}),Me(()=>{U(),clearInterval(_e.value)}),He();let R=c(x.CONFIRMATION),te=c(""),_e=c(-1);async function we(){R.value=x.PROCESSING}function he(){j.value=!1}function ye(){}function ae(){}return(t,e)=>{const P=Ve,ke=Be,Ce=ll,$e=qe,Ie=Ke,xe=Oe,T=Ae("opacity");return i(),d("div",rl,[l(j)?(i(),d("div",Al,[a(K,{onClick:he,title:t.$t("sync_data")},null,8,["title"]),o("div",zl,[l(R)===x.CONFIRMATION?(i(),d(W,{key:0},[o("div",null,[o("h2",null,s(t.$t("local_data_detected")),1),o("h3",null,s(t.$t("sync_to_account_question")),1)]),o("div",Bl,[l(R)===x.CONFIRMATION?(i(),z(Ge,{key:0,title:[{text:"您的用户数据将以压缩包自动下载到您的电脑中，以便您随时恢复",type:"normal"},{text:"随后网站的用户数据将被删除",type:"redBold"},{text:"是否确认继续？",type:"normal"}],onConfirm:ye},{default:r(()=>[a(I,{type:"info"},{default:r(()=>[w(s(t.$t("no_sync")),1)]),_:1})]),_:1})):g("",!0),a(I,{onClick:we},{default:r(()=>[w(s(t.$t("sync")),1)]),_:1})])],64)):g("",!0),l(R)===x.PROCESSING?(i(),d("div",Ol,[o("div",jl,s(t.$t("syncing")),1),e[20]||(e[20]=o("ol",{class:"pl-4"},[o("li",null,"您的用户数据已自动下载到您的电脑中，以便随时恢复"),o("li",null,"随后将开始数据同步"),o("li",null,"如果您的数据量很大，这将是一个耗时操作"),o("li",{class:"color-red-5 font-bold"},"请耐心等待，请勿关闭此页面")],-1)),o("div",El,[o("span",null,"当前进度: "+s(l(te)),1),a(xe,{class:"text-xl"})])])):g("",!0),l(R)===x.FAIL?(i(),d(W,{key:2},[o("div",null,[o("div",Ul,s(t.$t("sync_failed")),1),o("div",Tl,[o("span",null,s(l(te)),1)])]),o("div",Zl,[a(I,{type:"info",onClick:l(je)},{default:r(()=>[w(s(t.$t("feedback")),1)]),_:1},8,["onClick"]),a(I,{onClick:ae},{default:r(()=>[w(s(t.$t("enter_website")),1)]),_:1})])],64)):g("",!0),l(R)===x.SUCCESS?(i(),d(W,{key:3},[o("div",null,[o("div",Dl,s(t.$t("sync_success")),1),e[21]||(e[21]=o("div",{class:"mt-10"},[o("span",null,"稍后将自动进入网站...")],-1))]),o("div",ql,[a(I,{onClick:ae},{default:r(()=>[w(s(t.$t("enter_website")),1)]),_:1})])],64)):g("",!0)])])):(i(),d("div",il,[o("div",dl,[o("div",ul,[l(C)==="login"?(i(),d("div",cl,[o("div",pl,s(l(ze)),1),o("div",ml,[o("div",{class:Z(["center cp transition-colors",l(p)==="code"?"link font-medium":"text-gray-600"]),onClick:e[0]||(e[0]=n=>se(p)?p.value="code":p="code")},[o("div",null,[o("span",null,s(t.$t("code_login")),1),D(o("div",fl,null,512),[[T,l(p)==="code"]])])],2),o("div",{class:Z(["center cp transition-colors",l(p)==="password"?"link font-medium":"text-gray-600"]),onClick:e[1]||(e[1]=n=>se(p)?p.value="password":p="password")},[o("div",null,[o("span",null,s(t.$t("password_login")),1),D(o("div",gl,null,512),[[T,l(p)==="password"]])])],2)]),l(p)==="code"?(i(),z(O,{key:0,ref_key:"phoneLoginFormRef",ref:E,rules:l(ie),model:l(V)},{default:r(()=>[a(_,{prop:"phone"},{default:r(()=>[a(v,{modelValue:l(V).phone,"onUpdate:modelValue":e[2]||(e[2]=n=>l(V).phone=n),type:"tel",name:"username",autocomplete:"tel",size:"large",placeholder:t.$t("phone_placeholder")},null,8,["modelValue","placeholder"])]),_:1}),a(_,{prop:"code"},{default:r(()=>[o("div",vl,[a(v,{modelValue:l(V).code,"onUpdate:modelValue":e[3]||(e[3]=n=>l(V).code=n),type:"code",size:"large","max-length":l(G).codeLength,placeholder:t.$t("code_placeholder")},null,8,["modelValue","max-length","placeholder"]),a(H,{"validate-field":()=>l(E).validateField("phone"),type:l(q).Login,val:l(V).phone},null,8,["validate-field","type","val"])])]),_:1})]),_:1},8,["rules","model"])):(i(),z(O,{key:1,ref_key:"loginForm2Ref",ref:ee,rules:l(de),model:l(F)},{default:r(()=>[a(_,{prop:"account"},{default:r(()=>[a(v,{modelValue:l(F).account,"onUpdate:modelValue":e[4]||(e[4]=n=>l(F).account=n),type:"email",name:"username",autocomplete:"email",size:"large",placeholder:t.$t("account_placeholder")},null,8,["modelValue","placeholder"])]),_:1}),a(_,{prop:"password"},{default:r(()=>[o("div",_l,[a(v,{modelValue:l(F).password,"onUpdate:modelValue":e[5]||(e[5]=n=>l(F).password=n),type:"password",name:"password",autocomplete:"current-password",size:"large",placeholder:t.$t("password_placeholder")},null,8,["modelValue","placeholder"])])]),_:1})]),_:1},8,["rules","model"])),a(ne,null,{default:r(()=>[l(p)==="code"?(i(),d("span",wl,"，"+s(t.$t("auto_register_notice")),1)):g("",!0)]),_:1}),a(I,{class:"w-full",size:"large",loading:l(y),onClick:me},{default:r(()=>[w(s(t.$t("login")),1)]),_:1},8,["loading"]),D((i(),d("div",hl,[o("div",{class:"link cp",onClick:e[6]||(e[6]=n=>N("forgot"))},s(t.$t("forgot_password")),1),o("div",{class:"link cp",onClick:e[7]||(e[7]=n=>N("register"))},s(t.$t("register_account")),1)])),[[T,l(p)!=="code"]])])):l(C)==="register"?(i(),d("div",yl,[a(K,{onClick:e[8]||(e[8]=n=>N("login")),title:t.$t("register_new_account")},null,8,["title"]),a(O,{ref_key:"registerFormRef",ref:M,rules:l(ue),model:m.value},{default:r(()=>[a(_,{prop:"account"},{default:r(()=>[a(v,{modelValue:m.value.account,"onUpdate:modelValue":e[9]||(e[9]=n=>m.value.account=n),type:"tel",name:"username",autocomplete:"username",size:"large",placeholder:t.$t("account_placeholder")},null,8,["modelValue","placeholder"])]),_:1}),a(_,{prop:"code"},{default:r(()=>[o("div",kl,[a(v,{modelValue:m.value.code,"onUpdate:modelValue":e[10]||(e[10]=n=>m.value.code=n),type:"code",size:"large",placeholder:t.$t("code_placeholder"),"max-length":l(G).codeLength},null,8,["modelValue","placeholder","max-length"]),a(H,{"validate-field":()=>l(M).validateField("account"),type:l(q).Register,val:m.value.account},null,8,["validate-field","type","val"])])]),_:1}),a(_,{prop:"password"},{default:r(()=>[a(v,{modelValue:m.value.password,"onUpdate:modelValue":e[11]||(e[11]=n=>m.value.password=n),type:"password",name:"password",autocomplete:"current-password",size:"large",placeholder:`请设置密码（${l(B).minLength}-${l(B).maxLength} 位）`},null,8,["modelValue","placeholder"])]),_:1}),a(_,{prop:"confirmPassword"},{default:r(()=>[a(v,{modelValue:m.value.confirmPassword,"onUpdate:modelValue":e[12]||(e[12]=n=>m.value.confirmPassword=n),type:"password",name:"password",autocomplete:"new-password",size:"large",placeholder:t.$t("confirm_password_placeholder")},null,8,["modelValue","placeholder"])]),_:1})]),_:1},8,["rules","model"]),a(ne),a(I,{class:"w-full",size:"large",loading:l(y),onClick:fe},{default:r(()=>[w(s(t.$t("register")),1)]),_:1},8,["loading"])])):l(C)==="forgot"?(i(),d("div",Cl,[a(K,{onClick:e[13]||(e[13]=n=>N("login")),title:t.$t("reset_password")},null,8,["title"]),a(O,{ref_key:"forgotFormRef",ref:A,rules:l(ce),model:f.value},{default:r(()=>[a(_,{prop:"account"},{default:r(()=>[a(v,{modelValue:f.value.account,"onUpdate:modelValue":e[14]||(e[14]=n=>f.value.account=n),type:"tel",name:"username",autocomplete:"username",size:"large",placeholder:t.$t("account_placeholder")},null,8,["modelValue","placeholder"])]),_:1}),a(_,{prop:"code"},{default:r(()=>[o("div",$l,[a(v,{modelValue:f.value.code,"onUpdate:modelValue":e[15]||(e[15]=n=>f.value.code=n),type:"code",size:"large",placeholder:t.$t("code_placeholder"),"max-length":l(G).codeLength},null,8,["modelValue","placeholder","max-length"]),a(H,{"validate-field":()=>l(A).validateField("account"),type:l(q).ResetPwd,val:f.value.account},null,8,["validate-field","type","val"])])]),_:1}),a(_,{prop:"newPassword"},{default:r(()=>[a(v,{modelValue:f.value.newPassword,"onUpdate:modelValue":e[16]||(e[16]=n=>f.value.newPassword=n),type:"password",name:"password",autocomplete:"new-password",size:"large",placeholder:`请输入新密码（${l(B).minLength}-${l(B).maxLength} 位）`},null,8,["modelValue","placeholder"])]),_:1}),a(_,{prop:"confirmPassword"},{default:r(()=>[a(v,{modelValue:f.value.confirmPassword,"onUpdate:modelValue":e[17]||(e[17]=n=>f.value.confirmPassword=n),type:"password",name:"password",autocomplete:"new-password",size:"large",placeholder:t.$t("confirm_new_password")},null,8,["modelValue","placeholder"])]),_:1})]),_:1},8,["rules","model"]),a(I,{class:"w-full mt-2",size:"large",loading:l(y),onClick:ge},{default:r(()=>[w(s(t.$t("reset_password")),1)]),_:1},8,["loading"])])):g("",!0)]),l(C)==="login"?(i(),d("div",Il,[o("div",xl,[l(L)?(i(),z(P,{key:0,src:l(Y),alt:"微信登录二维码",class:Z(["w-full h-full",{"opacity-30":l($)==="expired"}])},null,8,["src","class"])):g("",!0),l($)==="scanned"?(i(),d("div",Vl,[a(ke,{class:"color-green text-4xl"}),o("div",bl,s(t.$t("scan_success")),1),o("div",Fl,s(t.$t("tap_allow_in_wechat")),1)])):g("",!0),l($)==="cancelled"?(i(),d("div",Rl,[a(Ce,{class:"color-red text-4xl"}),o("div",Pl,s(t.$t("login_cancelled")),1),o("div",Nl,[e[18]||(e[18]=w(" 你可",-1)),o("span",{class:"color-link",onClick:oe},s(t.$t("login_again")),1),e[19]||(e[19]=w("，或关闭窗口 ",-1))])])):g("",!0),l($)==="expired"?(i(),d("div",Ll,[a($e,{onClick:oe,class:"cp text-4xl"})])):g("",!0)]),o("p",Sl,[a(Ie,{class:"text-xl color-green"}),o("span",Ml,s(t.$t("wechat_scan_login")),1)])])):g("",!0)])]))])}}});export{co as default};
