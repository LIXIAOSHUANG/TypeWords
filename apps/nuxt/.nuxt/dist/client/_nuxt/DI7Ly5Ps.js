import{T as S}from"./BXMCzVga.js";import{d as L,R as E,$ as I,bc as _,i as b,a4 as g,W as T,M as R,V as U,o as j,c as A,f as n,k as l,w as i,e as B,a as z,b as h,t as w,U as u,a5 as r,aL as M,bi as W,aJ as d,aP as q}from"./Dbiv707D.js";import{B as $}from"./B55v04t5.js";import{B as J}from"./CjoTdGiq.js";import{F as K,a as N}from"./BN6KZkPp.js";const P={class:"w-120 mt-4"},Q={class:"center"},G=L({__name:"EditBook",props:{isAdd:{type:Boolean},isBook:{type:Boolean}},emits:["submit","close"],setup(y,{emit:x}){const c=y,m=x,p=E(),V=I(),C={id:"",name:"",description:"",category:"",tags:[],translateLanguage:"zh-CN",language:"en",type:_.article};let o=b(g(C));const k=b();let f=b(!1);const{t}=T(),D=R({name:[{required:!0,message:t("please_enter_name"),trigger:"blur"},{max:20,message:t("name_max_20_chars"),trigger:"blur"}]});async function F(){await k.value.validate(async v=>{if(v){let e=u(o.value);e.type=c.isBook?_.article:_.word;let s=[V.article,V.word][c.isBook?0:1];if(c.isAdd)if(e.id="custom-dict-"+Date.now(),e.custom=!0,s.bookList.find(a=>a.name===e.name)){r.warning(t("name_already_exists"));return}else{if(M.CAN_REQUEST){f.value=!0;let a=await W(null,e);if(f.value=!1,a.success)e=u(a.data);else return r.error(a.msg)}s.bookList.push(g(e)),p.editDict=e,m("submit"),r.success(t("add_success"))}else{let a=s.bookList.findIndex(O=>O.id===e.id);!e.custom&&![d.wordKnown,d.wordWrong,d.wordCollect,d.articleCollect].includes(e.en_name||e.id)&&(e.custom=!0,e.id.includes("_custom")||(e.id+="_custom_"+q(6))),p.editDict=e,a>-1?(s.bookList[a]=u(e),m("submit"),r.success(t("edit_success"))):(s.bookList.push(u(e)),r.success(t("edit_and_add_to_dict")))}console.log("submit!",e)}else r.warning(t("please_fill_complete"))})}return U(()=>{c.isAdd||(o.value=g(p.editDict))}),(v,e)=>{const s=S;return j(),A("div",P,[n(K,{ref_key:"dictFormRef",ref:k,rules:D,model:l(o),"label-width":"8rem"},{default:i(()=>[n(N,{label:l(t)("name"),prop:"name"},{default:i(()=>[n(J,{modelValue:l(o).name,"onUpdate:modelValue":e[0]||(e[0]=a=>l(o).name=a)},null,8,["modelValue"])]),_:1},8,["label"]),n(N,{label:l(t)("description")},{default:i(()=>[n(s,{modelValue:l(o).description,"onUpdate:modelValue":e[1]||(e[1]=a=>l(o).description=a),autosize:""},null,8,["modelValue"])]),_:1},8,["label"]),B("",!0),B("",!0),z("div",Q,[n($,{type:"info",onClick:e[4]||(e[4]=a=>m("close"))},{default:i(()=>[h(w(l(t)("close")),1)]),_:1}),n($,{type:"primary",loading:l(f),onClick:F},{default:i(()=>[h(w(l(t)("confirm")),1)]),_:1},8,["loading"])])]),_:1},8,["rules","model"])])}}}),oe=Object.assign(G,{__name:"EditBook"});export{oe as E};
