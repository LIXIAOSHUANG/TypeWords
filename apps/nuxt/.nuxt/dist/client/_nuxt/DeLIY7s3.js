const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./D_JQWYvL.js","./Dbiv707D.js","./entry.EYAiiZOw.css","./C3NBTwW5.js","./B55v04t5.js","./BaseButton.DGhsrd12.css","./Dialog.D1qJRpPK.css"])))=>i.map(i=>d[i]);
import{d as I,aV as D,o as M,h as E,w as O,a as r,b as T,t as d,k as m,O as V,aW as x,aX as B,a5 as g,a0 as A,aY as k}from"./Dbiv707D.js";import{s as L}from"./S7Ir0EnR.js";const R={class:"px-4 flex-col center w-100"},N={class:"text-align-center text-2xl"},P={class:"color-blue"},$=I({__name:"MigrateDialog",props:{modelValue:{},modelModifiers:{}},emits:x(["ok"],["update:modelValue"]),setup(u,{emit:_}){const p=B(()=>k(()=>import("./D_JQWYvL.js"),__vite__mapDeps([0,1,2,3,4,5,6]),import.meta.url)),l=D(u,"modelValue"),f=_;async function v(){return new Promise(async(e,t)=>{var o="https://2study.top",y=["type-words-app-version","typing-word-dict","typing-word-setting","typing-word-files"],S=["PracticeSaveWord","PracticeSaveArticle"];const i=window.open(`${o}/migrate.html`,"_blank","width=400,height=400");if(!i)return t("弹窗被阻止，请在网址输入栏最右边，点击允许弹窗");async function c(n){if(n.origin!==o||n.data?.type!=="MIGRATION_RESULT")return;const s=n.data.payload;console.log("payload",s),S.forEach(a=>{s.localStorage[a]!==void 0&&localStorage.setItem(a,s.localStorage[a])});for(let a of y)s.indexedDB[a]!==void 0&&await A(a,s.indexedDB[a]);window.removeEventListener("message",c),e(!0)}window.addEventListener("message",c);const h=L(()=>{if(!i||i.closed)clearInterval(h),t("迁移窗口已关闭");else try{i.postMessage({type:"REQUEST_MIGRATION_DATA"},o)}catch{}},100)})}async function w(){try{await v(),localStorage.setItem("__migrated_from_2study_top__","1"),console.log("迁移完成"),g.success("迁移完成"),l.value=!1,f("ok")}catch(e){g.error("迁移失败："+e),console.error("迁移失败",e)}}return(e,t)=>(M(),E(m(p),{modelValue:l.value,"onUpdate:modelValue":t[0]||(t[0]=o=>l.value=o),footer:!0,onOk:w,confirmButtonText:e.$t("migrate_data"),title:e.$t("migrate_data")},{default:O(()=>[r("div",R,[r("h2",N,[T(d(e.$t("migrate_new_domain"))+" ",1),r("span",P,d(m(V)),1)]),r("h3",null,d(e.$t("migrate_old_domain_notice")),1),t[1]||(t[1]=r("div",null," 如果您不想此时迁移，关闭弹窗后，您可随时在“设置” -> “数据管理” 里面再次进行 ",-1))])]),_:1},8,["modelValue","confirmButtonText","title"]))}}),G=Object.assign($,{__name:"MigrateDialog"});export{G as M};
