{"version":3,"file":"Dialog-BoKDmA_Y.js","sources":["../../../../app/components/dialog/Dialog.vue"],"sourcesContent":["<script setup lang=\"ts\">import { computed as _computed, ref as _ref } from 'vue';\n\nimport { onMounted, onUnmounted, watch } from 'vue'\nimport Tooltip from '@/components/base/Tooltip.vue'\nimport { useEventListener } from '@/hooks/event'\nimport { useI18n } from 'vue-i18n'\n\nimport BaseButton from '@/components/BaseButton.vue'\nimport { useRuntimeStore } from '@/stores/runtime'\n\nexport interface ModalProps {\n  modelValue?: boolean\n  showClose?: boolean\n  title?: string\n  content?: string\n  fullScreen?: boolean\n  padding?: boolean\n  footer?: boolean\n  header?: boolean\n  confirmButtonText?: string\n  cancelButtonText?: string\n  keyboard?: boolean\n  closeOnClickBg?: boolean\n  confirm?: any\n  beforeClose?: any\n  t?: any\n}\n\nconst props = defineProps({\n  modelValue: { type: Boolean, default: undefined },\n  showClose: { type: Boolean, default: true },\n  title: null,\n  content: null,\n  fullScreen: { type: Boolean, default: false },\n  padding: { type: Boolean },\n  footer: { type: Boolean, default: false },\n  header: { type: Boolean, default: true },\n  confirmButtonText: { default: '' },\n  cancelButtonText: { default: '' },\n  keyboard: { type: Boolean, default: true },\n  closeOnClickBg: { type: Boolean, default: true },\n  confirm: null,\n  beforeClose: null,\n  t: null\n})\n\nconst localeT = _computed(() => {\n  if (props.t) return props.t\n  const { t: i18nT } = useI18n()\n  return i18nT\n})\n\nconst emit = defineEmits(['update:modelValue', 'close', 'ok', 'cancel'])\n\nlet confirmButtonLoading = _ref(false)\nlet zIndex = _ref(999)\nlet visible = _ref(false)\nlet openTime = _ref(Date.now())\nlet maskRef = _ref<HTMLDivElement>(null)\nlet modalRef = _ref<HTMLDivElement>(null)\nconst runtimeStore = useRuntimeStore()\nlet id = Date.now()\n\nasync function close() {\n  if (!visible.value) {\n    return\n  }\n  if (props.beforeClose) {\n    if (!(await props.beforeClose())) {\n      return\n    }\n  }\n  //记录停留时间，避免时间太短，弹框闪烁\n  let stayTime = Date.now() - openTime.value\n  let closeTime = 300\n  if (stayTime < 500) {\n    closeTime += 500 - stayTime\n  }\n  return new Promise(resolve => {\n    setTimeout(() => {\n      maskRef.value?.classList.toggle('bounce-out')\n      modalRef.value?.classList.toggle('bounce-out')\n    }, 500 - stayTime)\n\n    setTimeout(() => {\n      emit('update:modelValue', false)\n      emit('close')\n      visible.value = false\n      resolve(true)\n      let rIndex = runtimeStore.modalList.findIndex(item => item.id === id)\n      if (rIndex > -1) {\n        runtimeStore.modalList.splice(rIndex, 1)\n      }\n    }, closeTime)\n  })\n}\n\nwatch(\n  () => props.modelValue,\n  n => {\n    if (n) {\n      id = Date.now()\n      runtimeStore.modalList.push({ id, close })\n      zIndex.value = 999 + runtimeStore.modalList.length\n      visible.value = true\n    } else {\n      close()\n    }\n  }\n)\n\nonMounted(() => {\n  if (props.modelValue === undefined) {\n    visible.value = true\n    id = Date.now()\n    runtimeStore.modalList.push({ id, close })\n    zIndex.value = 999 + runtimeStore.modalList.length\n  }\n})\n\nonUnmounted(() => {\n  if (props.modelValue === undefined) {\n    visible.value = false\n    let rIndex = runtimeStore.modalList.findIndex(item => item.id === id)\n    if (rIndex > -1) {\n      runtimeStore.modalList.splice(rIndex, 1)\n    }\n  }\n})\n\nuseEventListener('keyup', async (e: KeyboardEvent) => {\n  if (e.key === 'Escape' && props.keyboard) {\n    let lastItem = runtimeStore.modalList[runtimeStore.modalList.length - 1]\n    if (lastItem?.id === id) {\n      await cancel()\n    }\n  }\n})\n\nasync function ok() {\n  if (props.confirm) {\n    confirmButtonLoading.value = true\n    await props.confirm()\n    confirmButtonLoading.value = false\n  }\n  emit('ok')\n  await close()\n}\n\nasync function cancel() {\n  emit('cancel')\n  await close()\n}\n</script>\n\n<template>\n  <Teleport to=\"body\">\n    <div class=\"modal-root\" :style=\"{ 'z-index': zIndex }\" v-if=\"visible\">\n      <div class=\"modal-mask\" ref=\"maskRef\" v-if=\"!fullScreen\" @click.stop=\"closeOnClickBg && close()\"></div>\n      <div class=\"modal\" ref=\"modalRef\" :class=\"[fullScreen ? 'full' : 'window']\">\n        <Tooltip :title=\"localeT('close')\">\n          <IconFluentDismiss20Regular @click=\"close\" v-if=\"showClose\" class=\"close cursor-pointer\" width=\"24\" />\n        </Tooltip>\n        <div class=\"modal-header\" v-if=\"header\">\n          <div class=\"title\">{{ props.title }}</div>\n        </div>\n        <div class=\"modal-body\" :class=\"{ padding }\">\n          <slot></slot>\n          <div v-if=\"content\" class=\"content max-h-60vh\">{{ content }}</div>\n        </div>\n        <div class=\"modal-footer\" v-if=\"footer\">\n          <div class=\"left flex items-end\">\n            <slot name=\"footer-left\"></slot>\n          </div>\n          <div class=\"right\">\n            <BaseButton type=\"info\" @click=\"cancel\">{{ cancelButtonText || localeT('cancel') }}</BaseButton>\n            <BaseButton id=\"dialog-ok\" :loading=\"confirmButtonLoading\" @click=\"ok\"\n              >{{ confirmButtonText || localeT('confirm') }}\n            </BaseButton>\n          </div>\n        </div>\n      </div>\n    </div>\n  </Teleport>\n</template>\n\n<style scoped lang=\"scss\">\n$time: 0.3s;\n\n@keyframes bounce-in {\n  0% {\n    opacity: 0;\n  }\n  100% {\n    opacity: 1;\n  }\n}\n\n@keyframes bounce-in-full {\n  0% {\n    transform: scale(1.5);\n    opacity: 0;\n  }\n  100% {\n    transform: scale(1);\n    opacity: 1;\n  }\n}\n\n@keyframes fade-in {\n  0% {\n    opacity: 0;\n  }\n  100% {\n    opacity: 1;\n  }\n}\n\n.modal-root {\n  @apply fixed top-0 left-0 z-999 flex items-center justify-center w-full h-full overflow-hidden;\n\n  .modal-mask {\n    @apply fixed top-0 left-0 w-full h-full transition-all duration-300;\n    background: rgba(#000, 0.6);\n    animation: fade-in $time;\n\n    &.bounce-out {\n      @apply bg-transparent;\n    }\n  }\n\n  .window {\n    animation: bounce-in $time ease-out;\n    @apply shadow-lg rounded-lg;\n\n    &.bounce-out {\n      opacity: 0;\n    }\n  }\n\n  .full {\n    @apply w-full h-full;\n    animation: bounce-in-full $time ease-out;\n\n    &.bounce-out {\n      transform: scale(1.5);\n      opacity: 0;\n    }\n  }\n\n  .modal {\n    @apply relative overflow-hidden flex flex-col transition-all duration-300;\n    background: var(--color-card-bg);\n\n    .close {\n      @apply absolute right-1.2rem top-1.2rem z-999;\n    }\n\n    .modal-header {\n      @apply flex justify-between items-center p-5 pb-0 rounded-t-lg;\n\n      .title {\n        @apply font-bold text-xl;\n      }\n    }\n\n    .modal-body {\n      @apply box-border text-main-text font-normal text-base leading-6 w-full flex-1 overflow-hidden flex;\n\n      &.padding {\n        @apply p-1 px-5;\n      }\n\n      .content {\n        @apply w-64 p-2 px-4 pb-4;\n      }\n    }\n\n    .modal-footer {\n      @apply flex justify-between p-5;\n    }\n  }\n}\n</style>\n"],"names":["_computed","_ref","_push","_unref","_parent","_createBlock","_ssrInterpolate","_createTextVNode","_toDisplayString"],"mappings":"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"}