{"version":3,"file":"Slider-ibM1Ch1E.js","sources":["../../../../app/components/base/Slider.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport {nextTick, onMounted, ref, watch} from 'vue';\n\nconst props = defineProps({\n  modelValue: null,\n  min: null,\n  max: null,\n  step: null,\n  disabled: { type: Boolean },\n  showText: { type: Boolean },\n  showValue: { type: Boolean },\n  unit: null\n});\n\nconst emit = defineEmits(['update:modelValue']);\n\nconst min = props.min ?? 0;\nconst max = props.max ?? 100;\nconst step = props.step ?? 1;\n\nconst sliderRef = ref<HTMLElement | null>(null);\nconst isDragging = ref(false);\nconst sliderLeft = ref(0);\nconst sliderWidth = ref(0);\n\nconst currentValue = ref(props.modelValue);\n\nwatch(() => props.modelValue, (val) => {\n  currentValue.value = val;\n});\n\nconst valueToPercent = (value: number) => ((value - min) / (max - min)) * 100;\n\n// 计算一个数字的小数位数\nfunction countDecimals(value: number) {\n  if (Math.floor(value) === value) return 0;\n  const str = value.toString();\n  if (str.indexOf('e-') >= 0) {\n    // 科学计数法处理\n    const [, trail] = str.split('e-');\n    return parseInt(trail, 10);\n  }\n  return str.split('.')[1]?.length || 0;\n}\n\n// 对数值按步长对齐，并控制精度，避免浮点误差\nfunction alignToStep(value: number, step: number) {\n  const decimals = countDecimals(step);\n  return Number((Math.round(value / step) * step).toFixed(decimals));\n}\n\nconst percentToValue = (percent: number) => {\n  let val = min + ((max - min) * percent) / 100;\n  val = alignToStep(val, step);\n\n  if (val < min) val = min;\n  if (val > max) val = max;\n\n  return val;\n};\n\n\nconst updateSliderRect = () => {\n  if (!sliderRef.value) return;\n  const rect = sliderRef.value.getBoundingClientRect();\n  sliderLeft.value = rect.left;\n  sliderWidth.value = rect.width;\n};\n\nconst setValueFromPosition = (pageX: number) => {\n  let percent = ((pageX - sliderLeft.value) / sliderWidth.value) * 100;\n  if (percent < 0) percent = 0;\n  if (percent > 100) percent = 100;\n  currentValue.value = percentToValue(percent);\n  emit('update:modelValue', currentValue.value);\n};\n\nconst onMouseDown = (e: MouseEvent) => {\n  if (props.disabled) return;\n  e.preventDefault();\n  updateSliderRect();\n  isDragging.value = true;\n  setValueFromPosition(e.pageX);\n  window.addEventListener('mousemove', onMouseMove);\n  window.addEventListener('mouseup', onMouseUp);\n};\n\nconst onTouchStart = (e: TouchEvent) => {\n  if (props.disabled) return;\n  updateSliderRect();\n  isDragging.value = true;\n  setValueFromPosition(e.touches[0].pageX);\n  window.addEventListener('touchmove', onTouchMove);\n  window.addEventListener('touchend', onTouchEnd);\n};\n\nconst onMouseMove = (e: MouseEvent) => {\n  if (!isDragging.value) return;\n  e.preventDefault();\n  setValueFromPosition(e.pageX);\n};\n\nconst onTouchMove = (e: TouchEvent) => {\n  if (!isDragging.value) return;\n  setValueFromPosition(e.touches[0].pageX);\n};\n\nconst onMouseUp = () => {\n  if (!isDragging.value) return;\n  isDragging.value = false;\n  window.removeEventListener('mousemove', onMouseMove);\n  window.removeEventListener('mouseup', onMouseUp);\n};\n\nconst onTouchEnd = () => {\n  if (!isDragging.value) return;\n  isDragging.value = false;\n  window.removeEventListener('touchmove', onTouchMove);\n  window.removeEventListener('touchend', onTouchEnd);\n};\n\nconst onClickTrack = (e: MouseEvent) => {\n  if (props.disabled) return;\n  updateSliderRect();\n  setValueFromPosition(e.pageX);\n};\n\nonMounted(() => {\n  nextTick(() => {\n    updateSliderRect();\n    window.addEventListener('resize', updateSliderRect);\n  });\n});\n\n</script>\n\n<template>\n  <div class=\"w-full flex\">\n    <div class=\"flex-1\">\n      <div\n        ref=\"sliderRef\"\n        class=\"custom-slider\"\n        :class=\"{ 'is-disabled': disabled }\"\n        @mousedown=\"onClickTrack\"\n        @touchstart.prevent=\"onClickTrack\"\n      >\n        <div class=\"custom-slider__track\"></div>\n        <div\n          class=\"custom-slider__fill\"\n          :style=\"{ width: valueToPercent(currentValue) + '%' }\"\n        ></div>\n        <div\n          class=\"custom-slider__thumb\"\n          :style=\"{ left: valueToPercent(currentValue) + '%' }\"\n          @mousedown.stop.prevent=\"onMouseDown\"\n          @touchstart.stop.prevent=\"onTouchStart\"\n          tabindex=\"0\"\n          role=\"slider\"\n          :aria-valuemin=\"min\"\n          :aria-valuemax=\"max\"\n          :aria-valuenow=\"currentValue\"\n          :aria-disabled=\"disabled\"\n        ></div>\n      </div>\n      <div class=\"text flex justify-between text-sm color-gray\" v-if=\"showText\">\n        <span>{{ min }}</span>\n        <span>{{ max }}</span>\n      </div>\n    </div>\n    <div v-if=\"showValue\" class=\"w-10 pl-5 \">{{ currentValue }}{{ unit}}</div>\n  </div>\n</template>\n\n<style scoped lang=\"scss\">\n.custom-slider {\n  position: relative;\n  width: 100%;\n  height: 24px;\n  user-select: none;\n  touch-action: none;\n  cursor: pointer;\n\n  &.is-disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n  }\n\n  &__track {\n    position: absolute;\n    top: 50%;\n    left: 0;\n    right: 0;\n    height: 6px;\n    background-color: #ddd;\n    border-radius: 2px;\n    transform: translateY(-50%);\n  }\n\n  &__fill {\n    position: absolute;\n    top: 50%;\n    left: 0;\n    height: 6px;\n    background-color: #409eff;\n    border-radius: 2px 0 0 2px;\n    transform: translateY(-50%);\n    pointer-events: none;\n  }\n\n  &__thumb {\n    position: absolute;\n    top: 50%;\n    width: 16px;\n    height: 16px;\n    background-color: #fff;\n    border: 2px solid #409eff;\n    border-radius: 50%;\n    transform: translate(-50%, -50%);\n    cursor: grab;\n    transition: box-shadow 0.2s;\n  }\n\n  &__thumb:focus {\n    outline: none;\n    box-shadow: 0 0 5px #409eff;\n    cursor: grabbing;\n  }\n}\n</style>\n"],"names":["_ssrRenderAttrs","_mergeProps","_ssrRenderStyle","_ssrRenderAttr","_unref"],"mappings":";;;;;;;;;;;;;;;;;;AAGA,UAAM,QAAQ;AAad,UAAM,MAAM,MAAM,OAAO;AACzB,UAAM,MAAM,MAAM,OAAO;AACZ,UAAM,QAAQ;AAET,QAAwB,IAAI;AAC3B,QAAI,KAAK;AACT,QAAI,CAAC;AACJ,QAAI,CAAC;AAEzB,UAAM,eAAe,IAAI,MAAM,UAAU;AAEzC,UAAM,MAAM,MAAM,YAAY,CAAC,QAAQ;AACrC,mBAAa,QAAQ;AAAA,IACvB,CAAC;AAED,UAAM,iBAAiB,CAAC,WAAoB,QAAQ,QAAQ,MAAM,OAAQ;;mBA0GnEA,eAAAC,WAAA,EAAA,OAAM,iBAAa,MAAA,CAAA,sGAKO,QAAA,SAAA,GAAQ,eAAA,CAAA,sHAOdC,eAAA,EAAA,OAAA,eAAe,aAAA,KAAY,IAAA,IAAA,CAAA,qEAI5BA,eAAA,EAAA,MAAA,eAAe,aAAA,KAAY,IAAA,KAAA,gCAK1CC,cAAA,iBAAeC,MAAA,GAAA,CAAG,IAClBD,cAAA,iBAAeC,MAAA,GAAA,CAAG,IAClBD,cAAA,iBAAe,aAAA,KAAY,IAC3BA,cAAA,iBAAe,QAAA,QAAQ;UAGoC,QAAA,UAAQ;gIAC7DC,MAAA,GAAA,CAAG,gDACHA,MAAA,GAAA,CAAG;;;;;UAGL,QAAA,WAAS;uEAAwB,aAAA,KAAY,mBAAM,QAAA,IAAI;;;;;;;;;;;;;;;"}