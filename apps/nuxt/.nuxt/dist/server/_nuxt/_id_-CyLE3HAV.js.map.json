{"file":"_id_-CyLE3HAV.js","mappings":"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","names":["_ref","_push","_parent","_ssrInterpolate","_unref","_ssrRenderList","_","_scopeId","_toDisplayString","_createVNode","_createBlock","_Fragment","_renderList","_createTextVNode"],"sources":["../../../../app/pages/(words)/words-test/[id].vue"],"sourcesContent":["<script setup lang=\"ts\">import { ref as _ref } from 'vue';\n\nimport {onMounted, ref} from 'vue'\nimport BasePage from '@/components/BasePage.vue'\nimport BaseButton from '@/components/BaseButton.vue'\nimport VolumeIcon from '@/components/icon/VolumeIcon.vue'\nimport {useRoute, useRouter} from 'vue-router'\nimport {useBaseStore} from '@/stores/base.ts'\nimport type {Dict, Word} from '@/types/types.ts'\nimport {_getDictDataByUrl, shuffle} from '@/utils'\nimport {useRuntimeStore} from '@/stores/runtime.ts'\nimport {usePlayBeep, usePlayCorrect, usePlayWordAudio} from '@/hooks/sound.ts'\nimport Toast from '@/components/base/toast/Toast.ts'\nimport { emitter, EventKey, useEvents } from '~/utils/eventBus'\nimport { useStartKeyboardEventListener, getShortcutKey } from '@/hooks/event.ts'\nimport { ShortcutKey } from '~/types/enum'\nimport { useSettingStore } from '@/stores/setting.ts'\n\ntype Candidate = { word: string, wordObj?: Word }\ntype Question = {\n  stem: Word,\n  candidates: Candidate[],\n  optionTexts: string[],\n  correctIndex: number,\n  selectedIndex: number,\n  submitted: boolean\n}\n\nconst route = useRoute()\nconst router = useRouter()\nconst base = useBaseStore()\nconst runtimeStore = useRuntimeStore()\nconst playBeep = usePlayBeep()\nconst playCorrect = usePlayCorrect()\nconst playWordAudio = usePlayWordAudio()\n\nlet loading = _ref(false)\nlet dict = _ref<Dict>()\nlet questions = _ref<Question[]>([])\nlet index = _ref(0)\n\nfunction getWordByText(val: string, list: Word[]): Word | undefined {\n  let r = list.find(v => v.word.toLowerCase() === val.toLowerCase())\n  return r\n}\n\nfunction pickRelVariant(w: Word, list: Word[]): Candidate | null {\n  let rels = w.relWords?.rels || []\n  for (let i = 0; i < rels.length; i++) {\n    for (let j = 0; j < rels[i].words.length; j++) {\n      let c = rels[i].words[j].c\n      let r = getWordByText(c, list)\n      if (r && r.word.toLowerCase() !== w.word.toLowerCase()) {\n        return {word: r.word, wordObj: r}\n      }\n    }\n  }\n  return null\n}\n\nfunction pickSynonym(w: Word, list: Word[]): Candidate | null {\n  let synos = w.synos || []\n  for (let i = 0; i < synos.length; i++) {\n    for (let j = 0; j < synos[i].ws.length; j++) {\n      let c = synos[i].ws[j]\n      let r = getWordByText(c, list)\n      if (r && r.word.toLowerCase() !== w.word.toLowerCase()) {\n        return {word: r.word, wordObj: r}\n      }\n    }\n  }\n  return null\n}\n\nfunction pickSamePos(w: Word, list: Word[]): Candidate | null {\n  let pos = (w.trans?.[0]?.pos || '').trim()\n  let samePos = list.filter(v => v.word.toLowerCase() !== w.word.toLowerCase() && v.trans?.some(t => t.pos === pos))\n  if (samePos.length) {\n    let r = samePos[Math.floor(Math.random() * samePos.length)]\n    return {word: r.word, wordObj: r}\n  }\n  return null\n}\n\nfunction buildQuestion(w: Word, list: Word[]): Question {\n  let candidates: Candidate[] = []\n  candidates.push({word: w.word, wordObj: w})\n  let c1 = pickRelVariant(w, list) || pickSynonym(w, list) || pickSamePos(w, list)\n  let c2 = null as Candidate | null\n  let tried = new Set<string>([w.word.toLowerCase()])\n  if (c1) tried.add(c1.word.toLowerCase())\n  let attempts = 0\n  while (!c2 && attempts < 5) {\n    c2 = pickSynonym(w, list) || pickSamePos(w, list) || pickRelVariant(w, list)\n    if (c2 && tried.has(c2.word.toLowerCase())) c2 = null\n    attempts++\n  }\n  if (!c1) {\n    let rand = list.filter(v => v.word.toLowerCase() !== w.word.toLowerCase())\n    if (rand.length) c1 = {word: rand[Math.floor(Math.random() * rand.length)].word, wordObj: getWordByText(rand[Math.floor(Math.random() * rand.length)].word, list)}\n  }\n  if (!c2) {\n    let rand = list.filter(v => v.word.toLowerCase() !== w.word.toLowerCase() && v.word.toLowerCase() !== c1?.word.toLowerCase())\n    if (rand.length) c2 = {word: rand[Math.floor(Math.random() * rand.length)].word, wordObj: getWordByText(rand[Math.floor(Math.random() * rand.length)].word, list)}\n  }\n  if (c1) candidates.push(c1)\n  if (c2) candidates.push(c2)\n  const labels = candidates.map(v => formatCandidateText(v))\n  const order = shuffle([0,1,2])\n  const optionTexts = order.map(i => labels[i])\n  const correctIndex = order.indexOf(0)\n  return {\n    stem: w,\n    candidates,\n    optionTexts,\n    correctIndex,\n    selectedIndex: -1,\n    submitted: false\n  }\n}\n\nfunction formatCandidateText(c: Candidate): string {\n  const w = c.wordObj\n  if (!w || !w.trans || !w.trans.length) return '当前词典未收录释义'\n\n  const cleanCn = (cn: string, head: string) => {\n    let t = cn || ''\n    // 去掉含英文的括号片段（避免出现人名或英文拼写）\n    t = t.replace(/（[^）]*[A-Za-z][^）]*）/g, '')\n    // 去掉“时态/过去式/复数”等形态说明\n    t = t.replace(/(时\\s*态|过去式|过去分词|现在分词|复数|第三人称|比较级|最高级)[:：].*/g, '')\n    // 去掉直接出现的英文词头\n    const headEsc = head.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')\n    t = t.replace(new RegExp(headEsc, 'gi'), '')\n    // 统一分隔符为中文分号\n    t = t.replace(/[;；]\\s*/g, '；')\n    // 收尾空白\n    t = t.trim()\n    return t\n  }\n\n  const parts = w.trans\n    .map(v => {\n      const pos = (v.pos || '').trim()\n      const cn = cleanCn(v.cn || '', w.word)\n      if (/^\\s*【名】/.test(v.cn || '')) return ''\n      if (!cn) return ''\n      return `${pos ? '- ' + pos + ' ' : '- '}${cn}`\n    })\n    .filter(Boolean)\n\n  return parts.length ? parts.join('；') : '当前词典未收录释义'\n}\n\nasync function init() {\n  let dictId: any = route.params.id\n  let d = base.word.bookList.find(v => v.id === dictId)\n  if (!d) d = base.sdict\n  if (!d?.id) return router.push('/words')\n  if (!d.words.length && runtimeStore.editDict?.id === d.id) {\n    loading.value = true\n    let r = await _getDictDataByUrl(runtimeStore.editDict)\n    d = r\n    loading.value = false\n  }\n  dict.value = d\n  if (!dict.value.words.length) {\n    return Toast.warning('没有单词可测试！')\n  }\n  const wordList = shuffle(dict.value.words)\n  questions.value = wordList.map(w => buildQuestion(w, dict.value.words))\n  index.value = 0\n\n  Toast.info(\"可以按快捷键进行选择,例如按快捷键[\" + aShortcutKey + \"]选择A\", {duration: 3000})\n}\n\nfunction select(i: number) {\n  let q = questions.value[index.value]\n  if (!q || q.submitted) return\n  q.selectedIndex = i\n  q.submitted = true\n  if (i === q.correctIndex) {\n    playCorrect()\n  } else {\n    playBeep()\n    let temp = q.stem.word.toLowerCase()\n    if (!base.wrong.words.find((v: Word) => v.word.toLowerCase() === temp)) {\n      base.wrong.words.push(q.stem)\n      base.wrong.length = base.wrong.words.length\n    }\n  }\n}\n\nfunction next() {\n  if (index.value < questions.value.length - 1) index.value++\n}\n\nfunction end() {\n  router.back()\n}\n\nuseStartKeyboardEventListener()\n\nuseEvents([\n  [ShortcutKey.ChooseA, () => select(0)],\n  [ShortcutKey.ChooseB, () => select(1)],\n  [ShortcutKey.ChooseC, () => select(2)],\n  [ShortcutKey.Next, () => next()]\n])\n\nconst settingStore = useSettingStore()\n\nlet aShortcutKey = settingStore.shortcutKeyMap[ShortcutKey.ChooseA]\nlet bShortcutKey = settingStore.shortcutKeyMap[ShortcutKey.ChooseB]\nlet cShortcutKey = settingStore.shortcutKeyMap[ShortcutKey.ChooseC]\n\nlet nextShortcutKey = settingStore.shortcutKeyMap[ShortcutKey.Next]\n\nonMounted(init)\n</script>\n\n<template>\n  <BasePage>\n    <div class=\"card flex flex-col\">\n      <div class=\"flex items-center justify-between\">\n        <div class=\"page-title\">测试：{{ dict?.name }}</div>\n        <div class=\"text-base\">{{ index + 1 }} / {{ questions.length }}</div>\n      </div>\n      <div class=\"line my-2\"></div>\n\n      <div v-if=\"questions.length\" class=\"flex flex-col gap-4\">\n        <div class=\"text-2xl en-article-family flex items-center gap-2\">\n          <span>题目：{{ questions[index].stem.word }}</span>\n          <VolumeIcon :simple=\"true\" :title=\"'发音'\" :cb=\"() => playWordAudio(questions[index].stem.word)\"/>\n        </div>\n        <div style=\"height: 20px;\"></div>\n        <div class=\"grid gap-2\">\n          <div\n            v-for=\"(opt,i) in questions[index].optionTexts\"\n            :key=\"i\"\n            class=\"option border rounded p-2 cursor-pointer\"\n            :class=\"{\n              'text-green-600': questions[index].submitted && i === questions[index].correctIndex,\n              'text-red-600': questions[index].submitted && i === questions[index].selectedIndex && i !== questions[index].correctIndex\n            }\"\n            @click=\"select(i)\"\n          >\n            <span>\n              <span class=\"italic\">{{ ['A','B','C'][i] }}</span>  \n              [<span>{{ [aShortcutKey,bShortcutKey,cShortcutKey][i] }}</span>]\n              {{ opt }}\n            </span>\n          </div>\n        </div>\n\n        <div v-if=\"questions[index].submitted\" class=\"mt-4\">\n          <div class=\"mb-2 text-base\">选项解析：</div>\n          <div class=\"grid gap-2 grid-cols-1 md:grid-cols-3\">\n            <div v-for=\"(c,i) in questions[index].candidates\" :key=\"i\" class=\"p-2 rounded bg-[--bg-card-secend]\">\n              <div class=\"en-article-family text-lg\">{{ c.word }}</div>\n              <div class=\"mt-1 text-sm\">{{ c.wordObj?.trans?.map(v => v.cn).join('；') || '当前词典未收录释义' }}</div>\n            </div>\n          </div>\n        </div>\n\n        <div class=\"mt-6 flex\">\n          <BaseButton type=\"primary\" @click=\"next\">继续测试[{{ nextShortcutKey }}]</BaseButton>\n          <BaseButton type=\"info\" @click=\"end\">结束</BaseButton>\n        </div>\n      </div>\n    </div>\n  </BasePage>\n</template>\n\n<style scoped>\n.option:hover { background: var(--color-second); }\n.option {\n  height: 100px;\n  font-size: 20px;\n}\n</style>\n"],"version":3}