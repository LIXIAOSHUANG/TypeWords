{"file":"_id_-BZOaKl6z.js","mappings":"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","names":["_ref","_computed","_ssrRenderAttrs","_mergeProps","_ssrGetDirectiveProps","_unref","_ssrRenderComponent","_push","_parent","$t","_isRef","_ssrInterpolate","_createBlock","_createVNode","_ssrRenderClass","_ssrRenderList","$router"],"sources":["../../../../app/pages/(articles)/book/[id].vue"],"sourcesContent":["<script setup lang=\"ts\">import { ref as _ref, computed as _computed } from 'vue';\n\nimport BackIcon from '~/components/BackIcon.vue'\nimport Empty from '~/components/Empty.vue'\nimport ArticleList from '~/components/list/ArticleList.vue'\nimport { useBaseStore } from '~/stores/base.ts'\nimport type { Article, Dict } from '~/types/types.ts'\nimport { useRuntimeStore } from '~/stores/runtime.ts'\nimport BaseButton from '~/components/BaseButton.vue'\nimport { useRoute, useRouter } from 'vue-router'\nimport EditBook from '~/components/article/EditBook.vue'\nimport { computed, onMounted, onUnmounted, watch } from 'vue'\nimport { _dateFormat, _getDictDataByUrl, _nextTick, msToHourMinute, resourceWrap, total, useNav } from '~/utils'\nimport { getDefaultArticle, getDefaultDict } from '~/types/func.ts'\nimport Toast from '~/components/base/toast/Toast.ts'\nimport ArticleAudio from '~/components/article/ArticleAudio.vue'\nimport { MessageBox } from '~/utils/MessageBox.tsx'\nimport { useSettingStore } from '~/stores/setting.ts'\nimport { useFetch } from '@vueuse/core'\nimport { DICT_LIST } from '~/config/env.ts'\nimport BaseIcon from '~/components/BaseIcon.vue'\nimport Switch from '~/components/base/Switch.vue'\nimport { useGetDict } from '~/hooks/dict.ts'\nimport { DictType } from '~/types/enum.ts'\n\nconst runtimeStore = useRuntimeStore()\nconst settingStore = useSettingStore()\nconst store = useBaseStore()\nconst router = useRouter()\nconst route = useRoute()\nconst { nav } = useNav()\n\n// useHead({\n//   title: `${runtimeStore.editDict.name ?? ''}`,\n// })\n\nlet isEdit = _ref(false)\nlet isAdd = _ref(false)\nlet studyLoading = _ref(false)\nlet articleRef = _ref<HTMLDivElement>()\n\nlet selectArticle: Article = _ref(getDefaultArticle({ id: -1 }))\n\nfunction handleCheckedChange(val) {\n  selectArticle.value = val.item\n}\n\nasync function startPractice() {\n  let sbook = runtimeStore.editDict\n  if (!sbook.articles.length) {\n    return Toast.warning('没有文章可学习！')\n  }\n  studyLoading.value = true\n  await store.changeBook(sbook)\n  studyLoading.value = false\n\n  window.umami?.track('startStudyArticle', {\n    name: sbook.name,\n    custom: sbook.custom,\n    complete: sbook.complete,\n    s: `name:${sbook.name},index:${sbook.lastLearnIndex},title:${sbook.articles[sbook.lastLearnIndex].title}`,\n  })\n  nav('/practice-articles/' + sbook.id)\n}\n\nconst showBookDetail = computed(() => {\n  return !(isAdd.value || isEdit.value)\n})\n\nconst { loading } = useGetDict()\n\nonMounted(() => {\n  if (route.query?.isAdd) {\n    isAdd.value = true\n    runtimeStore.editDict = getDefaultDict()\n  }\n  window.addEventListener('resize', handleResize)\n})\n\nonUnmounted(() => {\n  window.removeEventListener('resize', handleResize)\n})\n\nfunction handleResize() {\n  if (displayMode.value === 'inline') {\n    positionTranslations()\n  }\n}\n\nfunction formClose() {\n  if (isEdit.value) isEdit.value = false\n  else router.back()\n}\n\nconst { data: book_list } = useFetch(resourceWrap(DICT_LIST.ARTICLE.ALL)).json()\n\nfunction reset() {\n  MessageBox.confirm(\n    '继续此操作会重置所有文章，并从官方书籍获取最新文章列表，学习记录不会被重置。确认恢复默认吗？',\n    '恢复默认',\n    async () => {\n      let dict = book_list.value.find(v => v.url === runtimeStore.editDict.url) as Dict\n      if (dict && dict.id) {\n        dict = await _getDictDataByUrl(dict, DictType.article)\n        let rIndex = store.article.bookList.findIndex(v => v.id === runtimeStore.editDict.id)\n        if (rIndex > -1) {\n          let item = store.article.bookList[rIndex]\n          item.custom = false\n          item.id = dict.id\n          item.articles = dict.articles\n          if (item.lastLearnIndex >= item.articles.length) {\n            item.lastLearnIndex = item.articles.length - 1\n          }\n          runtimeStore.editDict = item\n          Toast.success('恢复成功')\n          return\n        }\n      }\n      Toast.error('恢复失败')\n    }\n  )\n}\n\nconst currentPractice = _computed(() => {\n  if (runtimeStore.editDict.statistics?.length) {\n    return runtimeStore.editDict.statistics.filter(v => v.title === selectArticle.value.title)\n  }\n  return []\n})\n\nconst totalSpend = _computed(() => {\n  if (runtimeStore.editDict.statistics?.length) {\n    return msToHourMinute(total(runtimeStore.editDict.statistics, 'spend'))\n  }\n  return 0\n})\n\nfunction next() {\n  if (!settingStore.articleAutoPlayNext) return\n  startPlay.value = true\n  let index = runtimeStore.editDict.articles.findIndex(v => v.id === selectArticle.value.id)\n  if (index > -1) {\n    //如果是最后一个\n    if (index === runtimeStore.editDict.articles.length - 1) index = -1\n    selectArticle.value = runtimeStore.editDict.articles[index + 1]\n  }\n}\n\nconst list = _computed(() => {\n  return [\n    getDefaultArticle({\n      title: '介绍',\n      id: -1,\n    }),\n  ].concat(runtimeStore.editDict.articles)\n})\n\nlet showTranslate = _ref(true)\nlet startPlay = _ref(false)\nlet showDisplayMode = _ref(false)\nlet displayMode = _ref<'card' | 'inline' | 'line'>('inline')\nlet articleWrapperRef = _ref<HTMLElement>()\n\nconst handleVolumeUpdate = (volume: number) => {\n  settingStore.articleSoundVolume = volume\n}\n\nconst handleSpeedUpdate = (speed: number) => {\n  settingStore.articleSoundSpeed = speed\n}\n\n// 计算段落数量\nconst paragraphCount = _computed(() => {\n  if (!selectArticle.value.text) return 0\n  return selectArticle.value.text.split('\\n\\n').filter(p => p.trim()).length\n})\n\n// 判断是否应该在段落下显示译文（card 模式且段落数 > 1）\nconst shouldShowInlineTranslation = _computed(() => {\n  return displayMode.value === 'card' && paragraphCount.value > 1\n})\n\n// 定位翻译到原文下方\nfunction positionTranslations() {\n  if (loading.value || selectArticle.value.id === -1) return\n  _nextTick(() => {\n    const articleRect = articleWrapperRef.value.getBoundingClientRect()\n    selectArticle.value.textTranslate.split('\\n\\n').forEach((paragraph, paraIndex) => {\n      paragraph.split('\\n').forEach((sentence, sentIndex) => {\n        const location = `${paraIndex}-${sentIndex}`\n        const sentenceClassName = `.word-${location}-0`\n        const sentenceEl = articleWrapperRef.value?.querySelector(sentenceClassName)\n        const translateClassName = `.translate-${location}`\n        const translateEl = articleWrapperRef.value?.querySelector(translateClassName) as HTMLDivElement\n\n        if (sentenceEl && translateEl && sentence) {\n          const sentenceRect = sentenceEl.getBoundingClientRect()\n          translateEl.style.opacity = '1'\n          translateEl.style.top = sentenceRect.top - articleRect.top + 24 + 'px'\n          const spaceEl = translateEl.firstElementChild as HTMLElement\n          if (spaceEl) {\n            spaceEl.style.width = sentenceRect.left - articleRect.left + 'px'\n          }\n        }\n      })\n    })\n  })\n}\n\n// 监听显示模式和文章变化，重新定位翻译\nwatch([() => displayMode.value, () => selectArticle.value.id, () => showTranslate.value], () => {\n  if (displayMode.value !== 'card') {\n    positionTranslations()\n  }\n})\n\nwatch(\n  () => selectArticle.value.id,\n  () => {\n    _nextTick(() => {\n      articleRef.value?.scrollTo(0, 0)\n    })\n  }\n)\n</script>\n\n<template>\n  <div class=\"center h-screen\">\n    <div\n      class=\"bg-second w-full 3xl:w-7/10 2xl:w-8/10 xl:w-full 2xl:card 2xl:h-[97vh] h-full p-3 box-border overflow-hidden mb-0\"\n    >\n      <div class=\"flex box-border flex-col h-full\" v-if=\"showBookDetail\" v-loading=\"loading\">\n        <div class=\"dict-header flex justify-between items-center relative\">\n          <div class=\"flex gap-space\">\n            <BackIcon class=\"dict-back z-2\" />\n            <div class=\"dict-title text-2xl text-align-center\">{{ runtimeStore.editDict.name }}</div>\n          </div>\n          <div class=\"dict-actions flex\">\n            <BaseButton v-if=\"runtimeStore.editDict.custom && runtimeStore.editDict.url\" type=\"info\" @click=\"reset\">\n              {{ $t('restore_default') }}\n            </BaseButton>\n            <BaseButton :loading=\"studyLoading || loading\" type=\"info\" @click=\"isEdit = true\">{{ $t('edit') }}</BaseButton>\n            <BaseButton type=\"info\" @click=\"router.push('/batch-edit-article')\">{{ $t('article_management') }}</BaseButton>\n            <BaseButton :loading=\"studyLoading || loading\" @click=\"startPractice\">{{ $t('learn') }}</BaseButton>\n          </div>\n        </div>\n        <div class=\"flex flex-1 overflow-hidden mt-3\">\n          <div class=\"3xl:w-80 2xl:w-60 xl:w-55 lg:w-50 overflow-auto\">\n            <ArticleList\n              :show-desc=\"true\"\n              v-if=\"list.length\"\n              @click=\"handleCheckedChange\"\n              :list=\"list\"\n              :active-id=\"selectArticle.id\"\n            >\n            </ArticleList>\n            <Empty v-else />\n          </div>\n          <div class=\"flex-1 shrink-0 pl-4 flex flex-col overflow-hidden\">\n            <template v-if=\"selectArticle.id\">\n              <template v-if=\"selectArticle.id === -1\">\n                <div class=\"flex gap-4 mt-2\">\n                  <NuxtImg\n                    :src=\"runtimeStore.editDict?.cover\"\n                    class=\"w-30 rounded-md\"\n                    v-if=\"runtimeStore.editDict?.cover\"\n                    alt=\"\"\n                  />\n                  <div class=\"text-lg\">{{ runtimeStore.editDict.description }}</div>\n                </div>\n                <div class=\"text-base mt-10\" v-if=\"totalSpend\">{{ $t('total_study_time') }}：{{ totalSpend }}</div>\n              </template>\n              <template v-else>\n                <div ref=\"articleRef\" class=\"flex-1 overflow-auto pb-30\">\n                  <div>\n                    <div class=\"flex justify-between items-center relative\">\n                      <span>\n                        <span class=\"text-3xl\">{{ selectArticle.title }}</span>\n                        <span class=\"ml-6 text-2xl\" v-if=\"showTranslate\">{{ selectArticle.titleTranslate }}</span>\n                      </span>\n                      <div class=\"flex items-center gap-2 mr-4\">\n                        <BaseIcon :title=\"$t('toggle_translation')\" @click=\"showTranslate = !showTranslate\">\n                          <IconPhTranslate v-if=\"showTranslate\" />\n                          <IconFluentTranslateOff16Regular v-else />\n                        </BaseIcon>\n                        <BaseIcon\n                          :disabled=\"!showTranslate\"\n                          :title=\"$t('switch_display_mode')\"\n                          @click=\"showDisplayMode = !showDisplayMode\"\n                        >\n                          <IconFluentTextAlignLeft16Regular />\n                        </BaseIcon>\n                      </div>\n                    </div>\n\n                    <div class=\"flex gap-1 mr-4 justify-end\" v-if=\"showDisplayMode\">\n                      <BaseIcon :title=\"$t('line_by_line')\" @click=\"displayMode = 'inline'\">\n                        <IconFluentTextPositionThrough20Regular />\n                      </BaseIcon>\n                      <BaseIcon :title=\"$t('single_line')\" @click=\"displayMode = 'line'\">\n                        <IconFluentTextAlignLeft16Regular />\n                      </BaseIcon>\n                      <BaseIcon :title=\"$t('comparison')\" @click=\"displayMode = 'card'\">\n                        <IconFluentAlignSpaceFitVertical20Regular />\n                      </BaseIcon>\n                    </div>\n\n                    <div class=\"mt-2 text-2xl\" v-if=\"selectArticle?.question?.text\">\n                      <div>Question: {{ selectArticle?.question?.text }}</div>\n                      <div\n                        class=\"text-xl color-translate-second\"\n                        v-if=\"showTranslate && (displayMode !== 'card' || shouldShowInlineTranslation)\"\n                      >\n                        {{ $t('question') }}: {{ selectArticle?.question?.translate }}\n                      </div>\n                    </div>\n                  </div>\n\n                  <div\n                    class=\"article-content mt-6\"\n                    :class=\"[showTranslate && displayMode !== 'card' && 'tall']\"\n                    ref=\"articleWrapperRef\"\n                  >\n                    <article>\n                      <template v-for=\"(t, i) in selectArticle.text.split('\\n\\n')\" :key=\"`para-${i}`\">\n                        <div class=\"article-row w-full mb-10\">\n                          <span\n                            :class=\"displayMode === 'line' && 'block'\"\n                            v-for=\"(w, j) in t.split('\\n')\"\n                            :key=\"`${i}-${j}`\"\n                          >\n                            <span\n                              v-for=\"(s, n) in w.split(' ').filter(Boolean)\"\n                              :class=\"`inline-block word-${i}-${j}-${n}`\"\n                              :key=\"`${i}-${j}-${n}`\"\n                              ><span>{{ s }}</span>\n                              <span class=\"space\"></span>\n                            </span>\n                          </span>\n                        </div>\n\n                        <!-- 当 card 模式且段落数 > 1 时，在每个段落下显示对应译文 -->\n                        <div\n                          v-if=\"shouldShowInlineTranslation && showTranslate && selectArticle.textTranslate\"\n                          class=\"trans-row text-xl color-translate-second -mt-7 mb-10\"\n                        >\n                          <div v-if=\"selectArticle.textTranslate.split('\\n\\n')[i]\">\n                            {{ selectArticle.textTranslate.split('\\n\\n')[i] }}\n                          </div>\n                        </div>\n                      </template>\n                      <div class=\"text-right italic\">\n                        <div class=\"text-2xl\" v-if=\"selectArticle?.quote?.text\">{{ selectArticle?.quote?.text }}</div>\n                        <div\n                          class=\"trans-row text-xl color-translate-second\"\n                          v-if=\"\n                            selectArticle?.quote?.translate &&\n                            showTranslate &&\n                            (displayMode !== 'card' || shouldShowInlineTranslation)\n                          \"\n                        >\n                          {{ selectArticle?.quote?.translate }}\n                        </div>\n                      </div>\n                    </article>\n\n                    <template v-if=\"showTranslate && selectArticle.textTranslate\">\n                      <div class=\"translate color-translate-second\" v-if=\"displayMode !== 'card'\">\n                        <div\n                          class=\"break-words w-full section\"\n                          v-for=\"(t, i) in selectArticle.textTranslate.split('\\n\\n')\"\n                        >\n                          <div v-for=\"(w, j) in t.split('\\n')\" :class=\"`row translate-${i}-${j}`\" :key=\"`${i}-${j}`\">\n                            <span class=\"space\"></span>\n                            <span>{{ w }}</span>\n                          </div>\n                        </div>\n                      </div>\n                      <template v-else>\n                        <!-- 当段落数 <= 1 时，保持原样在文章末尾显示译文 -->\n                        <template v-if=\"!shouldShowInlineTranslation\">\n                          <div class=\"line my-10\"></div>\n                          <div class=\"text-xl line-height-normal space-y-5\">\n                            <div class=\"mt-2\" v-if=\"selectArticle?.question?.translate\">\n                              问题: {{ selectArticle?.question?.translate }}\n                            </div>\n                            <div class=\"trans-row\" v-for=\"t in selectArticle.textTranslate.split('\\n\\n')\">{{ t }}</div>\n                            <div class=\"trans-row text-right italic\">{{ selectArticle?.quote?.translate }}</div>\n                          </div>\n                        </template>\n                      </template>\n                    </template>\n                  </div>\n                  <template v-if=\"currentPractice.length\">\n                    <div class=\"line my-10\"></div>\n                    <div class=\"font-family text-base pr-2\">\n                      <div class=\"text-2xl font-bold\">{{ $t('study_record') }}</div>\n                      <div class=\"mt-1 mb-3\">{{ $t('total_study_time') }}：{{ msToHourMinute(total(currentPractice, 'spend')) }}</div>\n                      <div\n                        class=\"item border border-item border-solid mt-2 p-2 bg-[var(--bg-history)] rounded-md flex justify-between\"\n                        v-for=\"i in currentPractice\"\n                      >\n                        <span class=\"color-gray\">{{ _dateFormat(i.startDate) }}</span>\n                        <span>{{ msToHourMinute(i.spend) }}</span>\n                      </div>\n                    </div>\n                  </template>\n                </div>\n                <div\n                  v-if=\"selectArticle.audioSrc || selectArticle.audioFileId\"\n                  class=\"border-t-1 border-t-gray-300 border-solid border-0 center gap-2 pt-4\"\n                >\n                  <ArticleAudio\n                    :article=\"selectArticle\"\n                    @update-speed=\"handleSpeedUpdate\"\n                    @update-volume=\"handleVolumeUpdate\"\n                    :autoplay=\"settingStore.articleAutoPlayNext && startPlay\"\n                    @ended=\"next\"\n                  />\n                  <div class=\"flex items-center gap-1\">\n                    <span>{{ $t('play_next_after_end') }}</span>\n                    <Switch v-model=\"settingStore.articleAutoPlayNext\" />\n                  </div>\n                </div>\n              </template>\n            </template>\n            <Empty v-else />\n          </div>\n        </div>\n      </div>\n      <div class=\"\" v-else>\n        <div class=\"dict-header flex justify-between items-center relative\">\n          <BackIcon class=\"dict-back z-2\" @click=\"isAdd ? $router.back() : (isEdit = false)\" />\n          <div class=\"dict-title absolute text-2xl text-align-center w-full\">\n            {{ runtimeStore.editDict.id ? $t('edit_book') : $t('create_book') }}\n          </div>\n        </div>\n        <div class=\"center\">\n          <EditBook :is-add=\"isAdd\" :is-book=\"true\" @close=\"formClose\" @submit=\"isEdit = isAdd = false\" />\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<style scoped lang=\"scss\">\n.dict-detail-card {\n  height: calc(100vh - 3rem);\n}\n\n.dict-header {\n  gap: 0.5rem;\n}\n\n.dict-actions {\n  flex-wrap: wrap;\n}\n\n// 打字式显示模式样式（复用 TypingArticle 的样式）\n$translate-lh: 3.2;\n$article-lh: 2.4;\n\n.article-content {\n  position: relative;\n  font-size: 1.6rem;\n\n  &.tall {\n    article {\n      line-height: $article-lh;\n      color: var(--color-article);\n    }\n  }\n\n  .article-row {\n    word-break: keep-all;\n    word-wrap: break-word;\n    white-space: pre-wrap;\n  }\n\n  .trans-row {\n    @apply cn-article-family font-bold;\n  }\n\n  article {\n    @apply en-article-family;\n  }\n\n  .translate {\n    @apply absolute top-0 left-0 h-full w-full text-xl pointer-events-none font-bold cn-article-family;\n    line-height: $translate-lh;\n    letter-spacing: 0.2rem;\n\n    .row {\n      @apply absolute left-0 w-full opacity-0 transition-all duration-300;\n    }\n  }\n}\n\n.space {\n  @apply inline-block w-2 transition-all duration-300;\n}\n\n.sentence-translate-mobile {\n  display: none;\n  margin-top: 0.4rem;\n  font-size: 0.9rem;\n  line-height: 1.4;\n  color: var(--color-font-3);\n  font-family: var(--zh-article-family);\n  word-break: break-word;\n}\n\n@media (max-width: 768px) {\n  .dict-detail-card {\n    height: calc(100vh - 2rem);\n  }\n\n  .dict-header {\n    width: 100%;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    text-align: center;\n    gap: 0.75rem;\n  }\n\n  .dict-header .dict-back {\n    align-self: flex-start;\n  }\n\n  .dict-header .dict-title {\n    position: static !important;\n    width: 100%;\n  }\n\n  .dict-header .dict-actions {\n    width: 100%;\n    justify-content: center;\n    gap: 0.75rem;\n\n    .base-button {\n      flex: 1 0 45%;\n      min-width: 8rem;\n    }\n  }\n}\n\n@media (max-width: 480px) {\n  .dict-header .dict-actions {\n    flex-direction: column;\n\n    .base-button {\n      width: 100%;\n      min-width: auto;\n    }\n  }\n}\n\n// 移动端适配 - 打字式显示模式\n@media (max-width: 768px) {\n  .article-content {\n    article {\n      .section {\n        margin-bottom: 1rem;\n\n        .sentence {\n          font-size: 1rem;\n          line-height: 1.6;\n          word-break: break-word;\n          margin-bottom: 0.5rem;\n        }\n      }\n    }\n\n    .translate {\n      display: none;\n    }\n  }\n\n  .sentence-translate-mobile {\n    display: block;\n  }\n}\n\n@media (max-width: 480px) {\n  .article-content {\n    article {\n      .section {\n        .sentence {\n          font-size: 0.9rem;\n          line-height: 1.5;\n        }\n      }\n    }\n  }\n\n  .sentence-translate-mobile {\n    font-size: 0.85rem;\n    line-height: 1.35;\n  }\n}\n</style>\n"],"version":3}