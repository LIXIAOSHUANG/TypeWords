{"file":"user-BLvskJR1.js","mappings":";;;;AAqEO,SAAS,SAAS,QAAqB;AAC5C,SAAOA,QAAuB,cAAc,QAAQ,MAAM,MAAM;AAClE;AAEO,SAAS,YAAY,QAAwB;AAClD,SAAOA,QAAuB,iBAAiB,QAAQ,MAAM,MAAM;AACrE;AAEO,SAAS,SAAS,QAAwB;AAC/C,SAAOA,QAAc,iBAAiB,MAAM,QAAQ,KAAK;AAC3D;AAEO,SAAS,iBAAiB,QAA6B;AAC5D,SAAOA,QAAc,sBAAsB,QAAQ,MAAM,MAAM;AACjE;AAWO,SAAS,cAAc;AAC5B,SAAOA,QAAW,iBAAiB,MAAM,MAAM,KAAK;AACtD;AAGO,SAAS,YAAY,MAAM;AAChC,SAAOA,QAAK,oBAAoB,MAAM,MAAM,MAAM;AACpD;AAGO,SAAS,eAAe,MAAM;AACnC,SAAOA,QAAK,oBAAoB,MAAM,MAAM,MAAM;AACpD;AAGO,SAAS,eAAe,MAAM;AACnC,SAAOA,QAAK,oBAAoB,MAAM,MAAM,MAAM;AACpD;AAGO,SAAS,kBAAkB,MAAM;AACtC,SAAOA,QAAK,uBAAuB,MAAM,MAAM,MAAM;AACvD;AC7GO,MAAM,eAAe,YAAY,QAAQ,MAAM;AACpD,QAAM,OAAO,IAAiB,IAAI;AAClC,QAAM,UAAU,IAAa,KAAK;AAGlC,QAAM,WAAW,CAAC,aAAqB;AACrC,YAAQ,QAAQ;AAChB,WAAO,QAAQ;AACf,WAAO,WAAW,CAAC,CAAC,OAAO;AAC3B,WAAO,cAAc,OAAO,YAAY,OAAO;AAC/C,iBAAa,QAAQ,SAAS,QAAQ;AAAA,EACxC;AAGA,QAAM,aAAa,MAAM;AACvB,WAAO,WAAW,OAAO,cAAc;AACvC,WAAO,QAAQ;AACf,iBAAa,WAAW,OAAO;AAC/B,YAAQ,QAAQ;AAChB,SAAK,QAAQ;AAAA,EACf;AAGA,QAAM,UAAU,CAAC,aAAmB;AAClC,SAAK,QAAQ;AACb,YAAQ,QAAQ;AAAA,EAClB;AAGA,WAAS,SAAS;AAChB,eAAA;AACA,UAAM,QAAQ,OAAO;AAAA,EAGvB;AAGA,iBAAe,gBAAgB;AAC7B,QAAI,CAAC,OAAO,YAAa,QAAO;AAChC,QAAI;AACF,YAAM,MAAM,MAAM,YAAA;AAClB,UAAI,IAAI,SAAS;AACf,gBAAQ,IAAI,IAAI;AAChB,eAAO;AAAA,MACT;AACA,aAAO;AAAA,IACT,SAAS,OAAO;AACd,cAAQ,MAAM,wBAAwB,KAAK;AAC3C,aAAO;AAAA,IACT;AAAA,EACF;AAIA,iBAAe,OAAO;AACpB,UAAM,UAAU,MAAM,cAAA;AACtB,QAAI,CAAC,SAAS;AACZ,iBAAA;AAAA,IACF;AAAA,EACF;AAEA,SAAO;AAAA,IACL;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EAAA;AAEJ,CAAC;","names":["http"],"sources":["../../../../app/apis/user.ts","../../../../app/stores/user.ts"],"sourcesContent":["import http from '@/utils/http.ts'\n\nimport {CodeType} from \"@/types/enum.ts\";\n\n// 用户登录接口\nexport interface LoginParams {\n  account?: string\n  password?: string\n  phone?: string\n  code?: string\n  type: 'code' | 'pwd'\n}\n\nexport interface User {\n  id: string\n  email?: string\n  phone?: string\n  username?: string\n  avatar?: string,\n  hasPwd?: boolean,\n  member: {\n    levelDesc: string,\n    status: string,\n    active: boolean,\n    endDate: number,\n    autoRenew: boolean,\n    plan: string,\n    planDesc: string,\n  }\n}\n\n\n// 用户注册接口\nexport interface RegisterParams {\n  account: string\n  password: string\n  code: string\n}\n\nexport interface RegisterResponse {\n  token: string\n  user: {\n    id: string\n    email?: string\n    phone: string\n    nickname?: string\n    avatar?: string\n  }\n}\n\n// 发送验证码接口\nexport interface SendCodeParams {\n  val: string\n  type: CodeType\n}\n\n// 重置密码接口\nexport interface ResetPasswordParams {\n  account: string\n  code: string\n  newPassword: string\n}\n\n// 微信登录接口\nexport interface WechatLoginParams {\n  code: string\n  state?: string\n}\n\nexport function loginApi(params: LoginParams) {\n  return http<{ token:string }>('user/login', params, null, 'post')\n}\n\nexport function registerApi(params: RegisterParams) {\n  return http<{ token:string }>('user/register', params, null, 'post')\n}\n\nexport function sendCode(params: SendCodeParams) {\n  return http<boolean>('user/sendCode', null, params, 'get')\n}\n\nexport function resetPasswordApi(params: ResetPasswordParams) {\n  return http<boolean>('user/resetPassword', params, null, 'post')\n}\n\nexport function wechatLogin(params: WechatLoginParams) {\n  return http<User>('user/wechatLogin', params, null, 'post')\n}\n\nexport function refreshToken() {\n  return http<{ token: string }>('user/refreshToken', null, null, 'post')\n}\n\n// 获取用户信息\nexport function getUserInfo() {\n  return http<User>('user/userInfo', null, null, 'get')\n}\n\n// 设置密码\nexport function setPassword(data) {\n  return http('user/setPassword', data, null, 'post')\n}\n\n// 修改邮箱\nexport function changeEmailApi(data) {\n  return http('user/changeEmail', data, null, 'post')\n}\n\n// 修改手机号\nexport function changePhoneApi(data) {\n  return http('user/changePhone', data, null, 'post')\n}\n\n// 修改用户信息\nexport function updateUserInfoApi(data) {\n  return http('user/updateUserInfo', data, null, 'post')\n}\n","import { defineStore } from 'pinia'\nimport { ref } from 'vue'\nimport { getUserInfo } from '@/apis/user'\nimport type { User } from '@/apis/user'\nimport { AppEnv } from \"@/config/env\";\nimport Toast from \"@/components/base/toast/Toast\";\n\nexport const useUserStore = defineStore('user', () => {\n  const user = ref<User | null>(null)\n  const isLogin = ref<boolean>(false)\n\n  // 设置token\n  const setToken = (newToken: string) => {\n    isLogin.value = true\n    AppEnv.TOKEN = newToken\n    AppEnv.IS_LOGIN = !!AppEnv.TOKEN\n    AppEnv.CAN_REQUEST = AppEnv.IS_LOGIN && AppEnv.IS_OFFICIAL\n    localStorage.setItem('token', newToken)\n  }\n\n  // 清除token\n  const clearToken = () => {\n    AppEnv.IS_LOGIN = AppEnv.CAN_REQUEST = false\n    AppEnv.TOKEN = ''\n    localStorage.removeItem('token')\n    isLogin.value = false\n    user.value = null\n  }\n\n  // 设置用户信息\n  const setUser = (userInfo: User) => {\n    user.value = userInfo\n    isLogin.value = true\n  }\n\n  // 登出\n  function logout() {\n    clearToken()\n    Toast.success('已退出登录')\n    //这行会引起hrm失效\n    // router.push('/')\n  }\n\n  // 获取用户信息\n  async function fetchUserInfo() {\n    if (!AppEnv.CAN_REQUEST) return false\n    try {\n      const res = await getUserInfo()\n      if (res.success) {\n        setUser(res.data)\n        return true\n      }\n      return false\n    } catch (error) {\n      console.error('Get user info error:', error)\n      return false\n    }\n  }\n\n\n  // 初始化用户状态\n  async function init() {\n    const success = await fetchUserInfo()\n    if (!success) {\n      clearToken()\n    }\n  }\n\n  return {\n    user,\n    isLogin,\n    setToken,\n    clearToken,\n    setUser,\n    logout,\n    fetchUserInfo,\n    init\n  }\n})\n"],"version":3}