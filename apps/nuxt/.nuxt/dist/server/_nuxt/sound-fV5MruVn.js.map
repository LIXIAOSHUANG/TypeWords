{"version":3,"file":"sound-fV5MruVn.js","sources":["../../../../app/hooks/sound.ts"],"sourcesContent":["import { onMounted, watchEffect } from 'vue'\nimport { useSettingStore } from '@/stores/setting'\n\nimport { ENV, PronunciationApi, SoundFileOptions } from '@/config/env'\n\nexport function useSound(audioSrcList?: string[], audioFileLength?: number) {\n  let audioList: HTMLAudioElement[] = $ref([])\n  let audioLength = $ref(1)\n  let index = $ref(0)\n\n  onMounted(() => {\n    if (audioSrcList) setAudio(audioSrcList, audioFileLength)\n  })\n\n  //这里同一个音频弄好几份是为了快速打字是，可同时发音\n  function setAudio(audioSrcList2: string[], audioFileLength2?: number) {\n    if (audioFileLength2) audioLength = audioFileLength2\n    audioList = []\n    for (let i = 0; i < audioLength; i++) {\n      audioSrcList2.map(src => audioList.push(new Audio(ENV.RESOURCE_URL + src)))\n    }\n    index = 0\n  }\n\n  function play(volume: number = 100) {\n    index++\n    if (audioList.length > 1 && audioList.length !== audioLength) {\n      audioList[index % audioList.length].volume = volume / 100\n      audioList[index % audioList.length].play()\n    } else {\n      audioList[index % audioLength].volume = volume / 100\n      audioList[index % audioLength].play()\n    }\n  }\n\n  return { play, setAudio }\n}\n\nexport function usePlayKeyboardAudio() {\n  const settingStore = useSettingStore()\n  const { play, setAudio } = useSound()\n\n  watchEffect(() => {\n    if (!SoundFileOptions.find(v => v.label === settingStore.keyboardSoundFile)) {\n      settingStore.keyboardSoundFile = '机械键盘2'\n    }\n    let urlList = getAudioFileUrl(settingStore.keyboardSoundFile)\n    setAudio(urlList, urlList.length === 1 ? 4 : 1)\n  })\n\n  function playAudio() {\n    if (settingStore.keyboardSound) {\n      play(settingStore.keyboardSoundVolume)\n    }\n  }\n\n  return playAudio\n}\n\nexport function usePlayBeep() {\n  const settingStore = useSettingStore()\n  const { play } = useSound([`/sound/beep.wav`], 1)\n\n  function playAudio() {\n    if (settingStore.effectSound) {\n      play(settingStore.effectSoundVolume)\n    }\n  }\n\n  return playAudio\n}\n\nexport function usePlayCorrect() {\n  const settingStore = useSettingStore()\n  const { play } = useSound([`/sound/correct.wav`], 1)\n\n  function playAudio() {\n    if (settingStore.effectSound) {\n      play(settingStore.effectSoundVolume)\n    }\n  }\n\n  return playAudio\n}\n\nexport function usePlayWordAudio() {\n  const settingStore = useSettingStore()\n  let audio = $ref<HTMLAudioElement>(null)\n\n  onMounted(() => {\n    audio = new Audio()\n  })\n\n  function playAudio(word: string) {\n    if (!word) return\n    let url = `${PronunciationApi}${word}&type=2`\n    if (settingStore.soundType === 'uk') {\n      url = `${PronunciationApi}${word}&type=1`\n    }\n    audio.src = url\n    audio.volume = settingStore.wordSoundVolume / 100\n    audio.playbackRate = settingStore.wordSoundSpeed\n    audio.play()\n    audio.onerror = e => {\n      const ttsPlay = useTTsPlayAudio()\n      ttsPlay(word)\n    }\n  }\n\n  return playAudio\n}\n\nexport function useTTsPlayAudio() {\n  const settingStore = useSettingStore()\n\n  function play(text: string) {\n    speechSynthesis.cancel() // 防止 Chrome 队列卡死\n    let msg = new SpeechSynthesisUtterance(text)\n    msg.rate = settingStore.wordSoundSpeed\n    msg.volume = settingStore.wordSoundVolume / 100\n    msg.pitch = 1\n    msg.lang = 'en-US'\n    let voiceList = speechSynthesis.getVoices().filter(v => v.lang === 'en-US')\n    if (voiceList && voiceList.length) {\n      msg.voice = voiceList.find(v => v.name.includes('Emma ')) || voiceList[0]\n    }\n    speechSynthesis.speak(msg)\n  }\n\n  return play\n}\n\nexport function usePlayAudio(url: string) {\n  new Audio(url).play().then(r => void 0)\n}\n\nexport function getAudioFileUrl(name: string) {\n  if (name === '机械键盘') {\n    return [\n      `/sound/key-sounds/jixie/机械0.mp3`,\n      `/sound/key-sounds/jixie/机械1.mp3`,\n      `/sound/key-sounds/jixie/机械2.mp3`,\n      `/sound/key-sounds/jixie/机械3.mp3`,\n    ]\n  } else {\n    return [`/sound/key-sounds/${name}.mp3`]\n  }\n}\n"],"names":["_ref"],"mappings":"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"}