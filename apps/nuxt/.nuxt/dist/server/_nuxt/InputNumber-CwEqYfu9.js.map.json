{"file":"InputNumber-CwEqYfu9.js","mappings":";;;;;;;;;;;;;;;;;AA4CA,UAAM,QAAQ;AAUd,UAAM,OAAO;AAEI,QAA6B,IAAI;AAClD,UAAM,QAAQ,IAAmB,kBAAkB,MAAM,UAAU,CAAC;AAIpE,UAAM,MAAM,MAAM,YAAY,CAAC,UAAkB;AAC/C,YAAM,QAAQ;AAAA,IAChB,CAAC;AACD,UAAM,eAAe,SAAS;AAAA,MAC5B,KAAK,MAAM,MAAM,UAAU,OAAO,KAAK,OAAO,MAAM,KAAK;AAAA,MACzD,KAAK,CAAA,MAAK;AACR,cAAM,IAAI,WAAW,CAAC;AACtB,YAAI,MAAM,UAAW;AACrB,iBAAS,CAAC;AAAA,MACZ;AAAA,IAAA,CACD;AAED,UAAM,QAAQ,SAAS,MAAM,MAAM,UAAU,QAAQ,MAAM,SAAS,MAAM,GAAG;AAC7E,UAAM,QAAQ,SAAS,MAAM,MAAM,UAAU,QAAQ,MAAM,SAAS,MAAM,GAAG;AAE7E,aAAS,kBAAkB,GAAuB;AAChD,YAAM,IAAI,OAAO,CAAC;AAClB,aAAO,OAAO,SAAS,CAAC,IAAI,IAAI;AAAA,IAClC;AAEA,aAAS,MAAM,GAAkB;AAC/B,UAAI,MAAM,KAAM,QAAO;AACvB,UAAI,IAAI,MAAM,IAAK,QAAO,MAAM;AAChC,UAAI,IAAI,MAAM,IAAK,QAAO,MAAM;AAChC,aAAO;AAAA,IACT;AAEA,aAAS,OAAO,GAAW;AACzB,aAAO,MAAM,aAAa,OAAO,EAAE,QAAQ,MAAM,SAAS,IAAI,OAAO,CAAC;AAAA,IACxE;AAEA,aAAS,WAAW,GAAsC;AACxD,YAAM,UAAU,EAAE,KAAA;AAClB,UAAI,CAAC,IAAI,KAAK,KAAK,KAAK,MAAM,IAAI,EAAE,SAAS,OAAO,EAAG,QAAO;AAC9D,YAAM,IAAI,OAAO,OAAO;AACxB,aAAO,OAAO,SAAS,CAAC,IAAI,IAAI;AAAA,IAClC;AAEA,aAAS,gBAAgB,GAAkB;AACzC,UAAI,MAAM,KAAM,QAAO;AACvB,UAAI,CAAC,MAAM,aAAc,QAAO;AAChC,YAAM,OAAO,OAAO,SAAS,MAAM,GAAG,IAAI,MAAM,MAAM;AACtD,YAAM,IAAI,KAAK,OAAO,IAAI,QAAQ,MAAM,IAAI;AAC5C,aAAO,OAAO,IAAI,MAAM;AAAA,IAC1B;AAEA,aAAS,YAAY,GAAW;AAC9B,aAAO,MAAM,aAAa,OAAO,OAAO,EAAE,QAAQ,MAAM,SAAS,CAAC,IAAI;AAAA,IACxE;AAEA,aAAS,SAAS,GAAkB;AAClC,YAAM,IAAI,MAAM,YAAY,gBAAgB,CAAC,CAAC,CAAC;AAC/C,YAAM,QAAQ;AACd,WAAK,qBAAqB,CAAC;AAC3B,WAAK,SAAS,CAAC;AACf,WAAK,UAAU,CAAC;AAAA,IAClB;;;QApHO,OAAK,CAAC,+CAA6C,EAAA,eAA0B,QAAA,UAAQ;AAAA,MAAA,6IAKzEA,sBAAA,QAAA,YAAY,MAAA,KAAK,IAAA,cAAA,0JAY3BC,cAAA,SAAO,aAAA,KAAY,0BACT,QAAA,QAAQ,IAAA,cAAA,uJAYRD,sBAAA,QAAA,YAAY,MAAA,KAAK,IAAA,cAAA;;;;;;;;;;;","names":["_ssrIncludeBooleanAttr","_ssrRenderAttr"],"sources":["../../../../app/components/base/InputNumber.vue"],"sourcesContent":["<template>\n  <div class=\"input-number inline-center select-none anim\" :class=\"{ 'is-disabled': disabled }\">\n    <!-- 减号 -->\n    <button\n        class=\"btn minus-btn inline-center cursor-pointer anim border-none outline-none w-8 h-8\"\n        type=\"button\"\n        :disabled=\"disabled || isMin\"\n        @mousedown.prevent=\"onHold(-1)\"\n        @mouseup=\"onRelease\"\n        @mouseleave=\"onRelease\"\n        aria-label=\"decrease\"\n    >-\n    </button>\n\n    <!-- 输入框 -->\n    <input\n        ref=\"inputRef\"\n        class=\"flex-1 h-8 px-2 text-center border-none outline-none bg-transparent input-inner w-14\"\n        :value=\"displayValue\"\n        :disabled=\"disabled\"\n        inputmode=\"decimal\"\n        @input=\"e => displayValue = e.target.value\"\n        @keydown.up.prevent=\"change(1)\"\n        @keydown.down.prevent=\"change(-1)\"\n        @blur=\"onBlur\"\n    />\n\n    <!-- 加号 -->\n    <button\n        class=\"btn plus-btn inline-center cursor-pointer anim border-none outline-none w-8 h-8\"\n        type=\"button\"\n        :disabled=\"disabled || isMax\"\n        @mousedown.prevent=\"onHold(1)\"\n        @mouseup=\"onRelease\"\n        @mouseleave=\"onRelease\"\n        aria-label=\"increase\"\n    >+\n    </button>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport {ref, computed, onBeforeUnmount, watch} from 'vue'\n\nconst props = defineProps({\n  modelValue: {type: [Number, String], default: null},\n  min: {type: Number, default: -Infinity},\n  max: {type: Number, default: Infinity},\n  step: {type: Number, default: 1},\n  precision: {type: Number},\n  disabled: {type: Boolean, default: false},\n  stepStrictly: {type: Boolean, default: false},\n})\n\nconst emit = defineEmits(['update:modelValue', 'input', 'change'])\n\nconst inputRef = ref<HTMLInputElement | null>(null)\nconst inner = ref<number | null>(normalizeToNumber(props.modelValue))\nlet holdTimer: number | null = null\nlet holdInterval: number | null = null\n\nwatch(() => props.modelValue, (value: number) => {\n  inner.value = value\n})\nconst displayValue = computed({\n  get: () => inner.value === null ? '' : format(inner.value),\n  set: v => {\n    const n = parseInput(v)\n    if (n === 'editing') return\n    setValue(n)\n  }\n})\n\nconst isMin = computed(() => inner.value !== null && inner.value <= props.min)\nconst isMax = computed(() => inner.value !== null && inner.value >= props.max)\n\nfunction normalizeToNumber(v: any): number | null {\n  const n = Number(v)\n  return Number.isFinite(n) ? n : null\n}\n\nfunction clamp(n: number | null) {\n  if (n === null) return null\n  if (n < props.min) return props.min\n  if (n > props.max) return props.max\n  return n\n}\n\nfunction format(n: number) {\n  return props.precision != null ? n.toFixed(props.precision) : String(n)\n}\n\nfunction parseInput(s: string): number | 'editing' | null {\n  const trimmed = s.trim()\n  if (['', '-', '+', '.', '-.', '+.'].includes(trimmed)) return 'editing'\n  const n = Number(trimmed)\n  return Number.isFinite(n) ? n : 'editing'\n}\n\nfunction applyStepStrict(n: number | null) {\n  if (n === null) return null\n  if (!props.stepStrictly) return n\n  const base = Number.isFinite(props.min) ? props.min : 0\n  const k = Math.round((n - base) / props.step)\n  return base + k * props.step\n}\n\nfunction toPrecision(n: number) {\n  return props.precision != null ? Number(n.toFixed(props.precision)) : n\n}\n\nfunction setValue(n: number | null) {\n  const v = clamp(toPrecision(applyStepStrict(n)))\n  inner.value = v\n  emit('update:modelValue', v)\n  emit('input', v)\n  emit('change', v)\n}\n\nfunction change(dir: 1 | -1) {\n  if (props.disabled) return\n  const base = inner.value ?? (Number.isFinite(props.min) ? props.min : 0)\n  setValue(base + dir * props.step)\n}\n\nfunction onHold(dir: 1 | -1) {\n  change(dir)\n  holdTimer = window.setTimeout(() => {\n    holdInterval = window.setInterval(() => change(dir), 100)\n  }, 400)\n}\n\nfunction onRelease() {\n  if (holdTimer) {\n    clearTimeout(holdTimer);\n    holdTimer = null\n  }\n  if (holdInterval) {\n    clearInterval(holdInterval);\n    holdInterval = null\n  }\n}\n\nfunction onBlur() {\n  const n = parseInput(displayValue.value)\n  setValue(n === 'editing' ? inner.value : n)\n}\n\nonBeforeUnmount(onRelease)\n</script>\n\n<style scoped lang=\"scss\">\n.input-number {\n  border: 1px solid var(--color-input-border);\n  overflow: hidden;\n  border-radius: 4px;\n  background: var(--color-input-bg);\n\n  &:hover {\n    border-color: var(--color-select-bg);\n  }\n\n  &.is-disabled {\n    opacity: .3;\n\n    .btn, .input-inner {\n      cursor: not-allowed;\n    }\n  }\n\n  .input-inner {\n    color: var(--color-input-color);\n  }\n\n  .btn {\n    background: var(--color-second);\n    color: var(--color-input-color);\n\n    &.minus-btn {\n      border-right: 1px solid var(--color-input-border);\n    }\n\n    &.plus-btn {\n      border-left: 1px solid var(--color-input-border);\n    }\n\n    &:hover {\n      background: var(--color-third);\n      color: var(--color-select-bg);\n    }\n\n    &:disabled {\n      opacity: .5;\n      cursor: not-allowed;\n    }\n  }\n}\n</style>\n"],"version":3}