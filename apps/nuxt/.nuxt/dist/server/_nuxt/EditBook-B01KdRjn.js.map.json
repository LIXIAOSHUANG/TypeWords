{"file":"EditBook-B01KdRjn.js","mappings":"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","names":["_ref","_ssrRenderAttrs","_mergeProps","_unref","_push","_parent","_","_scopeId","_createVNode"],"sources":["../../../../app/components/article/EditBook.vue"],"sourcesContent":["<script setup lang=\"ts\">import { ref as _ref } from 'vue';\n\nimport type { Dict } from '~/types/types.ts'\nimport { cloneDeep } from '~/utils'\nimport Toast from '~/components/base/toast/Toast.ts'\nimport { onMounted, reactive } from 'vue'\nimport { useRuntimeStore } from '~/stores/runtime.ts'\nimport { useBaseStore } from '~/stores/base.ts'\nimport BaseButton from '~/components/BaseButton.vue'\nimport { getDefaultDict } from '~/types/func.ts'\nimport Select from '~/components/base/select/Select.vue'\nimport Option from '~/components/base/select/Option.vue'\nimport BaseInput from '~/components/base/BaseInput.vue'\nimport Form from '~/components/base/form/Form.vue'\nimport FormItem from '~/components/base/form/FormItem.vue'\nimport { addDict } from '~/apis'\nimport { AppEnv, DictId } from '~/config/env.ts'\nimport { nanoid } from 'nanoid'\nimport { DictType } from '~/types/enum.ts'\nimport { useI18n } from 'vue-i18n'\n\nconst props = defineProps({\n  isAdd: { type: Boolean },\n  isBook: { type: Boolean }\n})\nconst emit = defineEmits([\"submit\", \"close\"])\nconst runtimeStore = useRuntimeStore()\nconst store = useBaseStore()\nconst DefaultDictForm = {\n  id: '',\n  name: '',\n  description: '',\n  category: '',\n  tags: [],\n  translateLanguage: 'zh-CN',\n  language: 'en',\n  type: DictType.article,\n}\nlet dictForm: any = _ref(cloneDeep(DefaultDictForm))\nconst dictFormRef = _ref()\nlet loading = _ref(false)\nconst { t: $t } = useI18n()\nconst dictRules = reactive({\n  name: [\n    { required: true, message: $t('please_enter_name'), trigger: 'blur' },\n    { max: 20, message: $t('name_max_20_chars'), trigger: 'blur' },\n  ],\n})\n\nasync function onSubmit() {\n  await dictFormRef.value.validate(async valid => {\n    if (valid) {\n      let data: Dict = getDefaultDict(dictForm.value)\n      data.type = props.isBook ? DictType.article : DictType.word\n      let source = [store.article, store.word][props.isBook ? 0 : 1]\n      //todo 可以检查的更准确些，比如json对比\n      if (props.isAdd) {\n        data.id = 'custom-dict-' + Date.now()\n        data.custom = true\n        if (source.bookList.find(v => v.name === data.name)) {\n          Toast.warning($t('name_already_exists'))\n          return\n        } else {\n          if (AppEnv.CAN_REQUEST) {\n            loading.value = true\n            let res = await addDict(null, data)\n            loading.value = false\n            if (res.success) {\n              data = getDefaultDict(res.data)\n            } else {\n              return Toast.error(res.msg)\n            }\n          }\n          source.bookList.push(cloneDeep(data))\n          runtimeStore.editDict = data\n          emit('submit')\n          Toast.success($t('add_success'))\n        }\n      } else {\n        let rIndex = source.bookList.findIndex(v => v.id === data.id)\n        //任意修改，都将其变为自定义词典\n        if (\n          !data.custom &&\n          ![DictId.wordKnown, DictId.wordWrong, DictId.wordCollect, DictId.articleCollect].includes(\n            data.en_name || data.id\n          )\n        ) {\n          data.custom = true\n          if (!data.id.includes('_custom')) {\n            data.id += '_custom_' + nanoid(6)\n          }\n        }\n        runtimeStore.editDict = data\n        if (rIndex > -1) {\n          source.bookList[rIndex] = getDefaultDict(data)\n          emit('submit')\n          Toast.success($t('edit_success'))\n        } else {\n          source.bookList.push(getDefaultDict(data))\n          Toast.success($t('edit_and_add_to_dict'))\n        }\n      }\n      console.log('submit!', data)\n    } else {\n      Toast.warning($t('please_fill_complete'))\n    }\n  })\n}\n\nonMounted(() => {\n  if (!props.isAdd) {\n    dictForm.value = cloneDeep(runtimeStore.editDict)\n  }\n})\n</script>\n\n<template>\n  <div class=\"w-120 mt-4\">\n    <Form ref=\"dictFormRef\" :rules=\"dictRules\" :model=\"dictForm\" label-width=\"8rem\">\n      <FormItem :label=\"$t('name')\" prop=\"name\">\n        <BaseInput v-model=\"dictForm.name\" />\n      </FormItem>\n      <FormItem :label=\"$t('description')\">\n        <Textarea v-model=\"dictForm.description\" autosize></Textarea>\n      </FormItem>\n      <FormItem :label=\"$t('source_language')\" v-if=\"false\">\n        <Select v-model=\"dictForm.language\" :placeholder=\"$t('please_select')\">\n          <Option :label=\"$t('english')\" value=\"en\" />\n          <Option :label=\"$t('german')\" value=\"de\" />\n          <Option :label=\"$t('japanese')\" value=\"ja\" />\n          <Option :label=\"$t('code')\" value=\"code\" />\n        </Select>\n      </FormItem>\n      <FormItem :label=\"$t('target_language')\" v-if=\"false\">\n        <Select v-model=\"dictForm.translateLanguage\" :placeholder=\"$t('please_select')\">\n          <Option :label=\"$t('chinese')\" value=\"zh-CN\" />\n          <Option :label=\"$t('english')\" value=\"en\" />\n          <Option :label=\"$t('german')\" value=\"de\" />\n          <Option :label=\"$t('japanese')\" value=\"ja\" />\n        </Select>\n      </FormItem>\n      <div class=\"center\">\n        <base-button type=\"info\" @click=\"emit('close')\">{{ $t('close') }}</base-button>\n        <base-button type=\"primary\" :loading=\"loading\" @click=\"onSubmit\">{{ $t('confirm') }}</base-button>\n      </div>\n    </Form>\n  </div>\n</template>\n\n<style scoped lang=\"scss\"></style>\n"],"version":3}