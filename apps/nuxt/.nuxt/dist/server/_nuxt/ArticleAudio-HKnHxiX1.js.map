{"version":3,"file":"ArticleAudio-HKnHxiX1.js","sources":["../../../../app/components/base/Audio.vue","../../../../app/components/article/ArticleAudio.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport { computed, ref, useAttrs, watch } from 'vue'\n\ninterface IProps {\n  src?: string\n  autoplay?: boolean\n  loop?: boolean\n  volume?: number // 0-1\n  currentTime?: number\n  playbackRate?: number\n  disabled?: boolean\n}\n\nconst props = defineProps({\n  src: null,\n  autoplay: { type: Boolean, default: false },\n  loop: { type: Boolean, default: false },\n  volume: { default: 1 },\n  currentTime: { default: 0 },\n  playbackRate: { default: 1 },\n  disabled: { type: Boolean, default: false }\n})\n\nconst emit = defineEmits([\"ended\", \"update-volume\", \"update-speed\"])\n\nconst attrs = useAttrs()\n\n// 音频元素引用\nconst audioRef = ref<HTMLAudioElement>()\nconst progressBarRef = ref<HTMLDivElement>()\nconst volumeBarRef = ref<HTMLDivElement>()\nconst volumeFillRef = ref<HTMLElement>()\n\n// 状态管理\nconst isPlaying = ref(false)\nconst isLoading = ref(false)\nconst duration = ref(0)\nconst currentTime = ref(0)\n// const volume = ref(props.volume);\nconst volume = ref(props.volume)\nconst playbackRate = ref(props.playbackRate)\nconst isDragging = ref(false)\nconst isVolumeDragging = ref(false)\nconst isVolumeHovering = ref(false) // 添加音量控制hover状态变量\nconst volumePosition = ref('top') // 音量控制位置，'top'或'down'\nconst error = ref('')\n\n// 计算属性\nconst progress = computed(() => {\n  return duration.value > 0 ? (currentTime.value / duration.value) * 100 : 0\n})\n\nconst volumeProgress = computed(() => {\n  return volume.value * 100\n})\n\nconst formatTime = (time: number) => {\n  if (!isFinite(time)) return '0:00'\n  const minutes = Math.floor(time / 60)\n  const seconds = Math.floor(time % 60)\n  return `${minutes}:${seconds.toString().padStart(2, '0')}`\n}\n\n// 播放控制\nconst togglePlay = async () => {\n  if (!audioRef.value || props.disabled) return\n\n  try {\n    if (isPlaying.value) {\n      audioRef.value.pause()\n    } else {\n      await audioRef.value.play()\n    }\n  } catch (err) {\n    console.error('播放失败:', err)\n    error.value = '播放失败'\n  }\n}\n\nconst toggleMute = () => {\n  if (!audioRef.value || props.disabled) return\n\n  if (volume.value > 0) {\n    volume.value = 0\n    audioRef.value.volume = 0\n  } else {\n    volume.value = 1\n    audioRef.value.volume = 1\n  }\n  emit('update-volume', Math.floor(volume.value * 100))\n}\n\nconst changePlaybackRate = () => {\n  if (!audioRef.value || props.disabled) return\n  const rates = [0.5, 0.75, 1, 1.25, 1.5, 2]\n  const currentIndex = rates.indexOf(playbackRate.value)\n  const nextIndex = (currentIndex + 1) % rates.length\n  playbackRate.value = rates[nextIndex]\n  audioRef.value.playbackRate = playbackRate.value\n  // 提交更新播放速度事件\n  emit('update-speed', playbackRate.value)\n}\n\n// 事件处理\nconst handleLoadStart = () => {\n  isLoading.value = true\n}\n\nconst handleLoadedData = () => {\n  isLoading.value = false\n}\n\nconst handleLoadedMetadata = () => {\n  if (audioRef.value) {\n    audioRef.value.volume = volume.value\n  }\n\n  duration.value = audioRef.value?.duration || 0\n}\n\nconst handleCanPlayThrough = () => {}\n\nconst handlePlay = () => {\n  isPlaying.value = true\n}\n\nconst handlePause = () => {\n  isPlaying.value = false\n}\n\nconst handleEnded = () => {\n  isPlaying.value = false\n  currentTime.value = 0\n  emit('ended')\n}\n\nconst handleError = () => {\n  error.value = '音频加载失败'\n  isLoading.value = false\n}\n\nconst handleTimeUpdate = () => {\n  if (audioRef.value && !isDragging.value) {\n    currentTime.value = audioRef.value.currentTime\n  }\n}\n\nconst handleVolumeChange = () => {\n  if (audioRef.value && !isVolumeDragging.value) {\n    volume.value = audioRef.value.volume\n  }\n}\n\nconst handleRateChange = () => {\n  if (audioRef.value) {\n    playbackRate.value = audioRef.value.playbackRate\n  }\n}\n\n// 进度条处理\nconst handleProgressMouseDown = (event: MouseEvent) => {\n  if (!audioRef.value || !progressBarRef.value || props.disabled) return\n\n  event.preventDefault()\n  event.stopPropagation()\n\n  const rect = progressBarRef.value.getBoundingClientRect()\n  const startX = event.clientX\n  const startY = event.clientY\n  let hasMoved = false\n  let lastPosition = 0 // 记录最后的位置\n  const moveThreshold = 3 // 移动阈值，超过这个距离才认为是拖拽\n\n  // 获取DOM元素引用\n  const progressFill = progressBarRef.value.querySelector('.progress-fill') as HTMLElement\n  const progressThumb = progressBarRef.value.querySelector('.progress-thumb') as HTMLElement\n\n  // 立即跳转到点击位置\n  const clickX = event.clientX - rect.left\n  const percentage = Math.max(0, Math.min(1, clickX / rect.width))\n  const newTime = percentage * duration.value\n\n  // 直接更新DOM样式\n  if (progressFill && progressThumb) {\n    progressFill.style.width = `${percentage * 100}%`\n    progressThumb.style.left = `${percentage * 100}%`\n  }\n\n  audioRef.value.currentTime = newTime\n  currentTime.value = newTime\n  lastPosition = newTime\n  isDragging.value = true\n\n  const handleMouseMove = (e: MouseEvent) => {\n    const deltaX = Math.abs(e.clientX - startX)\n    const deltaY = Math.abs(e.clientY - startY)\n\n    if (deltaX > moveThreshold || deltaY > moveThreshold) {\n      hasMoved = true\n    }\n\n    if (!hasMoved) return\n\n    // 禁用过渡动画\n    if (progressFill && progressThumb) {\n      progressFill.style.transition = 'none'\n      progressThumb.style.transition = 'none'\n    }\n\n    const rect = progressBarRef.value!.getBoundingClientRect()\n    const clickX = e.clientX - rect.left\n    const percentage = Math.max(0, Math.min(1, clickX / rect.width))\n    const newTime = percentage * duration.value\n\n    // 直接更新DOM样式，不使用响应式变量\n    if (progressFill && progressThumb) {\n      progressFill.style.width = `${percentage * 100}%`\n      progressThumb.style.left = `${percentage * 100}%`\n    }\n\n    // 只更新响应式变量用于时间显示，不用于样式\n    currentTime.value = newTime\n    lastPosition = newTime\n  }\n\n  const handleMouseUp = () => {\n    isDragging.value = false\n\n    // 恢复过渡动画\n    if (progressFill && progressThumb) {\n      progressFill.style.transition = ''\n      progressThumb.style.transition = ''\n    }\n\n    // 如果是拖拽，在结束时更新audio元素到最终位置\n    if (hasMoved && audioRef.value) {\n      audioRef.value.currentTime = lastPosition\n    }\n\n    document.removeEventListener('mousemove', handleMouseMove)\n    document.removeEventListener('mouseup', handleMouseUp)\n  }\n\n  document.addEventListener('mousemove', handleMouseMove)\n  document.addEventListener('mouseup', handleMouseUp)\n}\n\n// 音量控制处理\nconst handleVolumeMouseDown = (event: MouseEvent) => {\n  if (!audioRef.value || !volumeBarRef.value || props.disabled) return\n\n  event.preventDefault()\n  event.stopPropagation()\n\n  const rect = volumeBarRef.value.getBoundingClientRect()\n  const startX = event.clientX\n  const startY = event.clientY\n  let hasMoved = false\n  let lastVolume = 0 // 记录最后音量\n  const moveThreshold = 3 // 超过这个距离才认为是拖拽\n\n  const volumeFill = volumeFillRef.value\n\n  // 计算点击位置对应音量百分比（最上 100%，最下 0%）\n  const clickY = event.clientY - rect.top\n  const percentage = 1 - Math.max(0, Math.min(1, clickY / rect.height))\n\n  // 更新 UI 与音量\n  if (volumeFill) {\n    volumeFill.style.height = `${percentage * 100}%`\n  }\n\n  volume.value = percentage\n  audioRef.value.volume = percentage\n  lastVolume = percentage\n  isVolumeDragging.value = true\n\n  // 鼠标移动时调整音量\n  const handleMouseMove = (e: MouseEvent) => {\n    const deltaX = Math.abs(e.clientX - startX)\n    const deltaY = Math.abs(e.clientY - startY)\n\n    if (deltaX > moveThreshold || deltaY > moveThreshold) {\n      hasMoved = true\n    }\n\n    if (!hasMoved) return\n\n    // 禁用过渡动画\n    if (volumeFill) {\n      volumeFill.style.transition = 'none'\n    }\n\n    const rect = volumeBarRef.value!.getBoundingClientRect()\n    const moveY = e.clientY - rect.top\n    const percentage = 1 - Math.max(0, Math.min(1, moveY / rect.height))\n\n    if (volumeFill) {\n      volumeFill.style.height = `${percentage * 100}%`\n    }\n\n    volume.value = percentage\n    lastVolume = percentage\n    if (audioRef.value) {\n      audioRef.value.volume = percentage\n    }\n  }\n\n  // 鼠标释放时结束拖动\n  const handleMouseUp = () => {\n    isVolumeDragging.value = false\n\n    // 恢复过渡动画\n    if (volumeFill) {\n      volumeFill.style.transition = ''\n    }\n\n    if (hasMoved && audioRef.value) {\n      audioRef.value.volume = lastVolume\n    }\n    // 提交更新音量事件\n    emit('update-volume', Math.floor(volume.value * 100))\n\n    document.removeEventListener('mousemove', handleMouseMove)\n    document.removeEventListener('mouseup', handleMouseUp)\n  }\n\n  document.addEventListener('mousemove', handleMouseMove)\n  document.addEventListener('mouseup', handleMouseUp)\n}\n\n// 音量控制鼠标移入事件，自动调整音量控制条位置\nconst onVolumeSectionEnter = (e: MouseEvent) => {\n  isVolumeHovering.value = true\n  const section = e.target as HTMLElement\n  const top = section.getBoundingClientRect().top + window.scrollY\n  const dropdownH = section.querySelector('.volume-dropdown').clientHeight\n  if (top < dropdownH * 1.25) {\n    volumePosition.value = 'down'\n  } else {\n    volumePosition.value = 'top'\n  }\n}\n\n// 监听属性变化\nwatch(\n  () => props.src,\n  newSrc => {\n    if (audioRef.value) {\n      // 重置所有状态\n      isPlaying.value = false\n      isLoading.value = false\n      currentTime.value = 0\n      duration.value = 0\n      error.value = ''\n\n      if (newSrc) {\n        audioRef.value.src = newSrc\n        audioRef.value.load()\n      } else {\n        // 如果src为空，清空音频源\n        audioRef.value.src = ''\n        audioRef.value.load()\n      }\n    }\n  }\n)\n\nwatch(\n  () => props.volume,\n  newVolume => {\n    volume.value = newVolume\n    if (audioRef.value) {\n      audioRef.value.volume = newVolume\n    }\n  }\n)\n\nwatch(\n  () => props.currentTime,\n  newTime => {\n    if (audioRef.value && !isDragging.value) {\n      audioRef.value.currentTime = newTime\n      currentTime.value = newTime\n    }\n  }\n)\n\nwatch(\n  () => props.playbackRate,\n  newRate => {\n    playbackRate.value = newRate\n    if (audioRef.value) {\n      audioRef.value.playbackRate = newRate\n    }\n  }\n)\n\ndefineExpose({ audioRef })\n</script>\n\n<template>\n  <div class=\"custom-audio\" :class=\"{ disabled: disabled || error, 'has-error': error }\" v-bind=\"attrs\">\n    <!-- 隐藏的原生audio元素 -->\n    <audio\n      ref=\"audioRef\"\n      :src=\"src\"\n      preload=\"auto\"\n      :autoplay=\"autoplay\"\n      :loop=\"loop\"\n      :controls=\"false\"\n      @loadstart=\"handleLoadStart\"\n      @loadeddata=\"handleLoadedData\"\n      @loadedmetadata=\"handleLoadedMetadata\"\n      @canplaythrough=\"handleCanPlayThrough\"\n      @play=\"handlePlay\"\n      @pause=\"handlePause\"\n      @ended=\"handleEnded\"\n      @error=\"handleError\"\n      @timeupdate=\"handleTimeUpdate\"\n      @volumechange=\"handleVolumeChange\"\n      @ratechange=\"handleRateChange\"\n    />\n\n    <!-- 自定义控制界面 -->\n    <div class=\"audio-container\">\n      <!-- 播放/暂停按钮 -->\n      <button\n        class=\"play-button\"\n        :class=\"{ loading: isLoading }\"\n        @click=\"togglePlay\"\n        :disabled=\"disabled\"\n        :aria-label=\"isPlaying ? '暂停' : '播放'\"\n      >\n        <div v-if=\"isLoading\" class=\"loading-spinner\"></div>\n        <svg v-else-if=\"isPlaying\" class=\"icon\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\n          <path d=\"M6 4h4v16H6V4zm8 0h4v16h-4V4z\" />\n        </svg>\n        <svg v-else class=\"icon\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\n          <path d=\"M8 5v14l11-7z\" />\n        </svg>\n      </button>\n\n      <!-- 进度条区域 -->\n      <div class=\"progress-section\">\n        <!-- 进度条 -->\n        <div class=\"progress-container\" @mousedown=\"handleProgressMouseDown\" ref=\"progressBarRef\">\n          <div class=\"progress-track\">\n            <div class=\"progress-fill\" :style=\"{ width: progress + '%' }\"></div>\n            <div class=\"progress-thumb\" :style=\"{ left: progress + '%' }\"></div>\n          </div>\n        </div>\n        <!-- 时间显示 -->\n        <span class=\"time-display\">{{ formatTime(currentTime) }} / {{ formatTime(duration) }}</span>\n      </div>\n\n      <!-- 音量控制 -->\n      <div class=\"volume-section\" @mouseenter=\"onVolumeSectionEnter\" @mouseleave=\"isVolumeHovering = false\">\n        <button\n          class=\"volume-button\"\n          tabindex=\"-1\"\n          @click=\"toggleMute\"\n          :disabled=\"disabled\"\n          :aria-label=\"volume > 0 ? '静音' : '取消静音'\"\n        >\n          <IconBxVolumeMute v-if=\"volume === 0\" class=\"icon\"></IconBxVolumeMute>\n          <IconBxVolumeLow v-else-if=\"volume < 0.5\" class=\"icon\"></IconBxVolumeLow>\n          <IconBxVolumeFull v-else class=\"icon\"></IconBxVolumeFull>\n        </button>\n\n        <!-- 音量下拉控制条 -->\n        <div class=\"volume-dropdown\" :class=\"[{ active: isVolumeHovering || isVolumeDragging }, volumePosition]\">\n          <div class=\"volume-container\" @mousedown=\"handleVolumeMouseDown\" ref=\"volumeBarRef\">\n            <div class=\"volume-track\">\n              <div class=\"volume-fill\" ref=\"volumeFillRef\" :style=\"{ height: volumeProgress + '%', bottom: 0 }\"></div>\n            </div>\n            <div class=\"volume-num\">\n              <span>{{ Math.floor(volumeProgress) }}%</span>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <!-- 播放速度控制 -->\n      <button\n        class=\"speed-button\"\n        @click=\"changePlaybackRate\"\n        :disabled=\"disabled\"\n        :aria-label=\"`播放速度: ${playbackRate}x`\"\n      >\n        {{ playbackRate }}x\n      </button>\n    </div>\n\n    <!-- 错误信息 -->\n    <div v-if=\"error\" class=\"error-message\">{{ error }}</div>\n  </div>\n</template>\n\n<style scoped lang=\"scss\">\n.custom-audio {\n  --audio-border-radius: 8px;\n  --audio-box-shadow: 0 2px 2px rgba(0, 0, 0, 0.1);\n  --audio-button-bg: rgba(255, 255, 255, 0.2);\n  --audio-thumb-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);\n  --audio-volume-thumb-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);\n  --audio-speed-button-border: rgba(255, 255, 255, 0.3);\n  --audio-error-bg: #f56c6c;\n  --height: 32px;\n  --gap: 8px;\n\n  border-radius: var(--audio-border-radius);\n  box-shadow: var(--audio-box-shadow);\n  color: var(--color-reverse-black);\n  transition: all 0.3s ease;\n  font-family: var(--font-family);\n  padding: 0.3rem 0.4rem;\n  @apply box-border w-full relative bg-primary inline-block max-w-[600px];\n\n  &.disabled {\n    pointer-events: none;\n  }\n\n  &.has-error {\n    border: 1px solid var(--audio-error-bg);\n  }\n}\n\n.audio-container {\n  @apply flex items-center gap-2;\n}\n\n.play-button {\n  @apply flex items-center justify-center mr-2 rounded-full bg-second cursor-pointer transition-all duration-300 flex-shrink-0;\n  width: var(--height);\n  height: var(--height);\n  color: var(--color-reverse-black);\n  background: var(--color-second);\n  border: 1px solid var(--audio-speed-button-border);\n\n  &:hover {\n    background: var(--color-card-active) !important;\n  }\n\n  &.loading {\n    background: var(--audio-button-bg);\n  }\n\n  .icon {\n    @apply w-5 h-5;\n  }\n\n  .loading-spinner {\n    border: 2px solid rgba(255, 255, 255, 0.3);\n    border-top: 2px solid currentColor;\n    animation: spin 1s linear infinite;\n    @apply w-5 h-5 rounded-full box-border flex-shrink-0;\n  }\n}\n\n.progress-section {\n  @apply flex items-center gap-2 flex-1 min-w-0;\n}\n\n.time-display {\n  @apply text-xs font-medium opacity-80 whitespace-nowrap text-center;\n}\n\n.progress-container {\n  @apply flex items-center cursor-pointer p-0 flex-1;\n}\n\n.progress-track {\n  @apply relative w-full h-2 bg-second rounded-sm;\n}\n\n.progress-fill {\n  @apply h-full bg-fourth rounded-sm transition-width duration-100;\n}\n  \n.progress-thumb {\n  @apply absolute top-1/2 transform-translate-x-1/2 w-3 h-3 bg-fourth rounded-full cursor-grab opacity-100 transition-all duration-200;\n  transform: translate(-50%, -50%);\n  box-shadow: var(--audio-thumb-shadow);\n\n  &:active {\n    @apply cursor-grabbing;\n  }\n}\n\n.volume-section {\n  @apply flex items-center justify-center gap-2 flex-shrink-0 relative;\n}\n\n.volume-button {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: var(--height);\n  height: var(--height);\n  border-radius: 4px;\n  background: var(--color-second);\n  cursor: pointer;\n  color: var(--color-reverse-black);\n  transition: all 0.2s ease;\n  border: 1px solid var(--audio-speed-button-border);\n\n  &:hover {\n    background: var(--color-card-active);\n  }\n\n  .icon {\n    @apply w-5 h-5;\n  }\n}\n\n.volume-dropdown {\n  position: absolute;\n  background: var(--color-reverse-white);\n  border-radius: 8px;\n  padding: 8px;\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);\n  opacity: 0;\n  visibility: hidden;\n  transition:\n    opacity 0.2s ease,\n    visibility 0.2s ease;\n  z-index: 10;\n  color: var(--color-reverse-black);\n\n  &.active {\n    opacity: 1;\n    visibility: visible;\n  }\n\n  &.top {\n    bottom: 42px;\n  }\n\n  &.down {\n    top: 42px;\n  }\n}\n\n.volume-container {\n  width: 24px;\n  height: 100px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  cursor: pointer;\n  padding: 8px 0;\n}\n\n.volume-track {\n  position: relative;\n  width: 6px;\n  height: 100%;\n  background: var(--color-second);\n  border-radius: 6px;\n  // overflow: hidden;\n}\n\n.volume-num {\n  display: flex;\n  position: absolute;\n  bottom: 0;\n  font-size: 12px;\n  transform: scale(0.85);\n  line-height: normal;\n}\n\n.volume-fill {\n  position: absolute;\n  bottom: 0;\n  width: 100%;\n  height: var(--fill-height);\n  background: var(--color-fourth);\n  border-radius: 6px;\n  display: flex;\n  justify-content: center;\n\n  &::before {\n    content: '';\n    position: absolute;\n    top: 0;\n    width: 10px;\n    height: 10px;\n    border-radius: 100%;\n    background: var(--color-fourth);\n    transform: translateY(-50%);\n    box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.5);\n    cursor: grab;\n  }\n}\n\n.speed-button {\n  padding: 0 0.5rem;\n  border: 1px solid var(--audio-speed-button-border);\n  border-radius: 4px;\n  background: var(--color-second);\n  height: var(--height);\n  cursor: pointer;\n  color: var(--color-reverse-black);\n  transition: all 0.2s ease;\n\n  &:hover {\n    background: var(--color-card-active);\n  }\n}\n\n.error-message {\n  position: absolute;\n  right: 0;\n  left: 2.6rem;\n  top: 0;\n  height: 100%;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  background: var(--audio-error-bg);\n  color: var(--color-reverse-white);\n  font-size: 12px;\n  border-radius: var(--audio-border-radius);\n}\n\n// 动画\n@keyframes spin {\n  0% {\n    transform: rotate(0deg);\n  }\n\n  100% {\n    transform: rotate(360deg);\n  }\n}\n</style>\n","<script setup lang=\"ts\">import { ref as _ref } from 'vue';\n\nimport type { Article } from '~/types/types.ts'\nimport { ref, watch } from 'vue'\nimport { get } from 'idb-keyval'\nimport Audio from '~/components/base/Audio.vue'\nimport { ENV, LOCAL_FILE_KEY } from '~/config/env.ts'\n\nconst props = defineProps({\n  article: null\n})\n\nconst emit = defineEmits([\"ended\", \"update-volume\", \"update-speed\"])\n\nlet file = _ref(null)\nlet instance = _ref<{ audioRef: HTMLAudioElement }>({ audioRef: null })\nconst pendingUpdates = ref({})\n\nconst handleVolumeUpdate = (volume: number) => {\n  emit('update-volume', volume)\n}\n\nconst handleSpeedUpdate = (speed: number) => {\n  emit('update-speed', speed)\n}\n\nconst setAudioRefValue = (key: string, value: any) => {\n  if (instance.value?.audioRef) {\n    switch (key) {\n      case 'currentTime':\n        instance.value.audioRef.currentTime = value\n        break\n      case 'volume':\n        instance.value.audioRef.volume = value\n        break\n      case 'playbackRate':\n        instance.value.audioRef.playbackRate = value\n        break\n      default:\n        break\n    }\n  } else {\n    // 如果audioRef还未初始化，先存起来，等初始化后再设置 => watch监听instance变化\n    pendingUpdates.value[key] = value\n  }\n}\n\nwatch(\n  () => props.article.audioFileId,\n  async () => {\n    if (!props.article.audioSrc && props.article.audioFileId) {\n      let list = await get(LOCAL_FILE_KEY)\n      if (list) {\n        let rItem = list.find(file => file.id === props.article.audioFileId)\n        if (rItem) {\n          file.value = URL.createObjectURL(rItem.file)\n        }\n      }\n    } else {\n      file.value = null\n    }\n  },\n  { immediate: true }\n)\n\n// 监听instance变化，设置之前pending的值\nwatch(\n  () => instance.value,\n  newVal => {\n    Object.entries(pendingUpdates.value).forEach(([key, value]) => {\n      setAudioRefValue(key, value)\n    })\n    pendingUpdates.value = {}\n  },\n  { immediate: true }\n)\n\n//转发一遍，这里Proxy的默认值不能为{}，可能是vue做了什么\ndefineExpose(\n  new Proxy(\n    {\n      currentTime: 0,\n      played: false,\n      src: '',\n      volume: 0,\n      playbackRate: 1,\n      play: () => void 0,\n      pause: () => void 0,\n    },\n    {\n      get(target, key) {\n        if (key === 'currentTime') return instance.value?.audioRef?.currentTime\n        if (key === 'played') return instance.value?.audioRef?.played\n        if (key === 'src') return instance.value?.audioRef?.src\n        if (key === 'volume') return instance.value?.audioRef?.volume\n        if (key === 'playbackRate') return instance.value?.audioRef?.playbackRate\n        if (key === 'play') instance.value?.audioRef?.play()\n        if (key === 'pause') instance.value?.audioRef?.pause()\n        return target[key]\n      },\n      set(_, key, value) {\n        setAudioRefValue(key as string, value)\n        return true\n      },\n    }\n  )\n)\n</script>\n\n<template>\n  <Audio\n    v-bind=\"$attrs\"\n    ref=\"instance\"\n    v-if=\"props.article.audioSrc\"\n    :src=\"ENV.RESOURCE_URL + props.article.audioSrc\"\n    @ended=\"emit('ended')\"\n    @update-volume=\"handleVolumeUpdate\"\n    @update-speed=\"handleSpeedUpdate\"\n  />\n  <Audio\n    v-bind=\"$attrs\"\n    ref=\"instance\"\n    v-else-if=\"file\"\n    :src=\"file\"\n    @ended=\"emit('ended')\"\n    @update-volume=\"handleVolumeUpdate\"\n    @update-speed=\"handleSpeedUpdate\"\n  />\n</template>\n"],"names":["_unref","_ssrRenderAttr","_ssrInterpolate","_ssrRenderComponent","_ref","file","$attrs"],"mappings":"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"}